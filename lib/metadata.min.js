/*!
 metadata.js v0.12.231, built:2017-06-26 &copy; Evgeniy Malyarov http://www.oknosoft.ru 2014-2017
 metadata.js may be freely distributed under the MIT. To obtain _Oknosoft Commercial license_, contact info@oknosoft.ru
 */
!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.$p=t()}(this,function(){function MetaEngine(){this.__define({version:{value:"0.12.231",writable:!1},toString:{value:function(){return"Oknosoft data engine. v:"+this.version},writable:!1},utils:{value:new Utils},injected_data:{value:{},writable:!1},ajax:{value:new Ajax,writable:!1},msg:{value:new Messages,writable:!1},wsql:{value:new WSQL,writable:!1},eve:{value:new AppEvents,writable:!1},aes:{value:new Aes("metadata.js"),writable:!1},moment:{get:function(){return this.utils.moment}},_patch:{value:function(e,t){for(var n in t)"object"==typeof t[n]&&e[n]&&"object"==typeof e[n]?$p._patch(e[n],t[n]):e[n]=t[n];return e}},_find:{value:function(e,t,n){var i,a,o;if("object"!=typeof t)for(a in e){i=e[a];for(var s in i)if("function"!=typeof i[s]&&$p.utils.is_equal(i[s],t))return i}else for(a in e){i=e[a],o=!0;for(var s in t)if("function"!=typeof i[s]&&!$p.utils.is_equal(i[s],t[s])){o=!1;break}if(o)return i}}},_selection:{value:function(e,t){var n,i,a,o=!0;if(t)if("function"==typeof t)o=t.call(this,e);else for(n in t)if(i=t[n],a=i&&"object"==typeof i,"_"!=n.substr(0,1))if("function"==typeof i){if(!(o=i.call(this,e,n)))break}else if("or"==n&&Array.isArray(i)){if(!(o=i.some(function(t){var n=Object.keys(t)[0];return t[n].hasOwnProperty("like")?"string"==typeof e[n]&&-1!=e[n].toLowerCase().indexOf(t[n].like.toLowerCase()):$p.utils.is_equal(e[n],t[n])})))break}else if(a&&i.hasOwnProperty("like")){if(!e[n]||-1==e[n].toLowerCase().indexOf(i.like.toLowerCase())){o=!1;break}}else if(a&&i.hasOwnProperty("not")){if($p.utils.is_equal(e[n],i.not)){o=!1;break}}else if(a&&i.hasOwnProperty("in")){if(!(o=i.in.some(function(t){return $p.utils.is_equal(t,e[n])})))break}else if(a&&i.hasOwnProperty("lt")){if(!(o=e[n]<i.lt))break}else if(a&&i.hasOwnProperty("gt")){if(!(o=e[n]>i.gt))break}else if(a&&i.hasOwnProperty("between")){var s=e[n];if("number"!=typeof s&&(s=$p.utils.fix_date(e[n])),!(o=s>=i.between[0]&&s<=i.between[1]))break}else if(!$p.utils.is_equal(e[n],i)){o=!1;break}return o}},_find_rows:{value:function(e,t,n){var i,a,o=[],s=0;t&&(t._top?(a=t._top,delete t._top):a=1e3);for(var r in e)if(i=e[r],$p._selection.call(this,i,t)){if(n){if(!1===n.call(this,i))break}else o.push(i);if(a&&++s>=a)break}return o}},on:{value:function(e,t){if("object"!=typeof e)return this.eve.attachEvent(e,t);for(var n in e)e[n]._evnts||(e[n]._evnts=[]),e[n]._evnts.push(this.eve.attachEvent(n,e[n]))}},off:{value:function(e){2==arguments.length&&(e=arguments[1]),"function"==typeof e&&e._evnts?e._evnts.forEach(function(e){$p.eve.detachEvent(e)}):e?$p.eve.detachEvent(e):$p.eve.detachAllEvents()}},record_log:{value:function(e){$p.ireg&&$p.ireg.log&&$p.ireg.log.record(e)}},md:{value:new Meta},enm:{value:new function(){this.toString=function(){return $p.msg.meta_enn_mgr}}},cat:{value:new function(){this.toString=function(){return $p.msg.meta_cat_mgr}}},doc:{value:new function(){this.toString=function(){return $p.msg.meta_doc_mgr}}},ireg:{value:new function(){this.toString=function(){return $p.msg.meta_ireg_mgr}}},areg:{value:new function(){this.toString=function(){return $p.msg.meta_areg_mgr}}},accreg:{value:new function(){this.toString=function(){return $p.msg.meta_accreg_mgr}}},dp:{value:new function(){this.toString=function(){return $p.msg.meta_dp_mgr}}},rep:{value:new function(){this.toString=function(){return $p.msg.meta_reports_mgr}}},cacc:{value:new function(){this.toString=function(){return $p.msg.meta_cacc_mgr}}},cch:{value:new function(){this.toString=function(){return $p.msg.meta_cch_mgr}}},tsk:{value:new function(){this.toString=function(){return $p.msg.meta_task_mgr}}},bp:{value:new function(){this.toString=function(){return $p.msg.meta_bp_mgr}}},DataManager:{value:DataManager},RefDataManager:{value:RefDataManager},DataProcessorsManager:{value:DataProcessorsManager},EnumManager:{value:EnumManager},RegisterManager:{value:RegisterManager},InfoRegManager:{value:InfoRegManager},LogManager:{value:LogManager},MetaObjManager:{value:MetaObjManager},MetaFieldManager:{value:MetaFieldManager},SchemeSettingsManager:{value:SchemeSettingsManager},AccumRegManager:{value:AccumRegManager},CatManager:{value:CatManager},ChartOfCharacteristicManager:{value:ChartOfCharacteristicManager},ChartOfAccountManager:{value:ChartOfAccountManager},DocManager:{value:DocManager},TaskManager:{value:TaskManager},BusinessProcessManager:{value:BusinessProcessManager},DataObj:{value:DataObj},CatObj:{value:CatObj},DocObj:{value:DocObj},DataProcessorObj:{value:DataProcessorObj},TaskObj:{value:TaskObj},BusinessProcessObj:{value:BusinessProcessObj},EnumObj:{value:EnumObj},RegisterRow:{value:RegisterRow},TabularSection:{value:TabularSection},TabularSectionRow:{value:TabularSectionRow}})}function Utils(){this.moment="function"==typeof moment?moment:require("moment"),this.moment._masks={date:"DD.MM.YY",date_time:"DD.MM.YYYY HH:mm",ldt:"DD MMMM YYYY, HH:mm",iso:"YYYY-MM-DDTHH:mm:ss"},this.fix_date=function(e,t){if(e instanceof Date)return e;var n=this.moment(e,["DD-MM-YYYY","DD-MM-YYYY HH:mm","DD-MM-YYYY HH:mm:ss","DD-MM-YY HH:mm","YYYYDDMMHHmmss",this.moment.ISO_8601]);return n.isValid()?n.toDate():t?this.blank.date:e},this.fix_guid=function(e,t){if(e&&"string"==typeof e);else{if(e instanceof DataObj)return e.ref;if(e&&"object"==typeof e)if(e.presentation){if(e.ref)return e.ref;if(e.name)return e.name}else e="object"==typeof e.ref&&e.ref.hasOwnProperty("ref")?e.ref.ref:e.ref}return this.is_guid(e)||!1===t?e:t?this.generate_guid():this.blank.guid},this.fix_number=function(e,t){var n=parseFloat(e);return isNaN(n)?t?0:e:n},this.fix_boolean=function(e){return"string"==typeof e?!(!e||"false"==e.toLowerCase()):!!e},this.blank={date:this.fix_date("0001-01-01T00:00:00"),guid:"00000000-0000-0000-0000-000000000000",by_type:function(e){return e.is_ref?this.guid:e.date_part?this.date:e.digits?0:(!e.types||"boolean"!=e.types[0])&&""}},this.fetch_type=function(e,t){return t.is_ref?this.fix_guid(e):t.date_part?this.fix_date(e,!0):t.digits?this.fix_number(e,!0):t.types&&"boolean"==t.types[0]?this.fix_boolean(e):e},this.date_add_day=function(e,t,n){var i=new Date(e);return i.setDate(e.getDate()+t),n&&i.setHours(0,-i.getTimezoneOffset(),0,0),i},this.generate_guid=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:7&n|8).toString(16)})},this.is_guid=function(e){return!("string"!=typeof e||e.length<36)&&(e.length>36&&(e=e.substr(0,36)),/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(e))},this.is_empty_guid=function(e){return!e||e===this.blank.guid},this.is_data_obj=function(e){return e&&e instanceof DataObj},this.is_data_mgr=function(e){return e&&e instanceof DataManager},this.is_equal=function(e,t){return e==t||typeof e!=typeof t&&this.fix_guid(e,!1)==this.fix_guid(t,!1)},this.blob_as_text=function(e,t){return new Promise(function(n,i){var a=new FileReader;switch(a.onload=function(e){n(a.result)},a.onerror=function(e){i(e)},t){case"array":a.readAsArrayBuffer(e);break;case"data_url":a.readAsDataURL(e);break;default:a.readAsText(e)}})}}function Ajax(){function e(e,t,n,i,a){return new Promise(function(o,s){if("undefined"==typeof window&&i&&i.request)i.request({url:encodeURI(t),headers:{Authorization:i.auth}},function(e,t,n){e?s(e):200!=t.statusCode?s({message:t.statusMessage,description:n,status:t.statusCode}):o({response:n})});else{var r=new XMLHttpRequest;if(window.dhx4&&window.dhx4.isIE&&(t=encodeURI(t)),i){var l,c;"object"==typeof i&&i.username&&i.hasOwnProperty("password")?(l=i.username,c=i.password):$p.ajax.username&&$p.ajax.authorized?(l=$p.ajax.username,c=$p.aes.Ctr.decrypt($p.ajax.password)):(l=$p.wsql.get_user_param("user_name"),c=$p.aes.Ctr.decrypt($p.wsql.get_user_param("user_pwd")),!l&&$p.job_prm&&$p.job_prm.guest_name&&(l=$p.job_prm.guest_name,c=$p.aes.Ctr.decrypt($p.job_prm.guest_pwd))),r.open(e,t,!0,l,c),r.withCredentials=!0,r.setRequestHeader("Authorization","Basic "+btoa(unescape(encodeURIComponent(l+":"+c))))}else r.open(e,t,!0);a&&a.call(this,r),"GET"!=e?this.hide_headers||i.hide_headers||(r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.setRequestHeader("X-Requested-With","XMLHttpRequest")):n=null,r.onload=function(){200==r.status&&(r.response instanceof Blob||"<!DOCTYPE"!==r.response.substr(0,9))?(void 0==r.responseURL&&(r.responseURL=t),o(r)):s(r.response?{message:r.statusText,description:r.response,status:r.status}:Error(r.statusText))},r.onerror=function(){s(Error("Network Error"))},r.send(n)}})}this.username="",this.password="",this.root=!0,this.authorized=!1,this.get=function(t){return e.call(this,"GET",t)},this.post=function(t,n){return 1==arguments.length?n="":2==arguments.length&&"function"==typeof n?(onLoad=n,n=""):n=String(n),e.call(this,"POST",t,n)},this.get_ex=function(t,n,i){return e.call(this,"GET",t,null,n,i)},this.post_ex=function(t,n,i,a){return e.call(this,"POST",t,n,i,a)},this.put_ex=function(t,n,i,a){return e.call(this,"PUT",t,n,i,a)},this.patch_ex=function(t,n,i,a){return e.call(this,"PATCH",t,n,i,a)},this.delete_ex=function(t,n,i){return e.call(this,"DELETE",t,null,n,i)},this.get_and_show_blob=function(e,t,n){function i(t){return e=window.URL.createObjectURL(t.response),a=window.open(e,"wnd_print",o),a.onload=function(t){window.URL.revokeObjectURL(e)},a}var a,o="menubar=no,toolbar=no,location=no,status=no,directories=no,resizable=yes,scrollbars=yes";if(!(e instanceof Blob))return!n||"string"==typeof n&&-1!=n.toLowerCase().indexOf("post")?this.post_ex(e,"object"==typeof t?JSON.stringify(t):t,!0,function(e){e.responseType="blob"}).then(i):this.get_ex(e,!0,function(e){e.responseType="blob"}).then(i);Promise.resolve(i({response:e}))},this.get_and_save_blob=function(e,t,n){return this.post_ex(e,"object"==typeof t?JSON.stringify(t):t,!0,function(e){e.responseType="blob"}).then(function(e){saveAs(e.response,n)})},this.default_attr=function(e,t){e.url||(e.url=t),e.username||(e.username=this.username),e.password||(e.password=this.password),e.hide_headers=!0,$p.job_prm["1c"]&&(e.auth=$p.job_prm["1c"].auth,e.request=$p.job_prm["1c"].request)}}function WSQL(){var e,t=this,n={};this.__define({js_time_diff:{value:-new Date("0001-01-01").valueOf()},time_diff:{get:function(){var e=this.get_user_param("time_diff","number");return!e||isNaN(e)||e<621355716e5||e>62135622e6?this.js_time_diff:e}},set_user_param:{value:function(t,i){"object"==typeof i?(n[t]=i,i=JSON.stringify(i)):!1===i||"false"===i?(n[t]=!1,i=""):n[t]=i,e.setItem($p.job_prm.local_storage_prefix+t,i)}},get_user_param:{value:function(t,i){return!n.hasOwnProperty(t)&&e&&(n[t]=this.fetch_type(e.getItem($p.job_prm.local_storage_prefix+t),i)),n[t]}},promise:{value:function(e,n){return new Promise(function(i,a){t.alasql(e,n||[],function(e,t){t?a(t):i(e)})})}},save_options:{value:function(e,n){return t.set_user_param(e+"_"+n.name,n)}},restore_options:{value:function(e,n){var i=t.get_user_param(e+"_"+n.name,"object");for(var a in i)if("object"!=typeof i[a])n[a]=i[a];else{n[a]||(n[a]={});for(var o in i[a])n[a][o]=i[a][o]}return n}},fetch_type:{value:function(e,t){if("object"==t){try{e=JSON.parse(e)}catch(t){e={}}return e}return"number"==t?$p.utils.fix_number(e,!0):"date"==t?$p.utils.fix_date(e,!0):"boolean"==t?$p.utils.fix_boolean(e):e}},alasql:{value:"undefined"!=typeof alasql?alasql:require("alasql")},init_params:{value:function(){if(!$p.job_prm.local_storage_prefix&&!$p.job_prm.create_tables)return Promise.resolve();e="undefined"==typeof localStorage?{setItem:function(e,t){},getItem:function(e){}}:localStorage;var n,i=[{p:"user_name",v:"",t:"string"},{p:"user_pwd",v:"",t:"string"},{p:"browser_uid",v:$p.utils.generate_guid(),t:"string"},{p:"zone",v:$p.job_prm.hasOwnProperty("zone")?$p.job_prm.zone:1,t:$p.job_prm.zone_is_string?"string":"number"},{p:"enable_save_pwd",v:$p.job_prm.enable_save_pwd,t:"boolean"},{p:"couch_direct",v:!$p.job_prm.hasOwnProperty("couch_direct")||$p.job_prm.couch_direct,t:"boolean"},{p:"couch_path",v:$p.job_prm.couch_path,t:"string"},{p:"rest_path",v:"",t:"string"},{p:"skin",v:"dhx_web",t:"string"}];$p.job_prm.additional_params&&(i=i.concat($p.job_prm.additional_params)),e.getItem($p.job_prm.local_storage_prefix+"zone")||(n=$p.job_prm.hasOwnProperty("zone")?$p.job_prm.zone:1),$p.job_prm.url_prm.hasOwnProperty("zone")&&(n=$p.job_prm.zone_is_string?$p.job_prm.url_prm.zone:$p.utils.fix_number($p.job_prm.url_prm.zone,!0)),void 0!==n&&t.set_user_param("zone",n),i.forEach(function(e){(void 0==("boolean"==e.t?t.get_user_param(e.p):t.get_user_param(e.p,e.t))||!t.get_user_param(e.p,e.t)&&-1!=e.p.indexOf("url"))&&t.set_user_param(e.p,$p.job_prm.hasOwnProperty(e.p)?$p.job_prm[e.p]:e.v)});var a={path:t.get_user_param("couch_path","string")||$p.job_prm.couch_path||"",zone:t.get_user_param("zone","number"),prefix:$p.job_prm.local_storage_prefix,suffix:t.get_user_param("couch_suffix","string")||"",direct:t.get_user_param("couch_direct","boolean"),user_node:$p.job_prm.user_node,noreplicate:$p.job_prm.noreplicate};a.path&&(t.__define("pouch",{value:new Pouch}),t.pouch.init(a)),this.create_tables&&(this.alasq(this.create_tables,[]),this.create_tables="")}},drop_tables:{value:function(e){function n(){o--,o<=0?setTimeout(e,10):i()}function i(){var e=s[o-1].tableid;"_"==e.substr(0,1)?n():t.alasql("drop table IF EXISTS "+e,[],n)}function a(e){s=e,(o=e.length)?i():n()}var o=0,s=[];t.alasql("SHOW TABLES",[],a)}}}),this.__define({aladb:{value:new this.alasql.Database("md")}})}function Col_struct(e,t,n,i,a,o){this.id=e,this.width=t,this.type=n,this.align=i,this.sort=a,this.caption=o}function InterfaceObjs(){function e(e,t,n){var i=this.layout=e.attachLayout({pattern:"2U",cells:[{id:"a",text:"Разделы",collapsed_text:"Разделы",width:220},{id:"b",text:"Раздел",header:!1}],offsets:{top:0,right:0,bottom:0,left:0}}),a=this.tree=i.cells("a").attachTreeView();if(a.attachEvent("onSelect",function(e,t){if(t){var a=$p.md.mgr_by_class_name(e);a instanceof DataProcessorsManager?a.form_rep(i.cells("b"),n||{hide_header:!0}):a&&a.form_list(i.cells("b"),n||{hide_header:!0})}}.bind(this)),!t){var o=$p.md.get_classes();t=[];for(var s in o)o[s].length&&t.push(s)}1==t.length?$p.md.get_classes()[t[0]].forEach(function(e){var n=t[0]+"."+e,i=$p.md.get(n);i.hide||(a.addItem(n,i.list_presentation||i.synonym),a.setItemIcons(n,{file:"icon_1c_"+t[0]}))}.bind(this)):t.forEach(function(e){a.addItem(e,$p.msg["meta_"+e]),a.setItemIcons(e,{file:"icon_1c_"+e,folder_opened:"icon_1c_"+e,folder_closed:"icon_1c_"+e}),$p.md.get_classes()[e].forEach(function(t){var n=e+"."+t,i=$p.md.get(n);i.hide||(a.addItem(n,i.list_presentation||i.synonym,e),a.setItemIcons(n,{file:"icon_1c_"+e}))})})}function t(e){e.attachHTMLString($p.injected_data["view_settings.html"]),this.cont=e.cell.querySelector(".dhx_cell_cont_tabbar"),this.cont.style.overflow="auto",this.form2=function(e){var t=new dhtmlXForm(e,[{type:"settings",labelWidth:80,position:"label-left"},{type:"label",labelWidth:320,label:"Адрес CouchDB",className:"label_options"},{type:"input",inputWidth:220,name:"couch_path",label:"Путь:",validate:"NotEmpty"},{type:"template",label:"",value:"",note:{text:"Можно указать как относительный, так и абсолютный URL публикации CouchDB",width:320}},{type:"label",labelWidth:320,label:"Адрес http сервиса 1С",className:"label_options"},{type:"input",inputWidth:220,name:"rest_path",label:"Путь",validate:"NotEmpty"},{type:"template",label:"",value:"",note:{text:"Можно указать как относительный, так и абсолютный URL публикации 1С OData",width:320}},{type:"label",labelWidth:320,label:"Значение разделителя данных",className:"label_options"},{type:"input",inputWidth:220,name:"zone",label:"Зона:",numberFormat:["0","",""],validate:"NotEmpty,ValidInteger"},{type:"template",label:"",value:"",note:{text:"Для неразделенной публикации, зона = 0",width:320}},{type:"label",labelWidth:320,label:"Суффикс базы пользователя",className:"label_options"},{type:"input",inputWidth:220,name:"couch_suffix",label:"Суффикс:"},{type:"template",label:"",value:"",note:{text:"Назначается абоненту при регистрации",width:320}},{type:"block",blockOffset:0,name:"block_buttons",list:[{type:"button",name:"save",value:"<i class='fa fa-floppy-o fa-lg'></i>",tooltip:"Применить настройки и перезагрузить программу"},{type:"newcolumn"},{type:"button",offsetLeft:20,name:"reset",value:"<i class='fa fa-refresh fa-lg'></i>",tooltip:"Стереть справочники и перезаполнить данными сервера"}]}]);return t.cont.style.fontSize="100%",["zone","couch_path","couch_suffix","rest_path"].forEach(function(e){"zone"==e?t.setItemValue(e,$p.wsql.get_user_param(e)):t.setItemValue(e,$p.wsql.get_user_param(e)||$p.job_prm[e])}),t.attachEvent("onChange",function(e,t,n){$p.wsql.set_user_param(e,"enable_save_pwd"==e?n||"":t)}),t.disableItem("couch_suffix"),$p.job_prm.rest_path||t.disableItem("rest_path"),t.attachEvent("onButtonClick",function(e){"save"==e?($p.wsql.pouch.log_out(),setTimeout(function(){$p.eve.redirect=!0,location.reload(!0)},1e3)):"reset"==e&&dhtmlx.confirm({title:"Сброс данных",text:"Стереть справочники и перезаполнить данными сервера?",cancel:$p.msg.cancel,callback:function(e){e&&$p.wsql.pouch.reset_local_data()}})}),t}(this.cont.querySelector("[name=form2]").firstChild),this.form1=function(e){var t=new dhtmlXForm(e,[{type:"settings",labelWidth:320,position:"label-left"},{type:"label",label:"Тип устройства",className:"label_options"},{type:"block",blockOffset:0,name:"block_device_type",list:[{type:"settings",labelAlign:"left",position:"label-right"},{type:"radio",name:"device_type",labelWidth:120,label:'<i class="fa fa-desktop"></i> Компьютер',value:"desktop"},{type:"newcolumn"},{type:"radio",name:"device_type",labelWidth:150,label:'<i class="fa fa-mobile fa-lg"></i> Телефон, планшет',value:"phone"}]},{type:"template",label:"",value:"",note:{text:"Класс устройства определяется автоматически, но пользователь может задать его явно",width:320}},{type:"label",label:"Сохранять пароль пользователя",className:"label_options"},{type:"checkbox",name:"enable_save_pwd",label:"Разрешить:",labelWidth:90,checked:$p.wsql.get_user_param("enable_save_pwd","boolean")},{type:"template",label:"",value:"",note:{text:"Не рекомендуется, если к компьютеру имеют доступ посторонние лица",width:320}},{type:"template",label:"",value:"",note:{text:"",width:320}},{type:"label",label:"Подключаемые модули",className:"label_options"},{type:"input",position:"label-top",inputWidth:320,name:"modifiers",label:"Модификаторы:",value:$p.wsql.get_user_param("modifiers"),rows:3,style:"height:80px;"},{type:"template",label:"",value:"",note:{text:"Список дополнительных модулей",width:320}}]);return t.cont.style.fontSize="100%",t.checkItem("device_type",$p.job_prm.device_type),t.attachEvent("onChange",function(e,t,n){$p.wsql.set_user_param(e,"enable_save_pwd"==e?n||"":t)}),t.disableItem("modifiers"),t.getInput("modifiers").onchange=function(){$p.wsql.set_user_param("modifiers",this.value)},t}(this.cont.querySelector("[name=form1]").firstChild)}var n=this;this.get_offset=function(e){var t={left:0,top:0};if(e.offsetParent)do{t.left+=e.offsetLeft,t.top+=e.offsetTop}while(e=e.offsetParent);return t},this.normalize_xml=function(e){if(!e)return"";var t={"&":"&amp;",'"':"&quot;","'":"&apos;","<":"&lt;",">":"&gt;"};return e.replace(/[&"'<>]/g,function(e){return t[e]})},this.scale_svg=function(e,t,n){var i,a,o,s,r,l,c,p,d,u={},f="number"==typeof t?t:t.height,m="number"==typeof t?(1.5*t).round(0):t.width,_="number"==typeof t?1/0:t.zoom||1/0;r=e.indexOf(">"),c=e.substring(5,r),o=c.split(" "),s=e.substr(r+1),s=s.substr(0,s.length-6);for(i in o)e=o[i].split("="),-1!="width,height,x,y".indexOf(e[0])&&(e[1]=Number(e[1].replace(/"/g,"")),u[e[0]]=e[1]);-1!=(l=c.indexOf("viewBox="))?(p=c.substring(l+9),d='viewBox="'+p.substring(0,p.indexOf('"'))+'"'):d='viewBox="'+(u.x||0)+" "+(u.y||0)+" "+(u.width-n)+" "+(u.height-n)+'"';var h=u.height,g=u.width;return a=(f-n)/h,u.height=f,u.width=(g*a).round(0),u.width>m&&(a=(m-n)/g,u.height=(h*a).round(0),u.width=m),a>_&&(a=_,u.height=(h*a).round(0),u.width=(g*a).round(0)),u.x=(u.x*a).round(0),u.y=(u.y*a).round(0),'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="'+u.width+'" height="'+u.height+'" x="'+u.x+'" y="'+u.y+'" xml:space="preserve" '+d+">"+s+"</svg>"},this.bind_help=function(e,t){function n(e){if(!e.help_path)return void $p.msg.show_msg({title:"Справка",type:"alert-info",text:$p.msg.not_implemented})}e instanceof dhtmlXCellObject||(!e.help_path&&t&&(e.help_path=t),e.button("help").show(),e.button("help").enable(),e.attachEvent("onHelp",n))},this.set_hash=function(e,t,i,a){var o={},s=$p.job_prm.parse_url();1==arguments.length&&"object"==typeof e&&(o=e,o.hasOwnProperty("obj")&&(e=o.obj,delete o.obj),o.hasOwnProperty("ref")&&(t=o.ref,delete o.ref),o.hasOwnProperty("frm")&&(i=o.frm,delete o.frm),o.hasOwnProperty("view")&&(a=o.view,delete o.view)),void 0===e&&(e=s.obj||""),void 0===t&&(t=s.ref||""),void 0===i&&(i=s.frm||""),void 0===a&&(a=s.view||"");var r="obj="+e+"&ref="+t+"&frm="+i+"&view="+a;for(var l in o)r+="&"+l+"="+o[l];location.hash.substr(1)==r?n.hash_route():location.hash=r},this.hash_route=function(e){var t,i=$p.job_prm.parse_url(),a=$p.eve.callEvent("hash_route",[i]);if(!1===a||n.before_route&&!1===n.before_route(e)||$p.ajax.authorized&&(i.ref&&void 0!==_md?(t=_md.mgr_by_class_name(i.obj))&&t[i.frm||"form_obj"](n.docs,i.ref):i.view&&n.swith_view&&n.swith_view(i.view)),e)return n.cancel_bubble(e)},this.cancel_bubble=function(e,t){var n=e||event;return n&&t&&n.preventDefault&&n.preventDefault(),n&&n.stopPropagation&&n.stopPropagation(),n&&!n.cancelBubble&&(n.cancelBubble=!0),!1},this.Col_struct=Col_struct,this.init_sidebar=function(e,t,i){n.btn_auth_sync=new n.OBtnAuthSync,n.btns_nav=function(e){return n.btn_auth_sync.bind(new n.OTooolBar({wrapper:e,class_name:"md_otbnav",width:"260px",height:"28px",top:"3px",right:"3px",name:"right",buttons:t,onclick:function(e){return n.main.cells(e).setActive(!0),!1}}))},n.main=new dhtmlXSideBar({parent:document.body,icons_path:i||"dist/imgs/",width:180,header:!0,template:"tiles",autohide:!0,items:e,offsets:{top:0,right:0,bottom:0,left:0}}),n.main.attachEvent("onSelect",function(e){var t=$p.job_prm.parse_url();t.view!=e&&n.set_hash(t.obj,t.ref,t.frm,e),n["view_"+e](n.main.cells(e))}),n.main.progressOn();var a=$p.job_prm.parse_url();a.view&&-1!=n.main.getAllItems().indexOf(a.view)?setTimeout(n.hash_route):n.set_hash(a.obj,a.ref,a.frm,"doc")},this.All_meta_objs=e,this.Setting2col=t,this.do_reload=function(e,t){function n(){dhtmlx.confirm({title:t||$p.msg.file_new_date_title,text:e||$p.msg.file_new_date,ok:"Перезагрузка",cancel:"Продолжить",callback:function(e){e?($p.wsql.pouch.log_out(),setTimeout(function(){$p.eve.redirect=!0,location.reload(!0)},1e3)):(i++,setTimeout(n,3e4*i))}})}var i=0;n()},this.check_exit=function(e){var t;return this.w.forEachWindow(function(n){n==e||!n.isModal()&&$p.iface.w.getTopmostWindow()!=n||(t=!0)}),t}}function Pouch(){var e,t,n,i,a=this,o={};a.__define({DB:{value:"undefined"==typeof PouchDB?require("pouchdb-core").plugin(require("pouchdb-adapter-memory")).plugin(require("pouchdb-adapter-http")).plugin(require("pouchdb-replication")).plugin(require("pouchdb-mapreduce")).plugin(require("pouchdb-find")):PouchDB},init:{value:function(e){o._mixin(e),o.path&&0!=o.path.indexOf("http")&&"undefined"!=typeof location&&(o.path=location.protocol+"//"+location.host+o.path)}},local:{get:function(){if(!e){var t={auto_compaction:!0,revs_limit:2};e={ram:new a.DB(o.prefix+o.zone+"_ram",t),doc:o.direct?a.remote.doc:new a.DB(o.prefix+o.zone+"_doc",t),meta:new a.DB(o.prefix+"meta",t),sync:{}}}return o.path&&!e._meta&&(e._meta=new a.DB(o.path+"meta",{skip_setup:!0}),a.run_sync(e.meta,e._meta,"meta")),e}},remote:{get:function(){if(!t){var e={skip_setup:!0,adapter:"http"};t={},$p.md.bases().forEach(function(n){t[n]="ram"==n?new a.DB(o.path+o.zone+"_"+n,e):new a.DB(o.path+o.zone+"_"+n+(o.suffix?"_"+o.suffix:""),e)})}return t}},log_in:{value:function(e,i){if(void 0==e&&void 0==i){if(!$p.job_prm.guests||!$p.job_prm.guests.length)return Promise.reject(new Error("username & password not defined"));e=$p.job_prm.guests[0].username,i=$p.aes.Ctr.decrypt($p.job_prm.guests[0].password)}if(n)return n.username==e?Promise.resolve():Promise.reject(new Error("need logout first"));var o=$p.md.bases(),s=[];return this.remote,o.forEach(function(n){s.push(t[n].login(e,i))}),Promise.all(s).then(function(){return n={username:e},setTimeout(function(){$p.wsql.get_user_param("user_name")!=e&&$p.wsql.set_user_param("user_name",e),$p.wsql.get_user_param("enable_save_pwd")?$p.aes.Ctr.decrypt($p.wsql.get_user_param("user_pwd"))!=i&&$p.wsql.set_user_param("user_pwd",$p.aes.Ctr.encrypt(i)):""!=$p.wsql.get_user_param("user_pwd")&&$p.wsql.set_user_param("user_pwd",""),$p.eve.callEvent("user_log_in",[e])}),s.length=0,o.forEach(function(e){a.local[e]&&a.remote[e]&&a.local[e]!=a.remote[e]&&s.push(a.run_sync(a.local[e],a.remote[e],e))}),Promise.all(s)}).then(function(){return a.local._loading?new Promise(function(e,t){$p.eve.attachEvent("pouch_data_loaded",e)}):a.call_data_loaded()}).catch(function(e){$p.eve.callEvent("user_log_fault",[e])})}},log_out:{value:function(){if(n){if(e.sync.doc)try{e.sync.doc.cancel()}catch(e){}if(e.sync.ram)try{e.sync.ram.cancel()}catch(e){}n=null}return $p.eve.callEvent("log_out"),o.direct&&setTimeout(function(){$p.eve.redirect=!0,location.reload(!0)},1e3),t&&t.ram?t.ram.logout().then(function(){if(t&&t.doc)return t.doc.logout()}).then(function(){t&&t.ram&&delete t.ram,t&&t.doc&&delete t.doc,t=null,$p.eve.callEvent("user_log_out")}):Promise.resolve()}},reset_local_data:{value:function(){var e=a.local.ram.destroy.bind(a.local.ram),t=a.local.doc.destroy.bind(a.local.doc),n=function(){setTimeout(function(){$p.eve.redirect=!0,location.reload(!0)},1e3)};a.log_out(),setTimeout(function(){e().then(t).catch(t).then(n).catch(n)},1e3)}},call_data_loaded:{value:function(t){return i=!0,t||(t=e.sync._page||{}),$p.md.load_doc_ram().then(function(){setTimeout(function(){$p.eve.callEvent(t.note="pouch_data_loaded",[t])},1e3)})}},load_data:{value:function(){var e={limit:800,include_docs:!0},t={total_rows:0,limit:e.limit,page:0,start:Date.now()};return new Promise(function(n,i){function o(){a.local.ram.allDocs(e,function(s,r){r?(t.page++,t.total_rows=r.total_rows,t.duration=Date.now()-t.start,$p.eve.callEvent("pouch_load_data_page",[t]),a.load_changes(r,e)?o():(n(),a.call_data_loaded(t))):s&&(i(s),$p.eve.callEvent("pouch_load_data_error",[s]))})}a.local.ram.info().then(function(e){e.doc_count>=($p.job_prm.pouch_ram_doc_count||10)?($p.eve.callEvent("pouch_load_data_start",[t]),a.local._loading=!0,o()):($p.eve.callEvent("pouch_load_data_error",[e]),i(e))})})}},authorized:{get:function(){return n&&n.username}},data_loaded:{get:function(){return!!i}},run_sync:{value:function(t,n,o){var s,r;return t.info().then(function(e){return s=e,n.info()}).then(function(e){return"ram"!=o?e:n.get("data_version").then(function(t){return t.version!=$p.wsql.get_user_param("couch_ram_data_version")&&($p.wsql.get_user_param("couch_ram_data_version")&&(e=a.reset_local_data()),$p.wsql.set_user_param("couch_ram_data_version",t.version)),e}).catch(function(e){$p.record_log(e)}).then(function(){return e})}).then(function(l){if(l)return r={id:o,total_rows:l.doc_count+l.doc_del_count,local_rows:s.doc_count,docs_written:0,limit:200,page:0,start:Date.now()},"ram"==o&&s.doc_count<($p.job_prm.pouch_ram_doc_count||10)?$p.eve.callEvent("pouch_load_data_start",[r]):$p.eve.callEvent("pouch_"+o+"_sync_start"),new Promise(function(l,c){function p(d,u){return d.on("change",function(e){!i&&s.doc_count<($p.job_prm.pouch_ram_doc_count||10)&&(r.page++,r.docs_written=e.docs_written,r.duration=Date.now()-r.start,$p.eve.callEvent("pouch_load_data_page",[r])),"ram"!=o&&(e.update_only=!0),a.load_changes(e),$p.eve.callEvent("pouch_change",[o,e])}).on("paused",function(e){$p.eve.callEvent("pouch_paused",[o,e])}).on("active",function(e){$p.eve.callEvent("pouch_active",[o,e])}).on("denied",function(e){$p.eve.callEvent("pouch_denied",[o,e])}).on("complete",function(i){u&&(u.live=!0,u.retry=!0,"ram"==o||"meta"==o||$p.wsql.get_user_param("zone")==$p.job_prm.zone_demo?e.sync[o]=p(t.replicate.from(n,u)):e.sync[o]=p(t.sync(n,u)),l(o))}).on("error",function(e){c([o,e]),$p.eve.callEvent("pouch_error",[o,e])})}var d={batch_size:200,batches_limit:6};"meta"==o?(d.filter="auth/meta",d.live=!0,d.retry=!0):$p.job_prm.pouch_filter&&$p.job_prm.pouch_filter[o]&&(d.filter=$p.job_prm.pouch_filter[o]),p(t.replicate.from(n,d),d)})})}},load_obj:{value:function(e){return e._manager.pouch_db.get(e.class_name+"|"+e.ref).then(function(t){delete t._id,delete t._rev,e._mixin(t)._set_loaded()}).catch(function(e){if(404!=e.status)throw e}).then(function(t){return e})}},save_obj:{value:function(e,t){var n=e._data;if(!n||n._saving&&!n._modified)return Promise.resolve(e);if(n._saving&&n._modified)return new Promise(function(n,i){setTimeout(function(){n(a.save_obj(e,t))},100)});n._saving=!0;var i=e._obj._clone(void 0,!0),o=t.db||e._manager.pouch_db;return i.class_name=e.class_name,i._id=i.class_name+"|"+e.ref,delete i.ref,t.attachments&&(i._attachments=t.attachments),(e.is_new()?Promise.resolve():o.get(i._id)).then(function(e){if(e){i._rev=e._rev;for(var t in e._attachments)i._attachments||(i._attachments={}),i._attachments[t]||(i._attachments[t]=e._attachments[t])}}).catch(function(e){if(e&&404!=e.status)throw e}).then(function(){return o.put(i)}).then(function(){if(e.is_new()&&e._set_loaded(e.ref),i._attachments){e._attachments||(e._attachments={});for(var t in i._attachments)e._attachments[t]&&i._attachments[t].stub||(e._attachments[t]=i._attachments[t])}return delete n._saving,e}).catch(function(e){if(delete n._saving,e&&404!=e.status)throw e})}},load_changes:{value:function(e,t){var n,i,a,o,s={};if(t)n=e.rows;else if(e.direction){if("pull"!=e.direction)return;n=e.change.docs}else n=e.docs;if(n.length>0){t&&(t.startkey=n[n.length-1].key,t.skip=1),n.forEach(function(e){if(!(i=t?e.doc:e))if(e.value&&e.value.deleted)i={_id:e.id,_deleted:!0};else if(e.error)return;o=i._id.split("|"),a=o[0].split("."),i.ref=o[1],delete i._id,delete i._rev,s[a[0]]||(s[a[0]]={}),s[a[0]][a[1]]||(s[a[0]][a[1]]=[]),s[a[0]][a[1]].push(i)});for(var r in s)for(a in s[r])$p[r]&&$p[r][a]&&$p[r][a].load_array(s[r][a],!e.update_only||-1!=$p[r][a].cachable.indexOf("ram")||"update_only");return!0}return!1}},backup_database:{value:function(e){}},restore_database:{value:function(e){}}})}function Messages(){this.toString=function(){return"Интернационализация сообщений"},"undefined"!=typeof window&&"dhtmlx"in window&&(this.show_msg=function(e,t){if(e){if("string"==typeof e){if($p.iface.synctxt)return void $p.iface.synctxt.show_message(e);e={type:"info",text:e}}else Array.isArray(e)&&e.length>1&&(e={type:"info",text:"<b>"+e[0]+"</b><br />"+e[1]});t&&"function"==typeof t.setText&&t.setText(e.text),dhtmlx.message(e)}},dhtmlx.message.position="bottom",this.check_soap_result=function(e){return e?"limit_query"==e.error?($p.iface.docs.progressOff(),$p.msg.show_msg({type:"alert-warning",text:$p.msg.limit_query.replace("%1",e.queries).replace("%2",e.queries_avalable),title:$p.msg.srv_overload}),!0):"network"==e.error||"empty"==e.error?($p.iface.docs.progressOff(),$p.msg.show_msg({type:"alert-warning",text:$p.msg.error_network,title:$p.msg.error_critical}),!0):e.error&&e.error_description?($p.iface.docs.progressOff(),-1!=e.error_description.indexOf("Недостаточно прав")&&(e.error_type="alert-warning",e.error_title=$p.msg.error_rights),$p.msg.show_msg({type:e.error_type||"alert-error",text:e.error_description,title:e.error_title||$p.msg.error_critical}),!0):e.error&&!e.messages?($p.iface.docs.progressOff(),$p.msg.show_msg({type:"alert-error",title:$p.msg.error_critical,
text:$p.msg.unknown_error.replace("%1","unknown_error")}),!0):void 0:($p.msg.show_msg({type:"alert-error",text:$p.msg.empty_response,title:$p.msg.error_critical}),!0)},this.show_not_implemented=function(){$p.msg.show_msg({type:"alert-warning",text:$p.msg.not_implemented,title:$p.msg.main_title})})}function Meta(){function e(e){return e.info().then(function(){return e.get("meta")}).then(function(n){return $p._patch(t,n),n=null,e.get("meta_patch")}).then(function(e){return $p._patch(t,e),e=null,delete t._id,delete t._rev,t})}var t={enm:{accumulation_record_type:[{order:0,name:"debit",synonym:"Приход"},{order:1,name:"credit",synonym:"Расход"}],sort_directions:[{order:0,name:"asc",synonym:"По возрастанию"},{order:1,name:"desc",synonym:"По убыванию"}],comparison_types:[{order:0,name:"gt",synonym:"Больше"},{order:1,name:"gte",synonym:"Больше или равно"},{order:2,name:"lt",synonym:"Меньше"},{order:3,name:"lte",synonym:"Меньше или равно "},{order:4,name:"eq",synonym:"Равно"},{order:5,name:"ne",synonym:"Не равно"},{order:6,name:"in",synonym:"В списке"},{order:7,name:"nin",synonym:"Не в списке"},{order:8,name:"lke",synonym:"Подобно "},{order:9,name:"nlk",synonym:"Не подобно"}]},cat:{meta_objs:{fields:{}},meta_fields:{fields:{}},scheme_settings:{name:"scheme_settings",synonym:"Настройки отчетов и списков",input_by_string:["name"],hierarchical:!1,has_owners:!1,group_hierarchy:!0,main_presentation_name:!0,code_length:0,fields:{obj:{synonym:"Объект",tooltip:"Имя класса метаданных",type:{types:["string"],str_len:250}},user:{synonym:"Пользователь",tooltip:"Если пусто - публичная настройка",type:{types:["string"],str_len:50}},order:{synonym:"Порядок",tooltip:"Порядок варианта",type:{types:["number"],digits:6,fraction_figits:0}},query:{synonym:"Запрос",tooltip:"Индекс CouchDB или текст SQL",type:{types:["string"],str_len:0}},date_from:{synonym:"Начало периода",tooltip:"",type:{types:["date"],date_part:"date"}},date_till:{synonym:"Конец периода",tooltip:"",type:{types:["date"],date_part:"date"}},formula:{synonym:"Формула",tooltip:"Формула инициализации",type:{types:["cat.formulas"],is_ref:!0}},tag:{synonym:"Дополнительные свойства",type:{types:["string"],str_len:0}}},tabular_sections:{fields:{name:"fields",synonym:"Доступные поля",tooltip:"Состав, порядок и ширина колонок",fields:{parent:{synonym:"Родитель",tooltip:"Для плоского списка, родитель пустой",type:{types:["string"],str_len:100}},use:{synonym:"Использование",tooltip:"",type:{types:["boolean"]}},field:{synonym:"Поле",tooltip:"",type:{types:["string"],str_len:100}},width:{synonym:"Ширина",tooltip:"",type:{types:["string"],str_len:6}},caption:{synonym:"Заголовок",tooltip:"",type:{types:["string"],str_len:100}},tooltip:{synonym:"Подсказка",tooltip:"",type:{types:["string"],str_len:100}},ctrl_type:{synonym:"Тип",tooltip:"Тип элемента управления",type:{types:["string"],str_len:100}},formatter:{synonym:"Формат",tooltip:"Функция форматирования",type:{types:["cat.formulas"],is_ref:!0}},editor:{synonym:"Редактор",tooltip:"Компонент редактирования",type:{types:["cat.formulas"],is_ref:!0}}}},sorting:{name:"sorting",synonym:"Поля сортировки",tooltip:"",fields:{parent:{synonym:"Родитель",tooltip:"",type:{types:["string"],str_len:100}},use:{synonym:"Использование",tooltip:"",type:{types:["boolean"]}},field:{synonym:"Поле",tooltip:"",type:{types:["string"],str_len:100}},direction:{synonym:"Направление",tooltip:"",type:{types:["enm.sort_directions"],is_ref:!0}}}},dimensions:{name:"dimensions",synonym:"Поля группировки",tooltip:"",fields:{parent:{synonym:"Родитель",tooltip:"",type:{types:["string"],str_len:100}},use:{synonym:"Использование",tooltip:"",type:{types:["boolean"]}},field:{synonym:"Поле",tooltip:"",type:{types:["string"],str_len:100}}}},resources:{name:"resources",synonym:"Ресурсы",tooltip:"",fields:{parent:{synonym:"Родитель",tooltip:"",type:{types:["string"],str_len:100}},use:{synonym:"Использование",tooltip:"",type:{types:["boolean"]}},field:{synonym:"Поле",tooltip:"",type:{types:["string"],str_len:100}},formula:{synonym:"Формула",tooltip:"По умолчанию - сумма",type:{types:["cat.formulas"],is_ref:!0}}}},selection:{name:"selection",synonym:"Отбор",tooltip:"",fields:{parent:{synonym:"Родитель",tooltip:"",type:{types:["string"],str_len:100}},use:{synonym:"Использование",tooltip:"",type:{types:["boolean"]}},left_value:{synonym:"Левое значение",tooltip:"",type:{types:["string"],str_len:100}},comparison_type:{synonym:"Вид сравнения",tooltip:"",type:{types:["enm.comparison_types"],is_ref:!0}},right_value:{synonym:"Правое значение",tooltip:"",type:{types:["string"],str_len:100}}}},params:{name:"params",synonym:"Параметры",tooltip:"",fields:{param:{synonym:"Параметр",tooltip:"",type:{types:["string"],str_len:100}},value_type:{synonym:"Тип",tooltip:"Тип значения",type:{types:["string"],str_len:100}},value:{synonym:"Значение",tooltip:"Может иметь примитивный или ссылочный тип или массив",type:{types:["string","number"],str_len:0,digits:15,fraction_figits:3}}}},composition:{name:"composition",synonym:"Структура",tooltip:"",fields:{parent:{synonym:"Родитель",multiline_mode:!1,tooltip:"",type:{types:["string"],str_len:10}},use:{synonym:"Использование",tooltip:"",type:{types:["boolean"]}},field:{synonym:"Элемент",tooltip:"Элемент структуры отчета",type:{types:["string"],str_len:50}},kind:{synonym:"Вид раздела отчета",tooltip:"список, таблица, группировка строк, группировка колонок",type:{types:["string"],str_len:50}},definition:{synonym:"Описание",tooltip:"Описание раздела структуры",type:{types:["string"],str_len:50}}}}},cachable:"doc"}},doc:{},ireg:{log:{name:"log",note:"",synonym:"Журнал событий",dimensions:{date:{synonym:"Дата",multiline_mode:!1,tooltip:"Время события",type:{types:["number"],digits:15,fraction_figits:0}},sequence:{synonym:"Порядок",multiline_mode:!1,tooltip:"Порядок следования",type:{types:["number"],digits:6,fraction_figits:0}}},resources:{class:{synonym:"Класс",multiline_mode:!1,tooltip:"Класс события",type:{types:["string"],str_len:100}},note:{synonym:"Комментарий",multiline_mode:!0,tooltip:"Текст события",type:{types:["string"],str_len:0}},obj:{synonym:"Объект",multiline_mode:!0,tooltip:"Объект, к которому относится событие",type:{types:["string"],str_len:0}}}}},areg:{},dp:{scheme_settings:{name:"scheme_settings",synonym:"Варианты настроек",fields:{scheme:{synonym:"Текущая настройка",tooltip:"Текущий вариант настроек",mandatory:!0,type:{types:["cat.scheme_settings"],is_ref:!0}}}}},rep:{},cch:{},cacc:{}};_md=this,_md.create_managers=function(){},_md.bases=function(){var e={};for(var n in t)for(var i in t[n])if(t[n][i].cachable){var a=t[n][i].cachable.replace("_remote","").replace("_ram","");"meta"==a||"e1cib"==a||e[a]||(e[a]=a)}return Object.keys(e)},_md.load_doc_ram=function(){var e=[];return["cat","cch","ireg"].forEach(function(n){for(var i in t[n])"doc_ram"==t[n][i].cachable&&e.push(n+"."+i)}),$p.wsql.pouch.local.doc.find({selector:{class_name:{$in:e}},limit:1e4}).then($p.wsql.pouch.load_changes)},_md.init=function(n){function i(){if(!n||a||o)return e(n||$p.wsql.pouch.local.meta).then(function(){if(!a)return t;_md.create_managers()}).catch($p.record_log);$p._patch(t,n),n=null,_md.create_managers()}var a=!n||$p.wsql.pouch&&n==$p.wsql.pouch.local.meta,o=n&&$p.wsql.pouch&&n==$p.wsql.pouch.local._meta;return $p.on("pouch_change",function(e,n){"meta"==e&&(t?$p.iface&&$p.iface.do_reload&&n.docs&&n.docs.length<4&&setTimeout(function(){$p.iface.do_reload()},1e4):i())}),i()},_md.get=function(e,n){var i=e.split(".");if(!n)return t[i[0]][i[1]];var a={multiline_mode:!1,note:"",synonym:"",tooltip:"",type:{is_ref:!1,types:["string"]}},o=-1!="doc,tsk,bp".indexOf(i[0]),s=-1!="cat,cch,cacc,tsk".indexOf(i[0]);return o&&"number_doc"==n?(a.synonym="Номер",a.tooltip="Номер документа",a.type.str_len=11):o&&"date"==n?(a.synonym="Дата",a.tooltip="Дата документа",a.type.date_part="date_time",a.type.types[0]="date"):o&&"posted"==n?(a.synonym="Проведен",a.type.types[0]="boolean"):s&&"id"==n?a.synonym="Код":s&&"name"==n?a.synonym="Наименование":"_deleted"==n?(a.synonym="Пометка удаления",a.type.types[0]="boolean"):"is_folder"==n?(a.synonym="Это группа",a.type.types[0]="boolean"):"ref"==n?(a.synonym="Ссылка",a.type.is_ref=!0,a.type.types[0]=e):a=n?t[i[0]][i[1]].fields[n]:t[i[0]][i[1]],a},_md.get_classes=function(){var e={};for(var n in t){e[n]=[];for(var i in t[n])e[n].push(i)}return e},_md.sql_type=function(e,t,n,i){return"type"==t&&"cch_properties"==e.table_name||"svg"==t&&"cat_production_params"==e.table_name?" JSON":n.is_ref||-1!=n.types.indexOf("guid")?i?n.types.every(function(e){return 0==e.indexOf("enm.")})?" character varying(100)":n.hasOwnProperty("str_len")?" character varying("+Math.max(36,n.str_len)+")":" uuid":" CHAR":n.hasOwnProperty("str_len")?i?n.str_len?" character varying("+n.str_len+")":" text":" CHAR":n.date_part?i&&"date"!=n.date_part?"date_time"==n.date_part?" timestamp with time zone":" time without time zone":" Date":n.hasOwnProperty("digits")?0==n.fraction_figits?i?n.digits<7?" integer":" bigint":" INT":i?" numeric("+n.digits+","+n.fraction_figits+")":" FLOAT":-1!=n.types.indexOf("boolean")?" BOOLEAN":-1!=n.types.indexOf("json")?" JSON":i?" character varying(255)":" CHAR"},_md.sql_composite=function(e,t,n,i){var a="";return e[t].type.types.length>1&&"type"!=t&&(n=n?n.substr(0,29)+"_T":t.substr(0,29)+"_T",a=i?', "'+n+'" character varying(255)':_md.sql_mask(n)+" CHAR"),a},_md.sql_mask=function(e,t){return", "+(t?"_t_.":"")+"`"+e+"`"},_md.mgr_by_class_name=function(e){if(e){var t=e.split(".");if(t[1]&&$p[t[0]])return $p[t[0]][t[1]]}},_md.value_mgr=function(e,t,n,i,a){function o(e){return e instanceof DataManager&&1==n.types.length&&(n._mgr=e),e}var s,r,l,c,p;if(n._mgr instanceof DataManager)return n._mgr;if(1==n.types.length){if(l=n.types[0].split("."),l.length>1&&$p[l[0]])return o($p[l[0]][l[1]])}else if(a&&a.type&&(l=a.type.split("."),l.length>1&&$p[l[0]]))return o($p[l[0]][l[1]]);if(s=e.property||e.param,"value"==t&&s){if($p.utils.is_data_obj(s))r=s;else{if(!$p.utils.is_guid(s))return;r=$p.cch.properties.get(s,!1)}if($p.utils.is_data_obj(r)){if(r.is_new())return $p.cat.property_values;if(c=[],r.type.types.some(function(e){if(l=e.split("."),l.length>1&&$p[l[0]][l[1]])c.push($p[l[0]][l[1]]);else if("boolean"==e)return c.push({types:["boolean"]}),!0}),1==c.length||e[t]==$p.utils.blank.guid)return o(c[0]);if(i)return c;if((s=e[t])instanceof DataObj)return s._manager;if($p.utils.is_guid(s)&&s!=$p.utils.blank.guid)for(var d in c)if(p=c[d],p.get(s,!1,!0))return p}}else{if(c=[],n.types.forEach(function(e){l=e.split("."),l.length>1&&$p[l[0]][l[1]]&&c.push($p[l[0]][l[1]])}),1==c.length||e[t]==$p.utils.blank.guid)return o(c[0]);if(i)return c;if((s=e[t])instanceof DataObj)return s._manager;if($p.utils.is_guid(s)&&s!=$p.utils.blank.guid)for(var d in c)if(p=c[d],p.get(s,!1,!0))return p}},_md.control_by_type=function(e,t){return"boolean"==typeof t&&-1!=e.types.indexOf("boolean")?"ch":"number"==typeof t&&e.digits?e.fraction_figits<5?"calck":"edn":t instanceof Date&&e.date_part?"dhxCalendar":e.is_ref?"ocombo":e.date_part?"dhxCalendar":e.digits?e.fraction_figits<5?"calck":"edn":"boolean"==e.types[0]?"ch":e.hasOwnProperty("str_len")&&(e.str_len>=100||0==e.str_len)?"txt":"ed"},_md.ts_captions=function(e,t,n){n||(n={});var i,a=_md.get(e).tabular_sections[t],o=_md.get(e).form,s=a.fields;if(o&&o.obj){if(!o.obj.tabular_sections[t])return;n._mixin(o.obj.tabular_sections[t])}else{"contact_information"===t&&(s={type:"",kind:"",presentation:""}),n.fields=["row"],n.headers="№",n.widths="40",n.min_widths="",n.aligns="",n.sortings="na",n.types="cntr";for(var r in s)i=a.fields[r],i.hide||(n.fields.push(r),n.headers+=","+(i.synonym?i.synonym.replace(/,/g," "):r),n.types+=","+_md.control_by_type(i.type),n.sortings+=",na")}return!0},_md.syns_js=function(e){var n={DeletionMark:"_deleted",Description:"name",DataVersion:"data_version",IsFolder:"is_folder",Number:"number_doc",Date:"date","Дата":"date",Posted:"posted",Code:"id",Parent_Key:"parent",Owner_Key:"owner",Owner:"owner",Ref_Key:"ref","Ссылка":"ref",LineNumber:"row"};return n[e]?n[e]:t.syns_js[t.syns_1с.indexOf(e)]||e},_md.syns_1с=function(e){var n={_deleted:"DeletionMark",name:"Description",is_folder:"IsFolder",number_doc:"Number",date:"Date",posted:"Posted",id:"Code",ref:"Ref_Key",parent:"Parent_Key",owner:"Owner_Key",row:"LineNumber"};return n[e]?n[e]:t.syns_1с[t.syns_js.indexOf(e)]||e},_md.printing_plates=function(e){if(e)for(var n in e.doc)t.doc[n].printing_plates=e.doc[n]},_md.class_name_from_1c=function(e){var t=e.split(".");return 1==t.length?"enm."+e:("Перечисление"==t[0]?e="enm.":"Справочник"==t[0]?e="cat.":"Документ"==t[0]?e="doc.":"РегистрСведений"==t[0]?e="ireg.":"РегистрНакопления"==t[0]?e="areg.":"РегистрБухгалтерии"==t[0]?e="accreg.":"ПланВидовХарактеристик"==t[0]?e="cch.":"ПланСчетов"==t[0]?e="cacc.":"Обработка"==t[0]?e="dp.":"Отчет"==t[0]&&(e="rep."),e+_md.syns_js(t[1]))},_md.class_name_to_1c=function(e){var t=e.split(".");return 1==t.length?"Перечисление."+e:("enm"==t[0]?e="Перечисление.":"cat"==t[0]?e="Справочник.":"doc"==t[0]?e="Документ.":"ireg"==t[0]?e="РегистрСведений.":"areg"==t[0]?e="РегистрНакопления.":"accreg"==t[0]?e="РегистрБухгалтерии.":"cch"==t[0]?e="ПланВидовХарактеристик.":"cacc"==t[0]?e="ПланСчетов.":"dp"==t[0]?e="Обработка.":"rep"==t[0]&&(e="Отчет."),e+_md.syns_1с(t[1]))},_md.create_tables=function(e,t){function n(){o--,0==o?e?e(l):alasql.utils.saveFile("create_tables.sql",l):i()}function i(){var e=s[o-1];l+=e.class[e.name].get_sql_struct(t)+"; ",n()}var a,o=0,s=[],r=_md.get_classes(),l=t&&t.postgres?"":"USE md; ";"enm,cch,cacc,cat,bp,tsk,doc,ireg,areg".split(",").forEach(function(e){for(a in r[e])s.push({class:$p[e],name:r[e][a]})}),o=s.length,i()}}function DataManager(e){var t=_md.get(e),n={after_create:[],after_load:[],before_save:[],after_save:[],value_change:[],add_row:[],del_row:[]};this.__define({cachable:{get:function(){return-1!=e.indexOf("enm.")?"ram":t.cachable?t.cachable:-1!=e.indexOf("doc.")||-1!=e.indexOf("dp.")||-1!=e.indexOf("rep.")?"doc":"ram"}},class_name:{value:e,writable:!1},alatable:{get:function(){return $p.wsql.aladb.tables[this.table_name]?$p.wsql.aladb.tables[this.table_name].data:[]}},metadata:{value:function(e){return e?t.fields[e]||t.tabular_sections[e]:t}},on:{value:function(e,t){if("object"==typeof e)for(var i in e)e.hasOwnProperty(i)&&n[i].push(e[i]);else n[e].push(t)}},off:{value:function(e,t){if("object"==typeof e);else{var i=n[e].indexOf(t);-1!=i&&n[e].splice(i,1)}}},handle_event:{value:function(e,t,i){var a,o=[];return n[t].forEach(function(t){!1!==o&&(a=t.call(e,i),!1===a?o=a:a&&o.push(a))}),!1===o?o:o.length?1==o.length?o[0]:o.some(function(e){return"object"==typeof e&&e.then})?Promise.all(o):o:void 0}},by_ref:{value:{}}})}function RefDataManager(e){RefDataManager.superclass.constructor.call(this,e)}function DataProcessorsManager(e){DataProcessorsManager.superclass.constructor.call(this,e)}function EnumManager(e){EnumManager.superclass.constructor.call(this,e);var t=$p.md.get(e);for(var n in t)new EnumObj(t[n],this)}function RegisterManager(e){RegisterManager.superclass.constructor.call(this,e),this.push=function(e,t){t&&t!=e.ref?(delete this.by_ref[e.ref],this.by_ref[t]=e):this.by_ref[e.ref]=e},this.get=function(e,t,n){if(e?"string"==typeof e&&(e={ref:e}):e={},e.ref&&n)return t?Promise.resolve(this.by_ref[e.ref]):this.by_ref[e.ref];e.action="select";var i,a=$p.wsql.alasql(this.get_sql_struct(e),e._values);if(delete e.action,delete e._values,a.length)if(n)i=this.by_ref[this.get_ref(a[0])];else{i=[];for(var o in a)i.push(this.by_ref[this.get_ref(a[o])])}return t?Promise.resolve(i):i},this.unload_obj=function(e){delete this.by_ref[e],this.alatable.some(function(t,n,i){if(t.ref==e)return i.splice(n,1),!0})},this.load_array=function(e,t){for(var n,i,a=[],o=0;o<e.length;o++){if(n=this.get_ref(e[o]),(i=this.by_ref[n])||e[o]._deleted){if(e[o]._deleted){i&&i.unload();continue}(i.is_new()||t)&&(i._mixin(e[o]),i._set_loaded())}else i=new($p[this.obj_constructor()])(e[o],this),t&&i._set_loaded();a.push(i)}return a}}function InfoRegManager(e){InfoRegManager.superclass.constructor.call(this,e)}function AccumRegManager(e){AccumRegManager.superclass.constructor.call(this,e)}function CatManager(e){CatManager.superclass.constructor.call(this,e),this.metadata().hierarchical&&this.metadata().group_hierarchy&&$p[this.obj_constructor()].prototype.__define("is_folder",{get:function(){return this._obj.is_folder||!1},set:function(e){this._obj.is_folder=$p.utils.fix_boolean(e)},enumerable:!0,configurable:!0})}function ChartOfCharacteristicManager(e){ChartOfCharacteristicManager.superclass.constructor.call(this,e)}function ChartOfAccountManager(e){ChartOfAccountManager.superclass.constructor.call(this,e)}function DocManager(e){DocManager.superclass.constructor.call(this,e)}function TaskManager(e){TaskManager.superclass.constructor.call(this,e)}function BusinessProcessManager(e){BusinessProcessManager.superclass.constructor.call(this,e)}function LogManager(){LogManager.superclass.constructor.call(this,"ireg.log");var e;this.__define({record:{value:function(t){if(t instanceof Error)console&&console.log(t),t={class:"error",note:t.toString()};else if(t instanceof DataObj){console&&console.log(t);var n=t._data._err;t={class:"error",obj:{type:t.class_name,ref:t.ref,presentation:t.presentation},note:n?n.text:""}}else"object"!=typeof t||t.class||t.obj?"object"!=typeof t&&(t={note:t}):t={class:"obj",obj:t,note:t.note};t.date=Date.now()+$p.wsql.time_diff,e||(e=alasql.compile("select MAX(`sequence`) as `sequence` from `ireg_log` where `date` = ?"));var i=e([t.date]);t.sequence=i.length&&void 0!==i[0].sequence?parseInt(i[0].sequence)+1:0,t.class||(t.class="note"),$p.wsql.alasql("insert into `ireg_log` (`ref`, `date`, `sequence`, `class`, `note`, `obj`) values (?,?,?,?,?,?)",[t.date+"¶"+t.sequence,t.date,t.sequence,t.class,t.note,t.obj?JSON.stringify(t.obj):""]),t.note&&$p.msg&&$p.msg.show_msg&&$p.msg.show_msg([t.class,t.note])}},backup:{value:function(e,t){}},restore:{value:function(e,t){}},clear:{value:function(e,t){}},show:{value:function(e){}},get:{value:function(e,t,n){if("object"==typeof e&&(e=e.ref||""),!this.by_ref[e]){if(!1===t)return;var i=e.split("¶");$p.wsql.alasql("select * from `ireg_log` where date="+i[0]+" and sequence="+i[1]).forEach(function(e){new RegisterRow(e,this)}.bind(this))}return t?Promise.resolve(this.by_ref[e]):this.by_ref[e]}},get_sql_struct:{value:function(e){if(e&&"get_selection"==e.action){var t="select * from `ireg_log`";return e.date_from?e.date_till?t+=" where `date` >= ? and `date` <= ?":t+=" where `date` >= ?":e.date_till&&(t+=" where `date` <= ?"),t}return LogManager.superclass.get_sql_struct.call(this,e)}},caption_flds:{value:function(e){var t=[],n="";if(t.push(new Col_struct("date","200","ro","left","server","Дата")),t.push(new Col_struct("class","100","ro","left","server","Класс")),t.push(new Col_struct("note","*","ro","left","server","Событие")),e.get_header){n="<head>";for(var i in t)n+='<column id="%1" width="%2" type="%3" align="%4" sort="%5">%6</column>'.replace("%1",t[i].id).replace("%2",t[i].width).replace("%3",t[i].type).replace("%4",t[i].align).replace("%5",t[i].sort).replace("%6",t[i].caption);n+="</head>"}return{head:n,acols:t}}},data_to_grid:{value:function(e,t){var n="<?xml version='1.0' encoding='UTF-8'?><rows total_count='%1' pos='%2' set_parent='%3'>".replace("%1",e.length).replace("%2",t.start).replace("%3",t.set_parent||""),i=this.caption_flds(t);return n+=i.head,e.forEach(function(e){n+='<row id="'+e.ref+'"><cell>'+$p.moment(e.date-$p.wsql.time_diff).format("DD.MM.YYYY HH:mm:ss")+"."+e.sequence+"</cell><cell>"+(e.class||"")+"</cell><cell>"+(e.note||"")+"</cell></row>"}),n+"</rows>"}}})}function MetaObjManager(){MetaObjManager.superclass.constructor.call(this,"cat.meta_objs")}function MetaFieldManager(){MetaFieldManager.superclass.constructor.call(this,"cat.meta_fields")}function SchemeSettingsManager(){SchemeSettingsManager.superclass.constructor.call(this,"cat.scheme_settings")}function DataObj(e,t){var n,i={};if(t instanceof DataProcessorsManager||t instanceof EnumManager||(n=t.get(e,!1,!0)),n)return e=null,n;this.__define({_ts_:{value:function(e){return i[e]||(i[e]=new TabularSection(e,this)),i[e]},configurable:!0},_manager:{value:t},_data:{value:{_is_new:!(this instanceof EnumObj)}},_obj:{value:{ref:t instanceof EnumManager?e.name:t instanceof RegisterManager?t.get_ref(e):$p.utils.fix_guid(e)}}}),t.alatable&&t.push&&(t.alatable.push(this._obj),t.push(this,this._obj.ref)),e=null}function CatObj(e,t){CatObj.superclass.constructor.call(this,e,t),this._data&&e&&"object"==typeof e&&(this._data._silent=!0,e._not_set_loaded?(delete e._not_set_loaded,this._mixin(e)):(this._mixin(e),$p.utils.is_empty_guid(this.ref)||!e.id&&!e.name||this._set_loaded(this.ref)),this._data._silent=!1)}function DocObj(e,t){var n="";DocObj.superclass.constructor.call(this,e,t),this.__define("presentation",{get:function(){return this.number_doc?(this._metadata.obj_presentation||this._metadata.synonym)+" №"+this.number_doc+" от "+$p.moment(this.date).format($p.moment._masks.ldt):n||""},set:function(e){e&&(n=String(e))}}),e&&"object"==typeof e&&(this._data._silent=!0,this._mixin(e),this._data._silent=!1),!$p.utils.is_empty_guid(this.ref)&&e.number_doc&&this._set_loaded(this.ref),e=null}function doc_props_date_number(e){e.__define({number_doc:{get:function(){return this._obj.number_doc||""},set:function(e){this.__notify("number_doc"),this._obj.number_doc=e},enumerable:!0},date:{get:function(){return this._obj.date||$p.utils.blank.date},set:function(e){this.__notify("date"),this._obj.date=$p.utils.fix_date(e,!0)},enumerable:!0}})}function DataProcessorObj(e,t){DataProcessorObj.superclass.constructor.call(this,e,t);var n,i=t.metadata();for(n in i.fields)e[n]||(e[n]=$p.utils.fetch_type("",i.fields[n].type));for(n in i.tabular_sections)e[n]||(e[n]=[]);this._mixin(e)}function TaskObj(e,t){TaskObj.superclass.constructor.call(this,e,t)}function BusinessProcessObj(e,t){BusinessProcessObj.superclass.constructor.call(this,e,t)}function EnumObj(e,t){EnumObj.superclass.constructor.call(this,e,t),e&&"object"==typeof e&&this._mixin(e)}function RegisterRow(e,t){RegisterRow.superclass.constructor.call(this,e,t),e&&"object"==typeof e&&this._mixin(e);for(var n in t.metadata().dimensions)if(!e.hasOwnProperty(n)&&e.ref){var i=e.ref.split("¶");Object.keys(t.metadata().dimensions).forEach(function(e,t){this[e]=i[t]}.bind(this));break}}function TabularSection(e,t){t._obj[e]||(t._obj[e]=[]),this.__define("_name",{value:e,enumerable:!1}),this.__define("_owner",{value:t,enumerable:!1}),this.__define("_obj",{value:t._obj[e],writable:!1,enumerable:!1})}function TabularSectionRow(e){var t={};this.__define("_owner",{value:e,enumerable:!1}),this.__define("_obj",{value:t,writable:!1,enumerable:!1})}function Rest(){this.filter_date=function(e,t,n){t||(t=new Date("2015-01-01"));var i=e+" gt datetime'"+$p.moment(t).format($p.moment._masks.iso)+"'";return n&&(i+=" and "+e+" lt datetime'"+$p.moment(n).format($p.moment._masks.iso)+"'"),i},this.to_data=function(e,t){var n,i,a,o,s,r,l={},c=t.metadata(),p=c.fields,d=c.tabular_sections;t instanceof RefDataManager?(e.hasOwnProperty("DeletionMark")&&(l._deleted=e.DeletionMark),e.hasOwnProperty("DataVersion"),e.hasOwnProperty("Ref_Key")&&(l.ref=e.Ref_Key)):p={}._mixin(c.dimensions)._mixin(c.resources)._mixin(c.attributes),t instanceof DocManager?(e.hasOwnProperty("Number")?l.number_doc=e.Number||e.number_doc:e.hasOwnProperty("number_doc")&&(l.number_doc=e.number_doc),e.hasOwnProperty("Date")?l.date=e.Date:e.hasOwnProperty("date")&&(l.date=e.date),e.hasOwnProperty("Posted")?l.posted=e.Posted:e.hasOwnProperty("posted")&&(l.posted=e.posted)):(c.main_presentation_name&&(e.hasOwnProperty("Description")?l.name=e.Description:e.hasOwnProperty("name")&&(l.name=e.name)),c.code_length&&(e.hasOwnProperty("Code")?l.id=e.Code:e.hasOwnProperty("id")&&(l.id=e.id)));for(i in p)if(e.hasOwnProperty(i))l[i]=e[i];else{if(s=_md.syns_1с(i),-1==s.indexOf("_Key")&&p[i].type.is_ref&&e[s+"_Key"]&&(s+="_Key"),!e.hasOwnProperty(s))continue;l[i]=e[s]}for(n in d)r="extra_fields"==n||e.hasOwnProperty(n)?n:_md.syns_1с(n),e.hasOwnProperty(r)&&(l[n]=[],e[r]&&(e[r].sort(function(e,t){return(e.LineNumber||e.row)>(t.LineNumber||t.row)}),e[r].forEach(function(e){o={};for(a in d[n].fields)s=e.hasOwnProperty(a)||"extra_fields"==n&&("property"==a||"value"==a)?a:_md.syns_1с(a),-1==s.indexOf("_Key")&&d[n].fields[a].type.is_ref&&e[s+"_Key"]&&(s+="_Key"),o[a]=e[s];l[n].push(o)})));return l},this.ajax_to_data=function(e,t){return $p.ajax.get_ex(e.url,e).then(function(e){return JSON.parse(e.response)}).then(function(e){var n=[];return e.value.forEach(function(e){n.push(_rest.to_data(e,t))}),n})},this.build_select=function(e,t){function n(e,i){"function"==typeof i?o+=i(t,e):(s=_md.syns_1с(e),(r=_md.get(t.class_name,e))&&(r=r.type,r.is_ref&&-1==s.indexOf("_Key")&&r.types.length&&-1==r.types[0].indexOf("enm.")&&(s+="_Key"),r.types.length&&(-1!=["boolean","number"].indexOf(typeof i)?o+=s+" eq "+i:r.is_ref&&"object"!=typeof i||i instanceof DataObj?o+=s+" eq guid'"+i+"'":"string"==typeof i?o+=s+" eq '"+i+"'":"object"==typeof i&&(i.hasOwnProperty("like")?o+=s+" like '%"+i.like+"%'":i.hasOwnProperty("not")?o+=" not ("+n(e,i.not)+") ":i.hasOwnProperty("in")&&(o+=s+" in ("+(r.is_ref?i.in.map(function(e){return"guid'"+e+"'"}).join(","):i.in.join(","))+") ")))))}function i(e){for(var t in e)if(o?o+=" and ":o="&$filter=","or"==t&&Array.isArray(e[t])){var i=!0;e[t].forEach(function(e){i?(o+=" ( ",i=!1):o+=" or ";var t=Object.keys(e)[0];n(t,e[t])}),o+=" ) "}else n(t,e[t])}var a,o,s,r,l="";e||(e={}),e.fields&&(e.fields.forEach(function(e){"ref"==e?s="Ref_Key":(s=_md.syns_1с(e),r=_md.get(t.class_name,e).type,r.is_ref&&-1==s.indexOf("_Key")&&r.types.length&&-1==r.types[0].indexOf("enm.")&&(s+="_Key")),a?a+=",":a="&$select=",a+=s}),l+=a),e.selection&&("function"==typeof e.selection||(Array.isArray(e.selection)?e.selection.forEach(i):i(e.selection)),o&&(l+=o)),$p.job_prm.rest&&-1==t.rest_name.indexOf("Module_")&&-1==t.rest_name.indexOf("DataProcessor_")&&-1==t.rest_name.indexOf("Report_")&&-1==l.indexOf(" like ")&&-1==l.indexOf(" in ")&&!t.metadata().irest?$p.ajax.default_attr(e,$p.job_prm.rest_url()):$p.ajax.default_attr(e,$p.job_prm.irest_url()),e.url+=t.rest_name+"?allowedOnly=true&$format=json&$top="+(e.top||300)+l},this.load_array=function(e,t){return _rest.build_select(e,t),_rest.ajax_to_data(e,t)},this.load_obj=function(e){var t={};return $p.ajax.default_attr(t,!e._metadata.irest&&$p.job_prm.rest?$p.job_prm.rest_url():$p.job_prm.irest_url()),t.url+=e._manager.rest_name+"(guid'"+e.ref+"')?$format=json",$p.ajax.get_ex(t.url,t).then(function(e){return JSON.parse(e.response)}).then(function(t){return e._mixin(_rest.to_data(t,e._manager))._set_loaded(),e}).catch(function(t){if(404==t.status)return e;$p.record_log(t)})},this.save_irest=function(e,t){var n=JSON.stringify(e),i=(void 0!=t.post?",post="+t.post:"")+(void 0!=t.operational?",operational="+t.operational:"");return $p.ajax.default_attr(t,$p.job_prm.irest_url()),t.url+=e._manager.rest_name+"(guid'"+e.ref+"'"+i+")",$p.ajax.post_ex(t.url,n,t).then(function(e){return JSON.parse(e.response)}).then(function(t){return e._mixin(t)})},this.save_rest=function(e,t){var n,i=e.to_atom();return $p.ajax.default_attr(t,$p.job_prm.rest_url()),n=t.url+e._manager.rest_name,t.url=n+"(guid'"+e.ref+"')?$format=json&$select=Ref_Key,DeletionMark",$p.ajax.get_ex(t.url,t).catch(function(e){return 404==e.status?{response:JSON.stringify({is_new:!0})}:Promise.reject(e)}).then(function(e){return JSON.parse(e.response)}).then(function(a){return a.is_new?$p.ajax.post_ex(n,i,t):$p.ajax.patch_ex(n+"(guid'"+e.ref+"')",i,t)}).then(function(t){var n=xmlToJSON.parseString(t.response,{mergeCDATA:!1,grokAttr:!0,grokText:!1,normalize:!0,xmlns:!1,namespaceKey:"_ns",textKey:"_text",valueKey:"_value",attrKey:"_attr",cdataKey:"_cdata",attrsAsObject:!1,stripAttrPrefix:!0,stripElemPrefix:!0,childrenAsArray:!1});if(n.entry&&n.entry.content&&n.entry.updated){var i,a=n.entry.content.properties,o={};for(var s in a)if(0!=s.indexOf("_"))if(i=a[s].element)if(o[s]=[],Array.isArray(i))for(var r in i){o[s][r]={};for(var l in i[r])0!=l.indexOf("_")&&(o[s][r][l]="false"!==i[r][l]._text&&i[r][l]._text)}else{o[s][0]={};for(var l in i)0!=l.indexOf("_")&&(o[s][0][l]="false"!==i[l]._text&&i[l]._text)}else o[s]="false"!==a[s]._text&&a[s]._text;return _rest.to_data(o,e._manager)}}).then(function(t){return e._mixin(t)})}}function eXcell_ocombo(e){if(e){var t=this;t.cell=e,t.grid=e.parentNode.grid,t.setValue=function(e){t.setCValue(e instanceof DataObj?e.presentation:e||"")},t.getValue=function(){return t.grid.get_cell_value()},t.shiftNext=function(){t.grid.editStop()},t.edit=function(){t.combo||(t.val=t.getValue(),t.cell.innerHTML="",t.combo=new OCombo({parent:t.cell,grid:t.grid}._mixin(t.grid.get_cell_field())),t.combo.getInput().focus())},t.open_selection=function(){t.edit(),t.combo&&t.combo.open_selection&&t.combo.open_selection()},t.detach=function(){if(t.combo){if(t.combo.getComboText){t.setValue(t.combo.getComboText()),t.combo.getSelectedValue()||t.combo.callEvent("onChange");var e=!$p.utils.is_equal(t.val,t.getValue());return t.combo.unload(),e}t.combo.unload&&t.combo.unload()}return!0}}}function eXcell_pwd(e){var t;e&&(this.cell=e,this.grid=e.parentNode.grid,eXcell_ed.call(this),t=this.edit,this.edit=function(){t.call(this),this.obj.type="password"},this.setValue=function(){this.setCValue("*********")},this.getValue=function(){return this.grid.get_cell_value()},this.detach=function(){if(this.grid.get_cell_field){var e=this.grid.get_cell_field();e.obj[e.field]=this.obj.value}return this.setValue(),t=null,this.val!=this.getValue()})}function ODropdownList(e){function t(t){o.innerHTML=e.values[o.getAttribute("current")],e.event_name&&!t&&dhx4.callEvent(e.event_name,[o.getAttribute("current")])}function n(){a.classList.remove("open")}var i,a,o,s=document.createElement("ul");e.container.innerHTML='<div class="dropdown_list">'+e.title+'<a href="#" class="dropdown_list"></a></div>',a=e.container.firstChild,o=a.querySelector("a"),o.setAttribute("current",Array.isArray(e.values)?"0":Object.keys(e.values)[0]),a.onclick=function(e){if(a.classList.contains("open")){if("LI"==e.target.tagName)for(var i in s.childNodes)if(s.childNodes[i]==e.target){o.setAttribute("current",e.target.getAttribute("current")),t();break}n()}else a.classList.add("open");return $p.iface.cancel_bubble(e)},a.appendChild(s),s.className="dropdown_menu",e.class_name&&(a.classList.add(e.class_name),s.classList.add(e.class_name));for(var r in e.values){i=document.createElement("li");var l=e.values[r].indexOf("<i");i.innerHTML=e.values[r].substr(l)+" "+e.values[r].substr(0,l),i.setAttribute("current",r),s.appendChild(i)}document.body.addEventListener("keydown",function(e){27==e.keyCode&&a.classList.remove("open")}),document.body.addEventListener("click",n),this.unload=function(){for(var t;t=a.lastChild;)a.removeChild(t);e.container.removeChild(a),i=s=a=o=e=null},t(!0)}function OCombo(e){function t(t){var n={_top:30};return f&&f.metadata().hierarchical&&f.metadata().group_hierarchy&&("elm"==u.choice_groups_elm?n.is_folder=!1:"grp"!=u.choice_groups_elm&&"parent"!=d||(n.is_folder=!0)),u.choice_links&&u.choice_links.forEach(function(e){if(e.name&&"selection"==e.name[0])if(p instanceof TabularSectionRow)if(e.path.length<2)n[e.name[1]]="function"==typeof e.path[0]?e.path[0]:p._owner._owner[e.path[0]];else{if("owner"==e.name[1]&&!f.metadata().has_owners)return;n[e.name[1]]=p[e.path[1]]}else n[e.name[1]]="function"==typeof e.path[0]?e.path[0]:p[e.path[0]]}),u.choice_params&&u.choice_params.forEach(function(e){var t=Array.isArray(e.path)?{in:e.path}:e.path;n[e.name]?Array.isArray(n[e.name])?n[e.name].push(t):(n[e.name]=[n[e.name]],n[e.name].push(t)):n[e.name]=t}),u._option_list_local&&(n._local=!0),t&&(n.presentation={like:t}),
e.property&&e.property.filter_params_links&&e.property.filter_params_links(n,e),n}function n(i){if("select"==this.name)f?f.form_selection(g,{initial_value:p[d].ref,selection:[t()]}):n.call({name:"type"});else if("add"==this.name)f&&f.create({},!0).then(function(t){t._set_loaded(t.ref),t.form_obj(e.pwnd)});else if("open"==this.name)p&&p[d]&&!p[d].empty()&&p[d].form_obj(e.pwnd);else if(u&&"type"==this.name){var a,o,s=[],r=p,l=d;u.type.types.forEach(function(e){a=_md.mgr_by_class_name(e),o=a.metadata(),s.push({presentation:o.synonym||o.name,mgr:a,selected:f===a})}),$p.iface.select_from_list(s).then(function(e){r[l]&&(r[l].empty&&r[l].empty()||r[l]._manager!=e.mgr)&&(f=e.mgr,p=r,d=l,u=p._metadata.fields[d],f.form_selection({on_select:function(e){p[d]=e,p=null,d=null,u=null}},{selection:[t()]})),f=null,a=null,o=null,r=null,l=null})}if(i)return $p.iface.cancel_bubble(i)}function i(){_=!1,setTimeout(function(){_||($p.iface.popup.p&&$p.iface.popup.p.onmouseover&&($p.iface.popup.p.onmouseover=null),$p.iface.popup.p&&$p.iface.popup.p.onmouseout&&($p.iface.popup.p.onmouseout=null),$p.iface.popup.clear(),$p.iface.popup.hide())},300)}function a(){if(f&&f.class_name&&!(f instanceof EnumManager)){_=!0;var t=document.createElement("div"),a=e.hide_frm?"":"<a href='#' name='select' title='Форма выбора {F4}'>Показать все</a><a href='#' name='open' style='margin-left: 9px;' title='Открыть форму элемента {Ctrl+Shift+F4}'><i class='fa fa-external-link fa-fw'></i></a>";if(!e.hide_frm){-1!=$p.current_user.get_acl(f.class_name).indexOf("i")&&(a+="&nbsp;<a href='#' name='add' title='Создать новый элемент {F8}'><i class='fa fa-plus fa-fwfa-fw'></i></a>")}if(u.type.types.length>1&&(a+="&nbsp;<a href='#' name='type' title='Выбрать тип значения {Alt+T}'><i class='fa fa-level-up fa-fw'></i></a>"),a){t.innerHTML=a;for(var o=0;o<t.children.length;o++)t.children[o].onclick=n;$p.iface.popup.clear(),$p.iface.popup.attachObject(t),$p.iface.popup.show(dhx4.absLeft(h.getButton())-77,dhx4.absTop(h.getButton()),h.getButton().offsetWidth,h.getButton().offsetHeight),$p.iface.popup.p.onmouseover=function(){_=!0},$p.iface.popup.p.onmouseout=i}}}function o(e){return setTimeout(a,10),e.preventDefault(),!1}function s(n){if(f&&!(f instanceof EnumManager))return 115==n.keyCode?(n.ctrlKey&&n.shiftKey?p[d].empty()||p[d].form_obj(e.pwnd):n.ctrlKey||n.shiftKey||f&&f.form_selection(g,{initial_value:p[d].ref,selection:[t()]}),$p.iface.cancel_bubble(n)):void 0}function r(e){setTimeout(function(){h&&h.getInput&&h.getInput().select()},50)}function l(e){h&&h.getBase&&(h.getBase().parentElement?p instanceof TabularSectionRow||e.forEach(function(e){e.name==d&&c(p[d])}):setTimeout(h.unload))}function c(e){if(e&&e instanceof DataObj&&!e.empty()){if(h.getOption(e.ref)||h.addOption(e.ref,e.presentation),h.getSelectedValue()==e.ref)return;h.setComboValue(e.ref)}else h.getSelectedValue()||(h.setComboValue(""),h.setComboText(""))}var p,d,u,f,m,_,h=this,g={on_select:e.on_select||function(e){p[d]=e}};e.pwnd&&e.pwnd.setModal&&(g.setModal=e.pwnd.setModal.bind(e.pwnd)),OCombo.superclass.constructor.call(h,e),e.on_select?(h.getBase().style.border="none",h.getInput().style.left="-3px",e.is_tabular||(h.getButton().style.right="9px")):h.getBase().style.marginBottom="4px",e.left&&(h.getBase().style.left=left+"px"),this.attachEvent("onChange",function(){if(p&&d){var e=this.getSelectedValue();!e&&this.getComboText()&&(e=this.getOptionByLabel(this.getComboText()),e?e=e.value:this.setComboText("")),p[d]=e}}),this.attachEvent("onBlur",function(){!this.getSelectedValue()&&this.getComboText()&&this.setComboText("")}),this.attachEvent("onDynXLS",function(n){u&&(f||(f=_md.value_mgr(p,d,u.type)),f&&(h.clearAll(),(e.get_option_list||f.get_option_list).call(f,null,t(n)).then(function(e){h.addOption&&(h.addOption(e),h.openSelect())})))}),h.getButton().addEventListener("mouseover",a),h.getButton().addEventListener("mouseout",i),h.getBase().addEventListener("click",$p.iface.cancel_bubble),h.getBase().addEventListener("contextmenu",o),h.getInput().addEventListener("keyup",s),h.getInput().addEventListener("focus",r),this.attach=function(e){p&&(p instanceof TabularSectionRow?Object.unobserve(p._owner._owner,l):Object.unobserve(p,l)),p=e.obj,d=e.field,m=e.property,e.metadata?u=e.metadata:m?(u=p._metadata.fields[d]._clone(),u.type=m.type):u=p._metadata.fields[d],h.clearAll(),f=_md.value_mgr(p,d,u.type),(f||e.get_option_list)&&(e.get_option_list||f.get_option_list).call(f,p[d],t()).then(function(e){h.addOption&&(h.addOption(e),c(p[d]))}),p instanceof TabularSectionRow?Object.observe(p._owner._owner,l,["row"]):Object.observe(p,l,["update"])},this.open_selection=function(){n.call({name:"select"})};var b=this.unload;this.unload=function(){i(),h.getButton().removeEventListener("mouseover",a),h.getButton().removeEventListener("mouseout",i),h.getBase().removeEventListener("click",$p.iface.cancel_bubble),h.getBase().removeEventListener("contextmenu",o),h.getInput().removeEventListener("keyup",s),h.getInput().removeEventListener("focus",r),p&&(p instanceof TabularSectionRow?Object.unobserve(p._owner._owner,l):Object.unobserve(p,l)),h.conf&&h.conf.tm_confirm_blur&&clearTimeout(h.conf.tm_confirm_blur),p=null,d=null,u=null,f=null,g=null;try{b.call(h)}catch(e){}},e.obj&&e.field&&this.attach(e),this.enableFilteringMode("between","dummy",!1,!1),this.__define({value:{get:function(){if(p)return p[d]}}})}function ODateRangePicker(e,t){var n=this._cont=document.createElement("div");e instanceof dhtmlXCellObject?e.appendObject(this._cont):e.appendChild(this._cont),this._cont.className="odaterangepicker",this._cont.innerHTML='<i class="fa fa-calendar"></i>&nbsp; <span></span> &nbsp;<i class="fa fa-caret-down"></i>',this.__define({set_text:{value:function(){$("span",n).html(this.date_from.format("DD MMM YY")+" - "+this.date_till.format("DD MMM YY"))}},on:{value:function(e,t){return $(n).on(e,t)}},date_from:{get:function(){return $(n).data("daterangepicker").startDate},set:function(e){$(n).data("daterangepicker").setStartDate(e),this.set_text()}},date_till:{get:function(){return $(n).data("daterangepicker").endDate},set:function(e){$(n).data("daterangepicker").setEndDate(e),this.set_text()}}}),$(n).daterangepicker({startDate:t.date_from?moment(t.date_from):moment().subtract(29,"days"),endDate:moment(t.date_till),showDropdowns:!0,alwaysShowCalendars:!0,opens:"left",ranges:{"Сегодня":[moment(),moment()],"Вчера":[moment().subtract(1,"days"),moment().subtract(1,"days")],"Последние 7 дней":[moment().subtract(6,"days"),moment()],"Последние 30 дней":[moment().subtract(29,"days"),moment()],"Этот месяц":[moment().startOf("month"),moment().endOf("month")],"Прошлый месяц":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]}},this.set_text.bind(this)),this.set_text()}function _clear_all(){$p.iface.docs.__define({clear_all:{value:function(){this.detachToolbar(),this.detachStatusBar(),this.detachObject(!0)},enumerable:!1},"Очистить":{get:function(){return this.clear_all},enumerable:!1},"Контейнер":{get:function(){return this.cell.querySelector(".dhx_cell_cont_layout")},enumerable:!1}})}function OTooolBar(e){function t(e){for(var t=0;t<c.children.length;t++)c.children[t].classList.remove("selected");e&&!this.classList.contains("selected")&&this.classList.add("selected")}function n(){o=!1,setTimeout(function(){o||$p.iface.popup.hide()},300)}function i(){e.onclick&&e.onclick.call(l,this.name.replace(e.name+"_",""),e.name)}var a,o,s,r,l=this,c=document.createElement("div");e.image_path||(e.image_path=dhtmlx.image_path),e.hasOwnProperty("class_name")?c.className=e.class_name:c.className="md_otooolbar",l.cell=c,l.buttons={},this.add=function(t){function p(e){if(e||(e=d),e.subdiv&&!s&&!r){for(;e.subdiv.firstChild;)e.subdiv.removeChild(e.subdiv.firstChild);e.subdiv.parentNode.removeChild(e.subdiv),e.subdiv=null}}var d=$p.iface.add_button(c,e,t);d.onclick=i,d.onmouseover=function(){t.title&&!t.sub&&(o=!0,$p.iface.popup.clear(),$p.iface.popup.attachHTML(t.title),$p.iface.popup.show(dhx4.absLeft(d),dhx4.absTop(d),d.offsetWidth,d.offsetHeight),$p.iface.popup.p.onmouseover=function(){o=!0},$p.iface.popup.p.onmouseout=n,e.on_popup&&e.on_popup($p.iface.popup,d))},d.onmouseout=n,l.buttons[t.name]=d,t.sub&&(d.onmouseover=function(){for(var n=0;n<d.parentNode.children.length;n++)if(d.parentNode.children[n]!=d&&d.parentNode.children[n].subdiv){p(d.parentNode.children[n]);break}if(r=!0,!this.subdiv){this.subdiv=document.createElement("div"),this.subdiv.className="md_otooolbar",a=$p.iface.get_offset(d),"right"==t.sub.align?this.subdiv.style.left=a.left+d.offsetWidth-(parseInt(t.sub.width.replace(/\D+/g,""))||56)+"px":this.subdiv.style.left=a.left+"px",this.subdiv.style.top=a.top+c.offsetHeight+"px",this.subdiv.style.height=t.sub.height||"198px",this.subdiv.style.width=t.sub.width||"56px";for(var n in t.sub.buttons){$p.iface.add_button(this.subdiv,e,t.sub.buttons[n]).onclick=i}e.wrapper.appendChild(this.subdiv),this.subdiv.onmouseover=function(){s=!0},this.subdiv.onmouseout=function(){s=!1,setTimeout(p,500)},t.title&&$p.iface.popup.show(dhx4.absLeft(this.subdiv),dhx4.absTop(this.subdiv),this.subdiv.offsetWidth,this.subdiv.offsetHeight)}},d.onmouseout=function(){r=!1,setTimeout(p,500)})},this.select=function(n){for(var i=0;i<c.children.length;i++){var a=c.children[i];if(a.name==e.name+"_"+n)return void t.call(a,!0)}},this.get_selected=function(){for(var e=0;e<c.children.length;e++){var t=c.children[e];if(t.classList.contains("selected"))return t.name}},this.unload=function(){for(;c.firstChild;)c.removeChild(c.firstChild);e.wrapper.removeChild(c)},e.wrapper.appendChild(c),c.style.width=e.width||"28px",c.style.height=e.height||"150px",c.style.position="absolute",e.top&&(c.style.top=e.top),e.left&&(c.style.left=e.left),e.bottom&&(c.style.bottom=e.bottom),e.right&&(c.style.right=e.right),e.paddingRight&&(c.style.paddingRight=e.paddingRight),e.paddingLeft&&(c.style.paddingLeft=e.paddingLeft),e.buttons&&e.buttons.forEach(function(e){l.add(e)})}function AppEvents(){if(this.__define({init:{value:function(){$p.__define("job_prm",{value:new JobPrm,writable:!1}),$p.wsql.init_params()}},do_eventable:{value:function(e){function t(e,t){e=String(e).toLowerCase(),this._evnts.data[e]||(this._evnts.data[e]={});var n=$p.utils.generate_guid();return this._evnts.data[e][n]=t,n}function n(e){if(!e)return i.call(this);for(var t in this._evnts.data){var n=0;for(var a in this._evnts.data[t])a==e?(this._evnts.data[t][a]=null,delete this._evnts.data[t][a]):n++;0==n&&(this._evnts.data[t]=null,delete this._evnts.data[t])}}function i(){for(var e in this._evnts.data){for(var t in this._evnts.data[e])this._evnts.data[e][t]=null,delete this._evnts.data[e][t];this._evnts.data[e]=null,delete this._evnts.data[e]}}function a(e,t){if(e=String(e).toLowerCase(),null==this._evnts.data[e])return!0;var n=!0;for(var i in this._evnts.data[e])n=this._evnts.data[e][i].apply(this,t)&&n;return n}function o(){for(var e in this._evnts.evnts){var t=this._evnts.evnts[e].length;if(t){for(var n=0;n<t;n++)this.emit(e,this._evnts.evnts[e][n]);this._evnts.evnts[e].length=0}}this._evnts.timer=0}e.__define({_evnts:{value:{data:{},timer:0,evnts:{}}},on:{value:t},attachEvent:{value:t},off:{value:n},detachEvent:{value:n},detachAllEvents:{value:i},checkEvent:{value:function(e){return e=String(e).toLowerCase(),null!=this._evnts.data[e]}},callEvent:{value:a},emit:{value:a},emit_async:{value:function(e,t){this._evnts.evnts[e]||(this._evnts.evnts[e]=[]),this._evnts.evnts[e].push(t),this._evnts.timer&&clearTimeout(this._evnts.timer),this._evnts.timer=setTimeout(o.bind(this),4)}}})}}}),"undefined"!=typeof window&&window.dhx4){for(var e in dhx4)this[e]=dhx4[e],delete dhx4[e];window.dhx4=this}else"undefined"==typeof WorkerGlobalScope&&this.do_eventable(this)}function JobPrm(){this.__define({offline:{value:!1,writable:!0},local_storage_prefix:{value:"",writable:!0},create_tables:{value:!0,writable:!0},url_prm:{value:"undefined"!=typeof window?this.parse_url():{}}}),$p.eve.callEvent("settings",[this]);for(var e in this)"url_prm"!==e&&"function"!=typeof this[e]&&this.url_prm.hasOwnProperty[e]&&(this[e]=this.url_prm[e])}function Modifiers(){var e=[];this.push=function(t){e.push(t)},this.detache=function(t){var n=e.indexOf(t);-1!=n&&e.splice(n,1)},this.clear=function(){e.length=0},this.execute=function(t){var n,i;return e.forEach(function(e){i="function"==typeof e?e(t):$p.injected_data[e](t),!1!==n&&(n=i)}),n},this.execute_external=function(e){var t=$p.wsql.get_user_param("modifiers");return t=t?t.split("\n").map(function(e){return e?new Promise(function(t,n){$p.load_script(e,"script",t)}):Promise.resolve()}):[],Promise.all(t).then(function(){this.execute(e)}.bind(this))}}function IPInfo(){function e(){this.geocode=function(e){return Promise.resolve(!1)}}var t,n,i,a="";this.__define({ipgeo:{value:function(){return $p.ajax.get("//api.sypexgeo.net/").then(function(e){return JSON.parse(e.response)}).catch($p.record_log)}},yageocoder:{get:function(){return t||(t=new e),t},enumerable:!1,configurable:!1},ggeocoder:{get:function(){return n},enumerable:!1,configurable:!1},addr:{get:function(){return a}},parts:{get:function(){return i}},components:{value:function(e,t){var n,i,a,o="",s="",r="";for(n in t){i=t[n];for(a in i.types)switch(i.types[a]){case"route":-1==i.short_name.indexOf("Unnamed")&&(o=i.short_name+(o?" "+o:""),s=i.long_name.replace("улица","").trim());break;case"administrative_area_level_1":e.region=i.long_name;break;case"administrative_area_level_2":e.city=i.short_name,e.city_long=i.long_name;break;case"locality":r=(r?r+" ":"")+i.short_name;break;case"street_number":e.house="дом "+i.short_name;break;case"postal_code":e.postal_code=i.short_name}}return e.region&&e.region==e.city_long?-1==e.city.indexOf(r)?e.city=r:e.city="":r&&-1==e.city.indexOf(r)&&-1==e.region.indexOf(r)&&(o=r+", "+o),e.street&&-1!=e.street.indexOf(s)||(e.street=o),e}},location_callback:{value:function(){n=new google.maps.Geocoder,$p.eve.callEvent("geo_google_ready"),navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){$p.ipinfo.latitude=e.coords.latitude,$p.ipinfo.longitude=e.coords.longitude;var t=new google.maps.LatLng($p.ipinfo.latitude,$p.ipinfo.longitude);n.geocode({latLng:t},function(e,t){t==google.maps.GeocoderStatus.OK&&(i=!e[1]||e[0].address_components.length>=e[1].address_components.length?e[0]:e[1],a=i.formatted_address,$p.eve.callEvent("geo_current_position",[$p.ipinfo.components({},i.address_components)]))})},$p.record_log,{timeout:3e4})}}})}function SpreadsheetDocument(e,t){this._attr={orientation:"portrait",title:"",content:document.createElement("DIV")},e&&"string"==typeof e?this.content=e:"object"==typeof e&&this._mixin(e),e=null,this._events={fill_template:null},t&&"object"==typeof t&&this._events._mixin(t)}function HandsontableDocument(e,t){var n=function(){this._then&&this._then(this)}.bind(this);this._online=t&&t.allow_offline||navigator.onLine&&$p.wsql.pouch.authorized,e instanceof dhtmlXCellObject?(this._cont=document.createElement("div"),e.detachObject(!0),e.attachObject(this._cont)):this._cont=e,this._cont.classList.add("handsontable_wrapper"),this._online?this._cont.innerHTML=t.autorun?$p.msg.report_prepare:$p.msg.report_need_prepare:this._cont.innerHTML=$p.msg.report_need_online,this.then=function(e){return this._then=e,this},this.requery=function(e){this.hot&&this.hot.destroy(),e instanceof Error?this._cont.innerHTML=$p.msg.report_error+(e.name?" <b>"+e.name+"</b>":"")+(e.message?" "+e.message:""):(this._cont.innerHTML="",this.hot=new Handsontable(this._cont,e))},"function"!=typeof Handsontable&&this._online?$p.load_script("https://cdnjs.cloudflare.com/ajax/libs/pikaday/1.4.0/pikaday.min.js","script").then(function(){return $p.load_script("https://cdnjs.cloudflare.com/ajax/libs/numbro/1.9.2/numbro.min.js","script")}).then(function(){return $p.load_script("https://cdn.jsdelivr.net/g/zeroclipboard,handsontable@0.26(handsontable.min.js)","script")}).then(function(){return Promise.all([$p.load_script("https://cdn.jsdelivr.net/handsontable/0.26/handsontable.min.css","link"),$p.load_script("https://cdnjs.cloudflare.com/ajax/libs/numbro/1.9.2/languages/ru-RU.min.js","script")])}).then(n):setTimeout(n)}function Aes(e){"use strict";function t(e){return encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)})}function n(e){try{return decodeURIComponent(escape(e))}catch(t){return e}}function i(e){if("undefined"!=typeof btoa)return btoa(e);if("undefined"!=typeof Buffer)return new Buffer(e,"binary").toString("base64");throw new Error("No Base64 Encode")}function a(e){if("undefined"!=typeof atob)return atob(e);if("undefined"!=typeof Buffer)return new Buffer(e,"base64").toString("binary");throw new Error("No Base64 Decode")}var o=this;o.cipher=function(e,t){for(var n=t.length/4-1,i=[[],[],[],[]],a=0;a<16;a++)i[a%4][Math.floor(a/4)]=e[a];i=o.addRoundKey(i,t,0,4);for(var s=1;s<n;s++)i=o.subBytes(i,4),i=o.shiftRows(i,4),i=o.mixColumns(i,4),i=o.addRoundKey(i,t,s,4);i=o.subBytes(i,4),i=o.shiftRows(i,4),i=o.addRoundKey(i,t,n,4);for(var r=new Array(16),a=0;a<16;a++)r[a]=i[a%4][Math.floor(a/4)];return r},o.keyExpansion=function(e){for(var t=e.length/4,n=t+6,i=new Array(4*(n+1)),a=new Array(4),s=0;s<t;s++){var r=[e[4*s],e[4*s+1],e[4*s+2],e[4*s+3]];i[s]=r}for(var s=t;s<4*(n+1);s++){i[s]=new Array(4);for(var l=0;l<4;l++)a[l]=i[s-1][l];if(s%t==0){a=o.subWord(o.rotWord(a));for(var l=0;l<4;l++)a[l]^=o.rCon[s/t][l]}else t>6&&s%t==4&&(a=o.subWord(a));for(var l=0;l<4;l++)i[s][l]=i[s-t][l]^a[l]}return i},o.subBytes=function(e,t){for(var n=0;n<4;n++)for(var i=0;i<t;i++)e[n][i]=o.sBox[e[n][i]];return e},o.shiftRows=function(e,t){for(var n=new Array(4),i=1;i<4;i++){for(var a=0;a<4;a++)n[a]=e[i][(a+i)%t];for(var a=0;a<4;a++)e[i][a]=n[a]}return e},o.mixColumns=function(e,t){for(var n=0;n<4;n++){for(var i=new Array(4),a=new Array(4),o=0;o<4;o++)i[o]=e[o][n],a[o]=128&e[o][n]?e[o][n]<<1^283:e[o][n]<<1;e[0][n]=a[0]^i[1]^a[1]^i[2]^i[3],e[1][n]=i[0]^a[1]^i[2]^a[2]^i[3],e[2][n]=i[0]^i[1]^a[2]^i[3]^a[3],e[3][n]=i[0]^a[0]^i[1]^i[2]^a[3]}return e},o.addRoundKey=function(e,t,n,i){for(var a=0;a<4;a++)for(var o=0;o<i;o++)e[a][o]^=t[4*n+o][a];return e},o.subWord=function(e){for(var t=0;t<4;t++)e[t]=o.sBox[e[t]];return e},o.rotWord=function(e){for(var t=e[0],n=0;n<3;n++)e[n]=e[n+1];return e[3]=t,e},o.sBox=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],o.rCon=[[0,0,0,0],[1,0,0,0],[2,0,0,0],[4,0,0,0],[8,0,0,0],[16,0,0,0],[32,0,0,0],[64,0,0,0],[128,0,0,0],[27,0,0,0],[54,0,0,0]],o.Ctr={},o.Ctr.encrypt=function(n,a,s){128!=s&&192!=s&&256!=s&&(s=128),n=t(n),a=t(a||e);for(var r=s/8,l=new Array(r),c=0;c<r;c++)l[c]=c<a.length?a.charCodeAt(c):0;var p=o.cipher(l,o.keyExpansion(l));p=p.concat(p.slice(0,r-16));for(var d=new Array(16),u=(new Date).getTime(),f=u%1e3,m=Math.floor(u/1e3),_=Math.floor(65535*Math.random()),c=0;c<2;c++)d[c]=f>>>8*c&255;for(var c=0;c<2;c++)d[c+2]=_>>>8*c&255;for(var c=0;c<4;c++)d[c+4]=m>>>8*c&255;for(var h="",c=0;c<8;c++)h+=String.fromCharCode(d[c]);for(var g=o.keyExpansion(p),b=Math.ceil(n.length/16),x="",v=0;v<b;v++){for(var y=0;y<4;y++)d[15-y]=v>>>8*y&255;for(var y=0;y<4;y++)d[15-y-4]=v/4294967296>>>8*y;for(var w=o.cipher(d,g),$=v<b-1?16:(n.length-1)%16+1,j=new Array($),c=0;c<$;c++)j[c]=w[c]^n.charCodeAt(16*v+c),j[c]=String.fromCharCode(j[c]);x+=j.join(""),"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&v%1e3==0&&self.postMessage({progress:v/b})}return x=i(h+x)},o.Ctr.decrypt=function(i,s,r){128!=r&&192!=r&&256!=r&&(r=128),i=a(i),s=t(s||e);for(var l=r/8,c=new Array(l),p=0;p<l;p++)c[p]=p<s.length?s.charCodeAt(p):0;var d=o.cipher(c,o.keyExpansion(c));d=d.concat(d.slice(0,l-16));for(var u=new Array(8),f=i.slice(0,8),p=0;p<8;p++)u[p]=f.charCodeAt(p);for(var m=o.keyExpansion(d),_=Math.ceil((i.length-8)/16),h=new Array(_),g=0;g<_;g++)h[g]=i.slice(8+16*g,8+16*g+16);i=h;for(var b="",g=0;g<_;g++){for(var x=0;x<4;x++)u[15-x]=g>>>8*x&255;for(var x=0;x<4;x++)u[15-x-4]=(g+1)/4294967296-1>>>8*x&255;for(var v=o.cipher(u,m),y=new Array(i[g].length),p=0;p<i[g].length;p++)y[p]=v[p]^i[g].charCodeAt(p),y[p]=String.fromCharCode(y[p]);b+=y.join(""),"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&g%1e3==0&&self.postMessage({progress:g/_})}return b=n(b)}}Object.defineProperties(Object.prototype,{__define:{value:function(e,t){return t?Object.defineProperty(this,e,t):Object.defineProperties(this,e),this}},_extend:{value:function(e){var t=function(){};t.prototype=e.prototype,this.prototype=new t,this.prototype.constructor=this,this.__define("superclass",{value:e.prototype,enumerable:!1})}},_mixin:{value:function(e,t,n){var i,a,o={};if(t&&t.length)for(i=0;i<t.length;i++)a=t[i],n&&-1!=n.indexOf(a)||void 0!==o[a]&&o[a]==e[a]||(this[a]=e[a]);else for(a in e)n&&-1!=n.indexOf(a)||void 0!==o[a]&&o[a]==e[a]||(this[a]=e[a]);return this}},_clone:{value:function(e,t){if(!this||"object"!=typeof this)return this;var n,i,a="function"==typeof this.pop?[]:{};for(n in this)e&&-1!=e.indexOf(n)||this.hasOwnProperty(n)&&(i=this[n],i?"function"==typeof i||i instanceof DataObj||i instanceof DataManager?a[n]=i:"object"==typeof i?i instanceof Date?a[n]=t?i.toJSON():i:a[n]=i._clone(e,t):a[n]=i:a[n]=i);return a}}}),Date.prototype.toJSON=function(){return $p.moment(this).format($p.moment._masks.iso)},Number.prototype.round||(Number.prototype.round=function(e){var t=Math.pow(10,e);return Math.round(this*t)/t}),Number.prototype.pad||(Number.prototype.pad=function(e){for(var t=String(this);t.length<(e||2);)t="0"+t;return t}),Object.observe||Object.unobserve||Object.getNotifier||Object.prototype.__define({observe:{value:function(e,t){e&&(e._observers||e.__define({_observers:{value:[],enumerable:!1},_notis:{value:[],enumerable:!1}}),e._observers.push(t))},enumerable:!1},unobserve:{value:function(e,t){if(e&&e._observers){t||(e._observers.length=0);for(var n=0;n<e._observers.length;n++)if(e._observers[n]===t){e._observers.splice(n,1);break}}},enumerable:!1},getNotifier:{value:function(e){var t;return{notify:function(n){e._observers&&n&&(n.object||(n.object=e),e._notis.push(n),n=null,t&&clearTimeout(t),t=setTimeout(function(){e._notis.length&&(e._observers.forEach(function(t){t(e._notis)}),e._notis.length=0),t=!1},4))}}},enumerable:!1}});var $p=new MetaEngine;$p.__define({iface:{value:new InterfaceObjs,writable:!1},current_user:{get:function(){return $p.CatUsers&&!$p.CatUsers.prototype.hasOwnProperty("role_available")&&$p.CatUsers.prototype.__define({role_available:{value:function(e){return!0}},get_acl:{value:function(e){return"rvuidepo"}}}),$p.cat&&$p.cat.users?$p.cat.users.by_id($p.wsql.get_user_param("user_name")):$p.utils.blank.guid}},load_script:{value:function(e,t,n){return new Promise(function(i,a){var o=document.createElement(t);"script"==t?(o.type="text/javascript",o.src=e,o.async=!0,o.addEventListener("load",n?function(){n(),i()}:i,!1)):(o.type="text/css",o.rel="stylesheet",o.href=e),document.head.appendChild(o),"script"!=t&&i()})}}}),$p.utils.__define({docxtemplater:{value:function(e){return(window.Docxtemplater?Promise.resolve():Promise.all([$p.load_script("https://cdn.jsdelivr.net/jszip/2/jszip.min.js","script"),$p.load_script("https://cdn.jsdelivr.net/combine/gh/open-xml-templating/docxtemplater-build/build/docxtemplater-latest.min.js,gh/open-xml-templating/docxtemplater-image-module-build/build/docxtemplater-image-module-latest.min.js","script")])).then(function(){return Docxtemplater.prototype.saveAs||(Docxtemplater.prototype.saveAs=function(e){var t=this.getZip().generate({type:"blob",mimeType:$p.utils.mime_lookup("docx")});$p.wsql.alasql.utils.saveAs(t,e)}),$p.utils.blob_as_text(e,"array")}).then(function(e){return(new Docxtemplater).loadZip(new JSZip(e))})}}}),"undefined"!=typeof window&&window.dhx4&&(dhx4.dateFormat.ru="%d.%m.%Y",dhx4.dateLang="ru",dhx4.dateStrings={ru:{monthFullName:["Январь","Февраль","Март","Апрель","Maй","Июнь","Июль","Август","Сентябрь","Oктябрь","Ноябрь","Декабрь"],monthShortName:["Янв","Фев","Maр","Aпр","Maй","Июн","Июл","Aвг","Сен","Окт","Ноя","Дек"],dayFullName:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],dayShortName:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"]}}),function(e){e.store_url_od="https://chrome.google.com/webstore/detail/hcncallbdlondnoadgjomnhifopfaage",e.argument_is_not_ref="Аргумент не является ссылкой",e.addr_title="Ввод адреса",e.cache_update_title="Обновление кеша браузера",e.cache_update="Выполняется загрузка измененных файлов<br/>и их кеширование в хранилище браузера",e.cancel="Отмена",e.delivery_area_empty="Укажите район доставки",e.empty_login_password="Не указаны имя пользователя или пароль",e.empty_response="Пустой ответ сервера",e.empty_geocoding="Пустой ответ геокодера. Вероятно, отслеживание адреса запрещено в настройках браузера",e.error_geocoding="Ошибка геокодера",e.error_auth="Авторизация пользователя не выполнена",e.error_critical="Критическая ошибка",e.error_metadata="Ошибка загрузки метаданных конфигурации",e.error_network="Ошибка сети или сервера - запрос отклонен",e.error_rights="Ограничение доступа",e.error_low_acl="Недостаточно прав для выполнения операции",e.file_size="Запрещена загрузка файлов<br/>размером более ",e.file_confirm_delete="Подтвердите удаление файла ",e.file_new_date="Файлы на сервере обновлены<br /> Рекомендуется закрыть браузер и войти<br />повторно для применения обновления",e.file_new_date_title="Версия файлов",e.init_catalogues="Загрузка справочников с сервера",e.init_catalogues_meta=": Метаданные объектов",e.init_catalogues_tables=": Реструктуризация таблиц",e.init_catalogues_nom=": Базовые типы + номенклатура",e.init_catalogues_sys=": Технологические справочники",e.init_login="Укажите имя пользователя и пароль",e.requery="Повторите попытку через 1-2 минуты",e.limit_query="Превышено число обращений к серверу<br/>Запросов за минуту:%1<br/>Лимит запросов:%2<br/>"+e.requery,e.long_operation="Длительная операция",e.logged_in="Авторизован под именем: ",e.log_out_title="Отключиться от сервера?",e.log_out_break="<br/>Завершить синхронизацию?",e.sync_title="Обмен с сервером",e.sync_complite="Синхронизация завершена",e.main_title="Окнософт: заказ дилера ",e.mark_delete_confirm="Пометить объект %1 на удаление?",e.mark_undelete_confirm="Снять пометку удаления с объекта %1?",e.meta={cat:"Справочник",doc:"Документ",cch:"План видов характеристик",cacc:"Планы счетов",tsk:"Задача",ireg:"Регистр сведений",areg:"Регистр накопления",bp:"Бизнес процесс",ts_row:"Строка табличной части",dp:"Обработка",rep:"Отчет"},e.meta_cat="Справочники",e.meta_doc="Документы",e.meta_cch="Планы видов характеристик",e.meta_cacc="Планы счетов",e.meta_tsk="Задачи",e.meta_ireg="Регистры сведений",e.meta_areg="Регистры накопления",e.meta_mgr="Менеджер",e.meta_cat_mgr="Менеджер справочников",e.meta_doc_mgr="Менеджер документов",e.meta_enn_mgr="Менеджер перечислений",e.meta_ireg_mgr="Менеджер регистров сведений",e.meta_areg_mgr="Менеджер регистров накопления",e.meta_accreg_mgr="Менеджер регистров бухгалтерии",e.meta_dp_mgr="Менеджер обработок",e.meta_task_mgr="Менеджер задач",e.meta_bp_mgr="Менеджер бизнес-процессов",e.meta_reports_mgr="Менеджер отчетов",e.meta_cacc_mgr="Менеджер планов счетов",e.meta_cch_mgr="Менеджер планов видов характеристик",e.meta_extender="Модификаторы объектов и менеджеров",e.modified_close="Объект изменен<br/>Закрыть без сохранения?",e.mandatory_title="Обязательный реквизит",e.mandatory_field="Укажите значение реквизита '%1'",e.no_metadata="Не найдены метаданные объекта '%1'",e.no_selected_row="Не выбрана строка табличной части '%1'",e.no_dhtmlx="Библиотека dhtmlx не загружена",e.not_implemented="Не реализовано в текущей версии",e.offline_request="Запрос к серверу в автономном режиме",e.onbeforeunload="Окнософт: легкий клиент. Закрыть программу?",e.order_sent_title="Подтвердите отправку заказа",e.order_sent_message="Отправленный заказ нельзя изменить.<br/>После проверки менеджером<br/>он будет запущен в работу",e.report_error="<i class='fa fa-exclamation-circle fa-2x fa-fw'></i> Ошибка",e.report_prepare="<i class='fa fa-spinner fa-spin fa-2x fa-fw'></i> Подготовка отчета",e.report_need_prepare="<i class='fa fa-info fa-2x fa-fw'></i> Нажмите 'Сформировать' для получения отчета",e.report_need_online="<i class='fa fa-plug fa-2x fa-fw'></i> Нет подключения. Отчет недоступен в автономном режиме",e.request_title="Запрос регистрации",e.request_message="Заявка зарегистрирована. После обработки менеджером будет сформировано ответное письмо",e.select_from_list="Выбор из списка",e.select_grp="Укажите группу, а не элемент",e.select_elm="Укажите элемент, а не группу",e.select_file_import="Укажите файл для импорта",e.srv_overload="Сервер перегружен",e.sub_row_change_disabled="Текущая строка подчинена продукции.<br/>Строку нельзя изменить-удалить в документе<br/>только через построитель",e.sync_script="Обновление скриптов приложения:",e.sync_data="Синхронизация с сервером выполняется:<br />* при первом старте программы<br /> * при обновлении метаданных<br /> * при изменении цен или технологических справочников",e.sync_break="Прервать синхронизацию",e.sync_no_data="Файл не содержит подходящих элементов для загрузки",e.tabular_will_cleared="Табличная часть '%1' будет очищена. Продолжить?",e.unsupported_browser_title="Браузер не поддерживается",e.unsupported_browser="Несовместимая версия браузера<br/>Рекомендуется Google Chrome",e.supported_browsers="Рекомендуется Chrome, Safari или Opera",e.unsupported_mode_title="Режим не поддерживается",e.unsupported_mode="Программа не установлена<br/> в <a href='"+e.store_url_od+"'>приложениях Google Chrome</a>",e.unknown_error="Неизвестная ошибка в функции '%1'",e.value="Значение"}($p.msg);var _md;DataManager.prototype.__define({family_name:{get:function(){return $p.msg["meta_"+this.class_name.split(".")[0]+"_mgr"].replace($p.msg.meta_mgr+" ","")}},table_name:{get:function(){return this.class_name.replace(".","_")}},find_rows:{value:function(e,t){return $p._find_rows.call(this,this.by_ref,e,t)}},extra_fields:{value:function(e){var t=$p.cat.destinations||$p.cch.destinations,n=_md.class_name_to_1c(this.class_name).replace(".","_"),i=[];return t&&t.find_rows({predefined_name:n},function(e){var t=e.extra_fields||e.ДополнительныеРеквизиты;return t&&t.each(function(e){e._deleted||e.ПометкаУдаления||i.push(e.property||e.Свойство)}),!1}),i}},extra_properties:{value:function(e){return[]}},obj_constructor:{value:function(e){var t=this.class_name.split("."),n=t[0].charAt(0).toUpperCase()+t[0].substr(1)+t[1].charAt(0).toUpperCase()+t[1].substr(1);return e?n+e.charAt(0).toUpperCase()+e.substr(1)+"Row":n}},sync_grid:{value:function(e,t){function n(e){return new Promise(function(n,i){"string"==typeof e?("{"==e.substr(0,1)&&(e=JSON.parse(e)),t&&t.parse?(t.xmlFileUrl="exec",t.parse(e,function(){n(e)},"xml")):n(e)):t instanceof dhtmlXTreeView&&t.loadStruct?t.loadStruct(e,function(){n(e)}):n(e)})}var i=this;return function(){if("function"==typeof e.custom_selection)return e.custom_selection(e);if("ram"==i.cachable||"doc_ram"==i.cachable){
if("get_tree"==e.action)return $p.wsql.promise(i.get_sql_struct(e),[]).then($p.iface.data_to_tree);if("get_selection"==e.action)return $p.wsql.promise(i.get_sql_struct(e),[]).then(function(t){return $p.iface.data_to_grid.call(i,t,e)})}else if(0==i.cachable.indexOf("doc")||0==i.cachable.indexOf("remote")){if("get_tree"==e.action)return i.pouch_tree(e);if("get_selection"==e.action)return i.pouch_selection(e)}else{if("get_tree"==e.action)return i.rest_tree(e);if("get_selection"==e.action)return i.rest_selection(e)}}().then(n).catch($p.record_log)}},get_option_list:{value:function(e,t){function n(t){return $p.utils.is_equal(t.value,e)&&(t.selected=!0),t}var i,a,o,s=this,r=[];if(t.presentation&&(i=s.metadata().input_by_string)&&(a=t.presentation.like,delete t.presentation,t.or=[],i.forEach(function(e){o={},o[e]={like:a},t.or.push(o)})),-1!=s.cachable.indexOf("ram")||t&&t._local)return s.find_rows(t,function(e){r.push(n({text:e.presentation,value:e.ref}))}),r.sort(function(e,t){return e.text<t.text?-1:e.text>t.text?1:0}),Promise.resolve(r);if("e1cib"!=s.cachable)return s.pouch_find_rows(t).then(function(e){return e.forEach(function(e){r.push(n({text:e.presentation,value:e.ref}))}),r});var l={selection:t,top:t._top},c=s instanceof DocManager||s instanceof BusinessProcessManager;return delete t._top,c?l.fields=["ref","date","number_doc"]:s.metadata().main_presentation_name?l.fields=["ref","name"]:l.fields=["ref","id"],_rest.load_array(l,s).then(function(e){return e.forEach(function(e){r.push(n({text:c?e.number_doc+" от "+$p.moment(e.date).format($p.moment._masks.ldt):e.name||e.id,value:e.ref}))}),r})}},tabular_captions:{value:function(e,t){}},get_property_grid_xml:{value:function(e,t,n){var i,a,o,s,r,l,c,p=this,d="<rows>",u=function(e,t){l=$p.utils.is_data_obj(e)?e.presentation:e,t.type.is_ref||(t.type.date_part?l=$p.moment(l).format($p.moment._masks[t.type.date_part]):"boolean"==t.type.types[0]&&(l=l?"1":"0"))},f=function(e){r=_md.control_by_type(o.type,e),u(e,o)},m=function(e,i){if(i){var a=e.property||e.param||e.Параметр||e.Свойство,m=void 0!=e.value?e.value:e.Значение;a.empty()?(c=i+"|empty",r="ro",l="",o={synonym:"?"}):(o={synonym:a.presentation,type:a.type},c=i+"|"+a.ref,f(m),"edn"==r&&(r="calck"),a.mandatory&&(r+='" class="cell_mandatory'))}else if("object"==typeof e)c=e.id,o=n&&n.metadata&&n.metadata[c],o?e.synonym&&(o.synonym=e.synonym):o={synonym:e.synonym},r=e.type,l="",e.hasOwnProperty("txt")?l=e.txt:void 0!==(s=t[c])&&u(s,o.type?o:_md.get(p.class_name,c));else if(n&&n.metadata&&void 0!==(o=n.metadata[e]))c=e,f(s=t[e]);else{if(void 0===(s=t[e]))return;if(!(o=_md.get(p.class_name,c=e)))return;f(s)}d+='<row id="'+c+'"><cell>'+(o.synonym||o.name)+'</cell><cell type="'+r+'">'+l+"</cell></row>"};!function(){if(!e)if(o=p.metadata(),o.form&&o.form.obj&&o.form.obj.head)e=o.form.obj.head;else{if(e={" ":[]},t instanceof CatObj?(o.code_length&&e[" "].push("id"),o.main_presentation_name&&e[" "].push("name")):t instanceof DocObj&&(e[" "].push("number_doc"),e[" "].push("date")),!t.is_folder)for(i in o.fields)"predefined_name"==i||o.fields[i].hide||e[" "].push(i);o.tabular_sections&&o.tabular_sections.extra_fields&&(e["Дополнительные реквизиты"]=[])}}();for(i in e){" "!=i&&(d+='<row open="1"><cell>'+i+"</cell>");for(a in e[i])m(e[i][a]);if(n&&i==n.title&&t[n.ts]){var _,h=p.extra_fields(t),g="property,param,Свойство,Параметр".split(","),b=t[n.ts]._owner._metadata.tabular_sections[t[n.ts]._name].fields;g.some(function(e){if(b[e])return _=e,!0})&&(t[n.ts].forEach(function(e){var t=h.indexOf(e[_]);-1!=t&&h.splice(t,1)}),h.forEach(function(e){t[n.ts].add()[_]=e})),t[n.ts].find_rows(n.selection,function(e){m(e,n.ts)})}" "!=i&&(d+="</row>")}return d+="</rows>"}},print:{value:function(e,t,n){function i(e){n&&n.progressOff&&n.progressOff(),e&&e.focus()}if(n&&n.progressOn&&n.progressOn(),setTimeout(i,3e3),this._printing_plates[t]instanceof DataObj&&(t=this._printing_plates[t]),t instanceof DataObj&&t.execute)return e instanceof DataObj?t.execute(e).then(i):this.get(e,!0,!0).then(t.execute.bind(t)).then(i);var a={};return $p.ajax.default_attr(a,$p.job_prm.irest_url()),a.url+=this.rest_name+"(guid'"+$p.utils.fix_guid(e)+"')/Print(model="+t+", browser_uid="+$p.wsql.get_user_param("browser_uid")+")",$p.ajax.get_and_show_blob(a.url,a,"get").then(i)}},printing_plates:{value:function(){var e={},t=this;return t._printing_plates||(t.metadata().printing_plates?t._printing_plates=t.metadata().printing_plates:("ram"==t.metadata().cachable||t.metadata().cachable&&0==t.metadata().cachable.indexOf("doc"))&&(t._printing_plates={})),!t._printing_plates&&$p.ajax.authorized?($p.ajax.default_attr(e,$p.job_prm.irest_url()),e.url+=t.rest_name+"/Print()",$p.ajax.get_ex(e.url,e).then(function(e){return t._printing_plates=JSON.parse(e.response),t._printing_plates}).catch(function(){}).then(function(e){return e||(t._printing_plates={})})):Promise.resolve(t._printing_plates)}}}),RefDataManager._extend(DataManager),RefDataManager.prototype.__define({push:{value:function(e,t){t&&t!=e.ref?(delete this.by_ref[e.ref],this.by_ref[t]=e):this.by_ref[e.ref]=e}},each:{value:function(e){for(var t in this.by_ref)if(t&&t!=$p.utils.blank.guid&&1==e.call(this,this.by_ref[t]))break}},forEach:{value:function(e){return this.each.call(this,e)}},get:{value:function(e,t,n){var i=this.by_ref[e]||this.by_ref[e=$p.utils.fix_guid(e)];if(!i){if(n&&!t)return;i=new($p[this.obj_constructor()])(e,this,!0)}return!1===t?i:void 0===t&&e===$p.utils.blank.guid?i:i.is_new()?i.load():t?Promise.resolve(i):i}},create:{value:function(e,t,n){e&&"object"==typeof e||(e={}),e.ref&&$p.utils.is_guid(e.ref)&&!$p.utils.is_empty_guid(e.ref)||(e.ref=$p.utils.generate_guid());var i=this.by_ref[e.ref];if(!i)if(i=new($p[this.obj_constructor()])(e,this),!t&&e.ref&&e.presentation&&2==Object.keys(e).length);else{i instanceof DocObj&&i.date==$p.utils.blank.date&&(i.date=new Date);var a=this.handle_event(i,"after_create");if(this instanceof DocManager||this instanceof TaskManager||this instanceof BusinessProcessManager?i.number_doc||i.new_number_doc():!i.id&&i._metadata.code_length&&i.new_number_doc(),!1===a)return Promise.resolve(i);if("object"==typeof a&&a.then)return a;if("e1cib"==this.cachable&&t){var o={};return $p.ajax.default_attr(o,$p.job_prm.irest_url()),o.url+=this.rest_name+"/Create()",$p.ajax.get_ex(o.url,o).then(function(e){return i._mixin(JSON.parse(e.response),void 0,["ref"])})}}return n?i:Promise.resolve(i)}},unload_obj:{value:function(e){delete this.by_ref[e],this.alatable.some(function(t,n,i){if(t.ref==e)return i.splice(n,1),!0})}},find:{value:function(e,t){return $p._find(this.by_ref,e,t)}},load_array:{value:function(e,t){for(var n,i,a=[],o=0;o<e.length;o++){if(n=$p.utils.fix_guid(e[o]),i=this.by_ref[n])(i.is_new()||t)&&(i._mixin(e[o]),i._set_loaded());else{if("update_only"==t)continue;i=new($p[this.obj_constructor()])(e[o],this),t&&i._set_loaded()}a.push(i)}return a}},first_folder:{value:function(e){for(var t in this.by_ref){var n=this.by_ref[t];if(n.is_folder&&(!e||$p.utils.is_equal(e,n.owner)))return n}return this.get()}},get_sql_struct:{value:function(e){var t,n,i=this,a=i.metadata(),o={},s=0,r=e&&e.action?e.action:"create_table";return"create_table"==r?o=function(){var o="CREATE TABLE IF NOT EXISTS ";if(e&&e.postgres){o+=i.table_name+" (ref uuid PRIMARY KEY NOT NULL, _deleted boolean",i instanceof DocManager?o+=", posted boolean, date timestamp with time zone, number_doc character(11)":(a.code_length&&(o+=", id character("+a.code_length+")"),o+=", name character varying(50), is_folder boolean");for(t in a.fields)t.length>30?a.fields[t].short_name?n=a.fields[t].short_name:(s++,n=t[0]+s+t.substr(t.length-27)):n=t,o+=", "+n+_md.sql_type(i,t,a.fields[t].type,!0)+_md.sql_composite(a.fields,t,n,!0);for(t in a.tabular_sections)o+=", ts_"+t+" JSON"}else{o+="`"+i.table_name+"` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN",o+=i instanceof DocManager?", posted boolean, date Date, number_doc CHAR":", id CHAR, name CHAR, is_folder BOOLEAN";for(t in a.fields)o+=_md.sql_mask(t)+_md.sql_type(i,t,a.fields[t].type)+_md.sql_composite(a.fields,t);for(t in a.tabular_sections)o+=", `ts_"+t+"` JSON"}return o+=")"}():-1!=["insert","update","replace"].indexOf(r)?o[i.table_name]=function(){var e=["ref","_deleted"],n="INSERT INTO `"+i.table_name+"` (ref, `_deleted`",o="(?";"cat"==i.class_name.substr(0,3)?(n+=", id, name, is_folder",e.push("id"),e.push("name"),e.push("is_folder")):"doc"==i.class_name.substr(0,3)&&(n+=", posted, date, number_doc",e.push("posted"),e.push("date"),e.push("number_doc"));for(t in a.fields)n+=_md.sql_mask(t),e.push(t);for(t in a.tabular_sections)n+=", `ts_"+t+"`",e.push("ts_"+t);for(n+=") VALUES ",t=1;t<e.length;t++)o+=", ?";return o+=")",n+=o,{sql:n,fields:e,values:o}}():"select"==r?o="SELECT * FROM `"+i.table_name+"` WHERE ref = ?":"select_all"==r?o="SELECT * FROM `"+i.table_name+"`":"delete"==r?o="DELETE FROM `"+i.table_name+"` WHERE ref = ?":"drop"==r?o="DROP TABLE IF EXISTS `"+i.table_name+"`":"get_tree"==r?o=!e.filter||e.filter.is_folder?"SELECT ref, parent, name as presentation FROM `"+i.table_name+"` WHERE is_folder order by parent, name":"SELECT ref, parent, name as presentation FROM `"+i.table_name+"` order by parent, name":"get_selection"==r&&(o=function(){var t,n=!e.parent,o=e.parent||$p.utils.blank.guid,s=e.initial_value||$p.utils.blank.guid,r=e.filter||"",l=$p.utils.blank.guid;!function(){function c(t){t&&(l=e.set_parent=t.parent.ref,o=l,n=!1),r&&-1==r.indexOf("%")&&(r="%"+r+"%")}a.has_owners&&(t=e.owner,e.selection&&"function"!=typeof e.selection&&e.selection.forEach(function(e){e.owner&&(t="object"==typeof e.owner?e.owner.valueOf():e.owner,delete e.owner)}),t||(t=$p.utils.blank.guid)),s!=$p.utils.blank.guid&&n&&a.hierarchical?c(i.get(s,!1)):c()}();var c;return c=i.sql_selection_list_flds?i.sql_selection_list_flds(s):("SELECT %2, case when _t_.ref = '"+s+"' then 0 else 1 end as is_initial_value FROM `"+i.table_name+"` AS _t_ %j %3 %4 LIMIT 300").replace("%2",function(){var e=[],t="_t_.ref, _t_.`_deleted`";return a.form&&a.form.selection?a.form.selection.fields.forEach(function(t){e.push(t)}):i instanceof DocManager?(e.push("posted"),e.push("date"),e.push("number_doc")):(a.hierarchical&&a.group_hierarchy?e.push("is_folder"):e.push("0 as is_folder"),i instanceof ChartOfAccountManager?(e.push("id"),e.push("name as presentation")):a.main_presentation_name?e.push("name as presentation"):a.code_length?e.push("id as presentation"):e.push("'...' as presentation"),a.has_owners&&e.push("owner"),a.code_length&&e.push("id")),e.forEach(function(e){-1!=e.indexOf(" as ")?t+=", "+e:t+=_md.sql_mask(e,!0)}),t}()).replace("%j",function(){var e,t="";if(a.form&&a.form.selection)for(var n in a.form.selection.fields)-1!=a.form.selection.fields[n].indexOf(" as ")&&-1==a.form.selection.fields[n].indexOf("_t_.")&&(e=a.form.selection.fields[n].split(" as "),e[0]=e[0].split("."),e[0].length>1&&(t&&(t+="\n"),t+="left outer join "+e[0][0]+" on "+e[0][0]+".ref = _t_."+e[1]));return t}()),c.replace("%3",function(){var s;return s=i instanceof ChartOfAccountManager?" WHERE ("+(r?0:1):a.hierarchical?a.has_owners?" WHERE ("+(n||r?1:0)+" OR _t_.parent = '"+o+"') AND ("+(t==$p.utils.blank.guid?1:0)+" OR _t_.owner = '"+t+"') AND ("+(r?0:1):" WHERE ("+(n||r?1:0)+" OR _t_.parent = '"+o+"') AND ("+(r?0:1):a.has_owners?" WHERE ("+(t==$p.utils.blank.guid?1:0)+" OR _t_.owner = '"+t+"') AND ("+(r?0:1):" WHERE ("+(r?0:1),i.sql_selection_where_flds?s+=i.sql_selection_where_flds(r):i instanceof DocManager?s+=" OR _t_.number_doc LIKE '"+r+"'":((a.main_presentation_name||i instanceof ChartOfAccountManager)&&(s+=" OR _t_.name LIKE '"+r+"'"),a.code_length&&(s+=" OR _t_.id LIKE '"+r+"'")),s+=") AND (_t_.ref != '"+$p.utils.blank.guid+"')",e.selection&&("function"==typeof e.selection||e.selection.forEach(function(e){for(var t in e)if("function"==typeof e[t])s+="\n AND "+e[t](i,t)+" ";else if(a.fields.hasOwnProperty(t)||"ref"===t)if(!0===e[t])s+="\n AND _t_."+t+" ";else if(!1===e[t])s+="\n AND (not _t_."+t+") ";else if("object"==typeof e[t])if($p.utils.is_data_obj(e[t])||$p.utils.is_guid(e[t]))s+="\n AND (_t_."+t+" = '"+e[t]+"') ";else{var n=Object.keys(e[t]),o=e[t][n[0]],r=a.fields[t];r&&r.type.is_ref&&_md.value_mgr({},t,r.type,!0,o),"not"==n[0]?s+="\n AND (not _t_."+t+" = '"+o+"') ":"in"==n[0]?s+="\n AND (_t_."+t+" in ("+e[t].in.reduce(function(e,t){return e&&(e+=","),e+="number"==typeof t?t.toString():"'"+t+"'"},"")+")) ":s+="\n AND (_t_."+t+" = '"+o+"') "}else"string"==typeof e[t]?s+="\n AND (_t_."+t+" = '"+e[t]+"') ":s+="\n AND (_t_."+t+" = "+e[t]+") ";else"is_folder"==t&&a.hierarchical&&a.group_hierarchy})),s}()).replace("%4",function(){return i instanceof ChartOfAccountManager?"ORDER BY id":a.hierarchical?a.group_hierarchy?"ORDER BY _t_.is_folder desc, is_initial_value, presentation":"ORDER BY _t_.parent desc, is_initial_value, presentation":"ORDER BY is_initial_value, presentation"}())}()),o}},caption_flds:{value:function(e){var t=e.metadata||this.metadata(),n=[],i="";if(t.form&&t.form.selection?n=t.form.selection.cols:this instanceof DocManager?(n.push(new Col_struct("date","160","ro","left","server","Дата")),n.push(new Col_struct("number_doc","140","ro","left","server","Номер")),t.fields.note&&n.push(new Col_struct("note","*","ro","left","server",t.fields.note.synonym)),t.fields.responsible&&n.push(new Col_struct("responsible","*","ro","left","server",t.fields.responsible.synonym))):this instanceof ChartOfAccountManager?(n.push(new Col_struct("id","140","ro","left","server","Код")),n.push(new Col_struct("presentation","*","ro","left","server","Наименование"))):n.push(new Col_struct("presentation","*","ro","left","server","Наименование")),e.get_header&&n.length){i="<head>";for(var a in n)i+='<column id="%1" width="%2" type="%3" align="%4" sort="%5">%6</column>'.replace("%1",n[a].id).replace("%2",n[a].width).replace("%3",n[a].type).replace("%4",n[a].align).replace("%5",n[a].sort).replace("%6",n[a].caption);i+="</head>"}return{head:i,acols:n}}},load_cached_server_array:{value:function(e,t){var n,i=[],a=this,o=t?{class_name:a.class_name,rest_name:t}:a,s=!t;if(e.forEach(function(e){(!(n=a.get(e.ref||e,!1,!0))||s&&n.is_new())&&i.push(e.ref||e)}),i.length){var r={url:"",selection:{ref:{in:i}}};return s&&(r.fields=["ref"]),$p.rest.build_select(r,o),$p.ajax.get_ex(r.url,r).then(function(t){var n=JSON.parse(t.response);if(s)n=n.value;else{n=n.data;for(var i in n)!n[i].ref&&n[i].id&&(n[i].ref=n[i].id),n[i].Код&&(n[i].id=n[i].Код,delete n[i].Код),n[i]._not_set_loaded=!0}return a.load_array(n),e})}return Promise.resolve(e)}},predefined:{value:function(e){return this._predefined||(this._predefined={}),this._predefined[e]||(this._predefined[e]=this.get(),this.find_rows({predefined_name:e},function(t){return this._predefined[e]=t,!1})),this._predefined[e]}}}),DataProcessorsManager._extend(DataManager),DataProcessorsManager.prototype.__define({create:{value:function(e){return new($p[this.obj_constructor()])(e||{},this)}},unload_obj:{value:function(){}}}),EnumManager._extend(RefDataManager),EnumManager.prototype.__define({get:{value:function(e){if(e instanceof EnumObj)return e;e&&e!=$p.utils.blank.guid||(e="_");var t=this[e];return t||(t=new EnumObj({name:e},this)),t}},push:{value:function(e,t){this.__define(t,{value:e})}},each:{value:function(e){this.alatable.forEach(function(t){t.ref&&"_"!=t.ref&&t.ref!=$p.utils.blank.guid&&e.call(this[t.ref])}.bind(this))}},get_sql_struct:{value:function(e){var t="CREATE TABLE IF NOT EXISTS ",n=e&&e.action?e.action:"create_table";return e&&e.postgres?"create_table"==n?t+=this.table_name+" (ref character varying(255) PRIMARY KEY NOT NULL, sequence INT, synonym character varying(255))":-1!=["insert","update","replace"].indexOf(n)?(t={},t[this.table_name]={sql:"INSERT INTO "+this.table_name+" (ref, sequence, synonym) VALUES ($1, $2, $3)",fields:["ref","sequence","synonym"],values:"($1, $2, $3)"}):"delete"==n&&(t="DELETE FROM "+this.table_name+" WHERE ref = $1"):"create_table"==n?t+="`"+this.table_name+"` (ref CHAR PRIMARY KEY NOT NULL, sequence INT, synonym CHAR)":-1!=["insert","update","replace"].indexOf(n)?(t={},t[this.table_name]={sql:"INSERT INTO `"+this.table_name+"` (ref, sequence, synonym) VALUES (?, ?, ?)",fields:["ref","sequence","synonym"],values:"(?, ?, ?)"}):"delete"==n&&(t="DELETE FROM `"+this.table_name+"` WHERE ref = ?"),t}},get_option_list:{value:function(e,t){function n(t){return $p.utils.is_equal(t.value,e)&&(t.selected=!0),t}var i,a=[],o="";if(t)for(var s in t)"_"!=s.substr(0,1)&&("ref"==s?i=t[s].hasOwnProperty("in")?t[s].in:t[s]:o=t[s]);return"object"==typeof o&&(o=o.like?o.like:""),o=o.toLowerCase(),this.alatable.forEach(function(e){if(!o||e.synonym&&-1!=e.synonym.toLowerCase().indexOf(o)){if(i)if(Array.isArray(i)){if(!i.some(function(t){return t.name==e.ref||t.ref==e.ref||t==e.ref}))return}else if(i.name!=e.ref&&i.ref!=e.ref&&i!=e.ref)return;a.push(n({text:e.synonym||"",value:e.ref}))}}),a.sort(function(e,t){return e.text<t.text?-1:e.text>t.text?1:0}),Promise.resolve(a)}}}),RegisterManager._extend(DataManager),RegisterManager.prototype.__define({get_sql_struct:{value:function(e){function t(){var t="SELECT * FROM `"+i.table_name+"` WHERE ",n=!0;e._values=[];for(var o in a.dimensions)n?n=!1:t+=" and ",t+="`"+o+"`=?",e._values.push(e[o]);return n&&(t+="1"),t}var n,i=this,a=i.metadata(),o={},s=e&&e.action?e.action:"create_table";return"create_table"==s?o=function(){var t="CREATE TABLE IF NOT EXISTS ",o=!0;if(e&&e.postgres){t+=i.table_name+" (",a.splitted&&(t+="zone integer",o=!1);for(n in a.dimensions)o?(t+=n,o=!1):t+=", "+n,t+=_md.sql_type(i,n,a.dimensions[n].type,!0)+_md.sql_composite(a.dimensions,n,"",!0);for(n in a.resources)t+=", "+n+_md.sql_type(i,n,a.resources[n].type,!0)+_md.sql_composite(a.resources,n,"",!0);for(n in a.attributes)t+=", "+n+_md.sql_type(i,n,a.attributes[n].type,!0)+_md.sql_composite(a.attributes,n,"",!0);t+=", PRIMARY KEY (",o=!0,a.splitted&&(t+="zone",o=!1);for(n in a.dimensions)o?(t+=n,o=!1):t+=", "+n}else{t+="`"+i.table_name+"` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN";for(n in a.dimensions)t+=_md.sql_mask(n)+_md.sql_type(i,n,a.dimensions[n].type);for(n in a.resources)t+=_md.sql_mask(n)+_md.sql_type(i,n,a.resources[n].type);for(n in a.attributes)t+=_md.sql_mask(n)+_md.sql_type(i,n,a.attributes[n].type)}return t+=")"}():s in{insert:"",update:"",replace:""}?o[i.table_name]=function(){var e="INSERT OR REPLACE INTO `"+i.table_name+"` (",t=[],o=!0;for(n in a.dimensions)o?(e+=n,o=!1):e+=", "+n,t.push(n);for(n in a.resources)e+=", "+n,t.push(n);for(n in a.attributes)e+=", "+n,t.push(n);for(e+=") VALUES (?",n=1;n<t.length;n++)e+=", ?";return e+=")",{sql:e,fields:t}}():"select"==s?o=t():"select_all"==s?o=t():"delete"==s?o="DELETE FROM `"+i.table_name+"` WHERE ref = ?":"drop"==s?o="DROP TABLE IF EXISTS `"+i.table_name+"`":"get_selection"==s&&(o=function(){var t=e.filter||"";t&&-1==t.indexOf("%")&&(t="%"+t+"%");var n;return n=i.sql_selection_list_flds?i.sql_selection_list_flds():("SELECT %2 FROM `"+i.table_name+"` AS _t_ %j %3 %4 LIMIT 300").replace("%2",function(){var e=[],t="_t_.ref";if(a.form&&a.form.selection)a.form.selection.fields.forEach(function(t){e.push(t)});else for(var n in a.dimensions)e.push(n);return e.forEach(function(e){-1!=e.indexOf(" as ")?t+=", "+e:t+=_md.sql_mask(e,!0)}),t}()).replace("%j",function(){var e,t="";if(a.form&&a.form.selection)for(var n in a.form.selection.fields)-1!=a.form.selection.fields[n].indexOf(" as ")&&-1==a.form.selection.fields[n].indexOf("_t_.")&&(e=a.form.selection.fields[n].split(" as "),e[0]=e[0].split("."),e[0].length>1&&(t&&(t+="\n"),t+="left outer join "+e[0][0]+" on "+e[0][0]+".ref = _t_."+e[1]));return t}()),n.replace("%3",function(){var n=" WHERE ("+(t?0:1);return i.sql_selection_where_flds&&(n+=i.sql_selection_where_flds(t)),n+=")",e.selection&&("function"==typeof e.selection||e.selection.forEach(function(e){for(var t in e)if("function"==typeof e[t])n+="\n AND "+e[t](i,t)+" ";else if(a.fields.hasOwnProperty(t))if(!0===e[t])n+="\n AND _t_."+t+" ";else if(!1===e[t])n+="\n AND (not _t_."+t+") ";else if("object"==typeof e[t])if($p.utils.is_data_obj(e[t]))n+="\n AND (_t_."+t+" = '"+e[t]+"') ";else{var o=Object.keys(e[t]),s=e[t][o[0]],r=a.fields[t];r&&r.type.is_ref&&_md.value_mgr({},t,r.type,!0,s),"not"==o[0]?n+="\n AND (not _t_."+t+" = '"+s+"') ":n+="\n AND (_t_."+t+" = '"+s+"') "}else"string"==typeof e[t]?n+="\n AND (_t_."+t+" = '"+e[t]+"') ":n+="\n AND (_t_."+t+" = "+e[t]+") ";else"is_folder"==t&&a.hierarchical&&a.group_hierarchy})),n}()).replace("%4","")}()),o}},get_ref:{value:function(e){if(e instanceof RegisterRow&&(e=e._obj),e.ref)return e.ref;var t="",n=this.metadata().dimensions;for(var i in n)t+=t?"¶":"",n[i].type.is_ref?t+=$p.utils.fix_guid(e[i]):!e[i]&&n[i].type.digits?t+="0":n[i].date_part?t+=$p.moment(e[i]||$p.utils.blank.date).format($p.moment.defaultFormatUtc):void 0!=e[i]?t+=String(e[i]):t+="$";return t}},caption_flds:{value:function(e){var t=e.metadata||this.metadata(),n='<column id="%1" width="%2" type="%3" align="%4" sort="%5">%6</column>',i=[],a="";if(t.form&&t.form.selection)i=t.form.selection.cols;else for(var o in t.dimensions)i.push(new Col_struct(o,"*","ro","left","server",t.dimensions[o].synonym));if(e.get_header&&i.length){a="<head>";for(var s in i)a+=n.replace("%1",i[s].id).replace("%2",i[s].width).replace("%3",i[s].type).replace("%4",i[s].align).replace("%5",i[s].sort).replace("%6",i[s].caption);a+="</head>"}return{head:a,acols:i}}},create:{value:function(e){e&&"object"==typeof e||(e={});var t=this.by_ref[e.ref];if(!t){t=new($p[this.obj_constructor()])(e,this);var n=this.handle_event(t,"after_create");if(!1===n)return Promise.resolve(t);if("object"==typeof n&&n.then)return n}return Promise.resolve(t)}}}),InfoRegManager._extend(RegisterManager),InfoRegManager.prototype.slice_first=function(e){},InfoRegManager.prototype.slice_last=function(e){},AccumRegManager._extend(RegisterManager),CatManager._extend(RefDataManager),CatManager.prototype.by_name=function(e){var t;return this.find_rows({name:e},function(e){return t=e,!1}),t||(t=this.get()),t},CatManager.prototype.by_id=function(e){var t;return this.find_rows({id:e},function(e){return t=e,!1}),t||(t=this.get()),t},CatManager.prototype.path=function(e){var t,n=[];if(t=e instanceof DataObj?e:this.get(e,!1,!0),t&&n.push({ref:t.ref,presentation:t.presentation}),t&&this.metadata().hierarchical)for(;;){if(t=t.parent,t.empty())break;n.push({ref:t.ref,presentation:t.presentation})}return n},ChartOfCharacteristicManager._extend(CatManager),ChartOfAccountManager._extend(CatManager),DocManager._extend(RefDataManager),TaskManager._extend(CatManager),BusinessProcessManager._extend(CatManager),LogManager._extend(InfoRegManager),MetaObjManager._extend(CatManager),MetaFieldManager._extend(CatManager),SchemeSettingsManager._extend(CatManager),DataObj.prototype.__define({valueOf:{value:function(){return this.ref}},toJSON:{value:function(){return this._obj}},toString:{value:function(){return this.presentation}},__notify:{value:function(e){this._data._silent||Object.getNotifier(this).notify({type:"update",name:e,oldValue:this._obj[e]})}},_getter:{value:function(e){var t,n=this._metadata.fields[e].type,i=this._obj?this._obj[e]:"";return"type"==e&&"object"==typeof i?i:"ref"==e?i:n.is_ref?n.digits&&"number"==typeof i?i:n.hasOwnProperty("str_len")&&!$p.utils.is_guid(i)?i:(t=_md.value_mgr(this._obj,e,n))?$p.utils.is_data_mgr(t)?t.get(i,!1):$p.utils.fetch_type(i,t):i?(console.log([e,n,this._obj]),null):void 0:n.date_part?$p.utils.fix_date(this._obj[e],!0):n.digits?$p.utils.fix_number(this._obj[e],!n.hasOwnProperty("str_len")):"boolean"==n.types[0]?$p.utils.fix_boolean(this._obj[e]):this._obj[e]||""}},_getter_ts:{value:function(e){return this._ts_(e)}},_setter:{value:function(e,t){this._obj[e]!=t&&(this.__notify(e),this.__setter(e,t),this._data._modified=!0)}},__setter:{value:function(e,t){var n,i=this._metadata.fields[e].type;"type"==e&&t.types?this._obj[e]=t:"ref"==e?this._obj[e]=$p.utils.fix_guid(t):i.is_ref?i.digits&&"number"==typeof t||i.hasOwnProperty("str_len")&&"string"==typeof t&&!$p.utils.is_guid(t)?this._obj[e]=t:"boolean"==typeof t&&-1!=i.types.indexOf("boolean")?this._obj[e]=t:(this._obj[e]=$p.utils.fix_guid(t),n=_md.value_mgr(this._obj,e,i,!1,t),n?n instanceof EnumManager?"string"==typeof t?this._obj[e]=t:t?"object"==typeof t&&(this._obj[e]=t.ref||t.name||""):this._obj[e]="":t&&t.presentation?(!t.type||t instanceof DataObj||delete t.type,n.create(t)):$p.utils.is_data_mgr(n)||(this._obj[e]=$p.utils.fetch_type(t,n)):"object"!=typeof t&&(this._obj[e]=t)):i.date_part?this._obj[e]=$p.utils.fix_date(t,!0):i.digits?this._obj[e]=$p.utils.fix_number(t,!i.hasOwnProperty("str_len")):"boolean"==i.types[0]?this._obj[e]=$p.utils.fix_boolean(t):this._obj[e]=t}},_setter_ts:{value:function(e,t){var n=this._ts_(e);n instanceof TabularSection&&Array.isArray(t)&&n.load(t)}},_metadata:{get:function(){return this._manager.metadata()}},_deleted:{get:function(){return!!this._obj._deleted}},_modified:{get:function(){return!!this._data&&!!this._data._modified}},is_new:{value:function(){return this._data._is_new}},_set_loaded:{value:function(e){return this._manager.push(this,e),this._data._modified=!1,this._data._is_new=!1,this}},mark_deleted:{value:function(e){return this._obj._deleted=!!e,this.save(),this.__notify("_deleted"),this}},ref:{get:function(){return this._obj.ref},set:function(e){this._obj.ref=$p.utils.fix_guid(e)},enumerable:!0,configurable:!0},class_name:{get:function(){return this._manager.class_name},set:function(e){this._obj.class_name=e}},empty:{value:function(){return $p.utils.is_empty_guid(this._obj.ref)}},load:{value:function(){var e=function(){return e=null,this._data._modified=!1,this}.bind(this);return this.ref==$p.utils.blank.guid?(this instanceof CatObj?this.id="000000000":this.number_doc="000000000",Promise.resolve(this)):this._manager.cachable&&"e1cib"!=this._manager.cachable?$p.wsql.pouch.load_obj(this).then(e):_rest.load_obj(this).then(e)}},unload:{value:function(){var e,t=this._obj;this._manager.unload_obj(this.ref),this._observers&&(this._observers.length=0),this._notis&&(this._notis.length=0);for(e in this._metadata.tabular_sections)this[e].clear(!0);for(e in this)this.hasOwnProperty(e)&&delete this[e];for(e in t)delete t[e];["_ts_","_obj","_data"].forEach(function(e){delete this[e]}.bind(this)),e=t=null}},save:{value:function(e,t,n){if(this instanceof DocObj&&"boolean"==typeof e){var i=this.posted;this.posted=e}var a,o=this._manager.handle_event(this,"before_save"),s=function(){return!1===o?this instanceof DocObj&&"boolean"==typeof i&&this.posted!=i&&(this.posted=i):this._data._modified=!1,a=null,o=null,s=null,this}.bind(this);if(!1===o)return Promise.reject(s());if(o instanceof Promise||"object"==typeof o&&o.then)return o.then(s);if(this._metadata.hierarchical&&!this._obj.parent&&(this._obj.parent=$p.utils.blank.guid),this instanceof DocObj||this instanceof TaskObj||this instanceof BusinessProcessObj?($p.utils.blank.date==this.date&&(this.date=new Date),this.number_doc||this.new_number_doc()):this.id||this.new_number_doc(),$p.msg&&$p.msg.show_msg)for(var r in this._metadata.fields)if(this._metadata.fields[r].mandatory&&!this._obj[r])return $p.msg.show_msg({title:$p.msg.mandatory_title,type:"alert-error",text:$p.msg.mandatory_field.replace("%1",this._metadata.fields[r].synonym)}),o=!1,Promise.reject(s());return a=this._manager.cachable&&"e1cib"!=this._manager.cachable?$p.wsql.pouch.save_obj:_rest.save_irest,a(this,{post:e,operational:t,attachments:n}).then(function(e){return e._manager.handle_event(e,"after_save")}).then(s)}},get_attachment:{value:function(e){return this._manager.get_attachment(this.ref,e)}},save_attachment:{value:function(e,t,n){return this._manager.save_attachment(this.ref,e,t,n).then(function(t){return this._attachments||(this._attachments={}),this._attachments[e]&&t.stub||(this._attachments[e]=t),t}.bind(this))}},delete_attachment:{value:function(e){return this._manager.delete_attachment(this.ref,e).then(function(t){return this._attachments&&delete this._attachments[e],t}.bind(this))}},_silent:{value:function(e){"boolean"==typeof e?this._data._silent=e:(this._data._silent=!0,setTimeout(function(){this._data._silent=!1}.bind(this)))}},print:{value:function(e,t){return this._manager.print(this,e,t)}}}),CatObj._extend(DataObj),CatObj.prototype.__define({id:{get:function(){return this._obj.id||""},set:function(e){this.__notify("id"),this._obj.id=e},enumerable:!0},name:{get:function(){return this._obj.name||""},set:function(e){this.__notify("name"),this._obj.name=String(e)},enumerable:!0},presentation:{get:function(){return this.name||this.id?this.name||this.id||this._metadata.obj_presentation||this._metadata.synonym:this._presentation||""},set:function(e){e&&(this._presentation=String(e))}},_hierarchy:{value:function(e){var t=this;if(Array.isArray(e))return e.some(function(e){return t._hierarchy(e)});if(this==e||t.parent==e)return!0;var n=t.parent;return n&&!n.empty()?n._hierarchy(e):e==$p.utils.blank.guid}},_children:{get:function(){var e=this,t=[];return this._manager.forEach(function(n){n!=e&&n._hierarchy(e)&&t.push(n)}),t}}}),DocObj._extend(DataObj),DocObj.prototype.__define({posted:{get:function(){return this._obj.posted||!1},set:function(e){this.__notify("posted"),this._obj.posted=$p.utils.fix_boolean(e)},enumerable:!0}}),doc_props_date_number(DocObj.prototype),DataProcessorObj._extend(DataObj),TaskObj._extend(CatObj),doc_props_date_number(TaskObj.prototype),BusinessProcessObj._extend(CatObj),doc_props_date_number(BusinessProcessObj.prototype),EnumObj._extend(DataObj),EnumObj.prototype.__define({order:{get:function(){return this._obj.sequence},set:function(e){this._obj.sequence=parseInt(e)},enumerable:!0},name:{get:function(){return this._obj.ref},set:function(e){this._obj.ref=String(e)},enumerable:!0},synonym:{get:function(){return this._obj.synonym||""},set:function(e){this._obj.synonym=String(e)},enumerable:!0},presentation:{get:function(){return this.synonym||this.name}},empty:{value:function(){return!this.ref||"_"==this.ref}}}),RegisterRow._extend(DataObj),RegisterRow.prototype.__define({_metadata:{get:function(){var e=this._manager.metadata();return e.fields||(e.fields={}._mixin(e.dimensions)._mixin(e.resources)._mixin(e.attributes)),e}},ref:{get:function(){return this._manager.get_ref(this)},enumerable:!0},presentation:{get:function(){return this._metadata.obj_presentation||this._metadata.synonym}}}),TabularSection.prototype.toString=function(){return"Табличная часть "+this._owner.class_name+"."+this._name},TabularSection.prototype.get=function(e){return this._obj[e]?this._obj[e]._row:null},TabularSection.prototype.count=function(){return this._obj.length},TabularSection.prototype.clear=function(e,t){return t?this.find_rows(t).forEach(function(e){e._row._owner.del(e.row-1,!0)}):this._obj.length=0,e||this._owner._data._silent||Object.getNotifier(this._owner).notify({type:"rows",tabular:this._name}),this},TabularSection.prototype.del=function(e,t){var n,i=this._obj;if(void 0!==e){if("number"==typeof e)n=e;else if(i[e.row-1]._row===e)n=e.row-1;else for(var a in i)if(i[a]._row===e){n=Number(a),delete i[a]._row;break}void 0!=n&&(i.splice(n,1),i.forEach(function(e,t){e.row=t+1}),t||this._owner._data._silent||Object.getNotifier(this._owner).notify({type:"rows",tabular:this._name}),this._owner._data._modified=!0)}},TabularSection.prototype.find=function(e,t){var n=$p._find(this._obj,e,t);if(n)return n._row},TabularSection.prototype.find_rows=function(e,t){var n=this,i=t?function(e){return t.call(n,e._row)}:null;return $p._find_rows.call(n,n._obj,e,i)},TabularSection.prototype.swap=function(e,t){var n=this._obj[e];this._obj[e]=this._obj[t],this._obj[t]=n,this._obj[e].row=e+1,this._obj[t].row=t+1,this._owner._data._silent||Object.getNotifier(this._owner).notify({type:"rows",tabular:this._name})},TabularSection.prototype.add=function(e,t){
var n=new($p[this._owner._manager.obj_constructor(this._name)])(this);e||(e={});for(var i in n._metadata.fields)n[i]=e[i]||"";return n._obj.row=this._obj.push(n._obj),n._obj.__define("_row",{value:n,enumerable:!1}),t||this._owner._data._silent||Object.getNotifier(this._owner).notify({type:"rows",tabular:this._name}),e=null,this._owner._data._modified=!0,n},TabularSection.prototype.each=function(e){var t=this;t._obj.forEach(function(n){return e.call(t,n._row)})},TabularSection.prototype.forEach=TabularSection.prototype.each,TabularSection.prototype.group_by=function(e,t){try{var n=this.aggregate(e,t,"SUM",!0);return this.clear(!0).load(n)}catch(e){}},TabularSection.prototype.sort=function(e){"string"==typeof e&&(e=e.split(","));var t="select * from ? order by ",n=!0;e.forEach(function(e){e=e.trim().replace(/\s{1,}/g," ").split(" "),n?n=!1:t+=", ",t+="`"+e[0]+"`",e[1]&&(t+=" "+e[1])});try{return n=$p.wsql.alasql(t,[this._obj]),this.clear(!0).load(n)}catch(e){$p.record_log(e)}},TabularSection.prototype.aggregate=function(e,t,n,i){if("string"==typeof e&&(e=e.split(",")),"string"==typeof t&&(t=t.split(",")),n||(n="sum"),!e.length&&1==t.length&&"sum"==n)return this._obj.reduce(function(e,n,i,a){return e+n[t[0]]},0);var a,o=!0;t.forEach(function(e){a?a+=", "+n+"(`"+e+"`) `"+e+"`":a="select "+n+"(`"+e+"`) `"+e+"`"}),e.forEach(function(e){a?a+=", `"+e+"`":a="select `"+e+"`"}),a+=" from ? ",e.forEach(function(e){o?(a+="group by ",o=!1):a+=", ",a+="`"+e+"`"});try{return o=$p.wsql.alasql(a,[this._obj]),i||(o=1==t.length?o.length?o[0][t[0]]:0:o.length?o[0]:{}),o}catch(e){$p.record_log(e)}},TabularSection.prototype.load=function(e){var t,n=this;return n.clear(!0),e instanceof TabularSection?t=e._obj:Array.isArray(e)&&(t=e),t&&t.forEach(function(e){n.add(e,!0)}),this._owner._data._silent||Object.getNotifier(n._owner).notify({type:"rows",tabular:n._name}),n},TabularSection.prototype.sync_grid=function(e,t){for(var n={rows:[]},i=[],a=0;a<e.getColumnCount();a++)i.push(e.getColumnId(a));if(e.clearAll(),this.find_rows(t,function(e){var t=[];i.forEach(function(n){$p.utils.is_data_obj(e[n])?t.push(e[n].presentation):t.push(e[n])}),n.rows.push({id:e.row,data:t})}),e.objBox)try{e.parse(n,"json"),e.callEvent("onGridReconstructed",[])}catch(e){}},TabularSection.prototype.toJSON=function(){return this._obj},TabularSectionRow.prototype.__define("_metadata",{get:function(){return this._owner._owner._metadata.tabular_sections[this._owner._name]},enumerable:!1}),TabularSectionRow.prototype.__define("row",{get:function(){return this._obj.row||0},enumerable:!0}),TabularSectionRow.prototype.__define("_clone",{value:function(){return new($p[this._owner._owner._manager.obj_constructor(this._owner._name)])(this._owner)._mixin(this._obj)},enumerable:!1}),TabularSectionRow.prototype._getter=DataObj.prototype._getter,TabularSectionRow.prototype._setter=function(e,t){if(this._obj[e]!=t&&(t||this._obj[e]!=$p.utils.blank.guid)){var n=this._owner._owner;if(n._data._silent||Object.getNotifier(n).notify({type:"row",row:this,tabular:this._owner._name,name:e,oldValue:this._obj[e]}),this._metadata.fields[e].choice_type){var i;i=2==this._metadata.fields[e].choice_type.path.length?this[this._metadata.fields[e].choice_type.path[1]]:n[this._metadata.fields[e].choice_type.path[0]],i&&i.type&&(t=$p.utils.fetch_type(t,i.type))}DataObj.prototype.__setter.call(this,e,t),n._data._modified=!0}};var _rest=$p.rest=new Rest;DataManager.prototype.__define("rest_name",{get:function(){var e=this.class_name.split(".");return{cat:"Catalog",doc:"Document",ireg:"InformationRegister",areg:"AccumulationRegister",cch:"ChartOfCharacteristicTypes",cacc:"ChartOfAccounts",tsk:"Task",bp:"BusinessProcess"}[e[0]]+"_"+_md.syns_1с(e[1])},enumerable:!1}),DataManager.prototype.rest_tree=function(e){var t,n,i=this,a=i.metadata(),o=[];return $p.ajax.default_attr(e,!a.irest&&$p.job_prm.rest?$p.job_prm.rest_url():$p.job_prm.irest_url()),e.url+=this.rest_name+"?allowedOnly=true&$format=json&$top=1000&$select=Ref_Key,DeletionMark,Parent_Key,Description&$filter=IsFolder eq true",$p.ajax.get_ex(e.url,e).then(function(e){return JSON.parse(e.response)}).then(function(e){for(var i=0;i<e.value.length;i++)n=e.value[i],t={ref:n.Ref_Key,_deleted:n.DeletionMark,parent:n.Parent_Key,presentation:n.Description},o.push(t);return $p.iface.data_to_tree(o)})},DataManager.prototype.rest_selection=function(e){if("get_tree"==e.action)return this.rest_tree(e);var t,n,i,a,o,s,r=this,l=r.metadata(),c=[],p=[];return o=function(){var e="$select=Ref_Key,DeletionMark";return l.form&&l.form.selection?l.form.selection.fields.forEach(function(e){c.push(e)}):r instanceof DocManager?(c.push("posted"),c.push("date"),c.push("number_doc")):r instanceof TaskManager?(c.push("name as presentation"),c.push("date"),c.push("number_doc"),c.push("completed")):r instanceof BusinessProcessManager?(c.push("date"),c.push("number_doc"),c.push("started"),c.push("finished")):(l.hierarchical&&l.group_hierarchy?c.push("is_folder"):c.push("0 as is_folder"),l.main_presentation_name?c.push("name as presentation"):l.code_length?c.push("id as presentation"):c.push("'...' as presentation"),l.has_owners&&c.push("owner"),l.code_length&&c.push("id")),c.forEach(function(t){var n;if(-1!=t.indexOf(" as "))if(n=t.split(" as ")[0].split("."),1==n.length)t=n[0];else{if("_t_"!=n[0])return;t=n[1]}"0"!=t&&(i=_md.syns_1с(t),_md.get(r.class_name,t).type.is_ref&&-1==i.indexOf("_Key")&&_md.get(r.class_name,t).type.types.length&&-1==_md.get(r.class_name,t).type.types[0].indexOf("enm.")&&(i+="_Key"),e+=","+i)}),c.push("ref"),c.push("_deleted"),e}(),$p.ajax.default_attr(e,!l.irest&&$p.job_prm.rest?$p.job_prm.rest_url():$p.job_prm.irest_url()),e.url+=(l.irest&&l.irest.selection?l.irest.selection:this.rest_name)+"?allowedOnly=true&$format=json&$top=1000&"+o,_md.get(r.class_name,"date")&&(e.date_from||e.date_till)&&(e.url+="&$filter="+_rest.filter_date("Date",e.date_from,e.date_till),s=!0),l.hierarchical&&e.parent&&(e.url+=s?" and ":"&$filter=",e.url+="Parent_Key eq guid'"+e.parent+"'",s=!0),l.has_owners&&e.owner&&(e.url+=s?" and ":"&$filter=",e.url+="Owner_Key eq guid'"+e.owner+"'",s=!0),e.filter&&(e.url+=s?" and ":"&$filter=",e.url+="$filter eq '"+e.filter+"'",s=!0),$p.ajax.get_ex(e.url,e).then(function(e){return JSON.parse(e.response)}).then(function(o){for(var s=0;s<o.value.length;s++)n=o.value[s],t={},c.forEach(function(e){var o;if("ref"==e)return void(t[e]=n.Ref_Key);if(-1!=e.indexOf(" as ")?(o=e.split(" as ")[1],e=e.split(" as ")[0].split("."),e=e[e.length-1]):o=e,i=_md.syns_1с(e),a=_md.get(r.class_name,e))if(-1==i.indexOf("_Key")&&a.type.is_ref&&a.type.types.length&&-1==a.type.types[0].indexOf("enm.")&&(i+="_Key"),a.type.date_part)t[o]=$p.moment(n[i]).format($p.moment._masks[a.type.date_part]);else if(a.type.is_ref)if(n[i]&&n[i]!=$p.utils.blank.guid){var s=_md.value_mgr(t,e,a.type,!1,n[i]);t[o]=s?s.get(n[i]).presentation:""}else t[o]="";else t[o]=n[i]}),p.push(t);return $p.iface.data_to_grid.call(r,p,e)})},InfoRegManager.prototype.rest_slice_last=function(e){e.period||(e.period=$p.utils.date_add_day(new Date,1));var t=this,n=t.metadata(),i="Period=datetime'"+$p.moment(e.period).format($p.moment._masks.iso)+"'",a="";for(var o in n.dimensions)if(void 0!==e[o]){var s=_md.syns_1с(o),r=n.dimensions[o];-1==s.indexOf("_Key")&&r.type.is_ref&&r.type.types.length&&-1==r.type.types[0].indexOf("enm.")?(s+="_Key",a&&(a+=" and "),a+=s+" eq guid'"+e[o].ref+"'"):(a&&(a+=" and "),r.type.digits?a+=s+" eq "+$p.utils.fix_number(e[o]):r.type.date_part?a+=s+" eq datetime'"+$p.moment(e[o]).format($p.moment._masks.iso)+"'":a+=s+" eq '"+e[o]+"'")}return a&&(i+=",Condition='"+a+"'"),$p.ajax.default_attr(e,$p.job_prm.rest_url()),e.url+=this.rest_name+"/SliceLast(%sl)?allowedOnly=true&$format=json&$top=1000".replace("%sl",i),_rest.ajax_to_data(e,t).then(function(e){return t.load_array(e)})},DataObj.prototype.to_atom=function(e){function t(e){var t=e._metadata.fields,a=e instanceof TabularSectionRow?"\n\t<d:":"\n<d:";for(n in t){if(i=t[n],s=_md.syns_1с(n),(r=e[n])instanceof EnumObj)r=r.empty()?"":r.name;else if(r instanceof DataObj)-1==s.indexOf("_Key")&&(s+="_Key"),r=r.ref;else if(i.type.date_part)r=r.getFullYear()<1e3?"0001-01-01T00:00:00Z":$p.moment(r).format($p.moment.defaultFormatUtc);else if(void 0==r)continue;c+=a+s+">"+r+"</d:"+s+">"}}var n,i,a,o,s,r,l='<entry><category term="StandardODATA.%n" scheme="http://schemas.microsoft.com/ado/2007/08/dataservices/scheme"/>\t\t\t\t\n<title type="text"/><updated>%d</updated><author/><summary/><content type="application/xml">\t\t\t\t\n<m:properties xmlns:d="http://schemas.microsoft.com/ado/2007/08/dataservices" xmlns:m="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata">\t\t\t%p\t\t\t\n</m:properties></content></entry>'.replace("%n",this._manager.rest_name).replace("%d",$p.moment().format($p.moment.defaultFormatUtc)),c="\n<d:Ref_Key>"+this.ref+"</d:Ref_Key>\n<d:DeletionMark>"+this._deleted+"</d:DeletionMark>";this instanceof DocObj?(c+="\n<d:Date>"+$p.moment(this.date).format($p.moment.defaultFormatUtc)+"</d:Date>",c+="\n<d:Number>"+this.number_doc+"</d:Number>"):(this._metadata.main_presentation_name&&(c+="\n<d:Description>"+this.name+"</d:Description>"),this._metadata.code_length&&(c+="\n<d:Code>"+this.id+"</d:Code>"),this._metadata.hierarchical&&this._metadata.group_hierarchy&&(c+="\n<d:IsFolder>"+this.is_folder+"</d:IsFolder>")),t(this);for(a in this._metadata.tabular_sections)this._metadata.tabular_sections[a],s="StandardODATA."+this._manager.rest_name+"_"+_md.syns_1с(a)+"_RowType",o=this[a],o.count()?(c+="\n<d:"+_md.syns_1с(a)+' m:type="Collection('+s+')">',o.each(function(e){c+='\n\t<d:element m:type="'+s+'">',c+="\n\t<d:LineNumber>"+e.row+"</d:LineNumber>",t(e),c+="\n\t</d:element>"}),c+="\n</d:"+_md.syns_1с(a)+">"):c+="\n<d:"+_md.syns_1с(a)+' m:type="Collection('+s+')" />';return l.replace("%p",c)},DataManager.prototype.__define({pouch_load_array:{value:function(e,t){var n={limit:e.length+1,include_docs:!0,keys:e.map(function(e){return this.class_name+"|"+e}.bind(this))};return t&&(n.attachments=!0,n.binary=!0),this.pouch_db.allDocs(n).then(function(e){return $p.wsql.pouch.load_changes(e,{})})}},pouch_load_view:{value:function(e){var t,n=this,i=[],a={limit:1e3,include_docs:!0,startkey:n.class_name+"|",endkey:n.class_name+"|￰"};return new Promise(function(o,s){function r(l,c){c?c.rows.length?(a.startkey=c.rows[c.rows.length-1].key,a.skip=1,c.rows.forEach(function(e){t=e.doc,key=t._id.split("|"),t.ref=key[1],i.push(t)}),n.load_array(i),i.length=0,n.pouch_db.query(e,a,r)):o():l&&s(l)}n.pouch_db.query(e,a,r)})}},pouch_db:{get:function(){const e=this.cachable.replace("_ram","");return-1!=e.indexOf("remote")?$p.wsql.pouch.remote[e.replace("_remote","")]:$p.wsql.pouch.local[e]||$p.wsql.pouch.remote[e]}},pouch_find_rows:{value:function(e){var t,n,i,a,o,s,r=this,l=[],c=0,p=0,d=0,u={limit:100,include_docs:!0,startkey:r.class_name+"|",endkey:r.class_name+"|￰"};return e&&(e._top?(o=e._top,delete e._top):o=300,e._raw&&(n=e._raw,delete e._raw),e._total_count&&(a=e._total_count,delete e._total_count),e._view&&(i=e._view,delete e._view),e._key&&("des"==e._key._order_by?(u.startkey=e._key.endkey||e._key+"￰",u.endkey=e._key.startkey||e._key,u.descending=!0):(u.startkey=e._key.startkey||e._key,u.endkey=e._key.endkey||e._key+"￰")),"number"==typeof e._skip&&(p=e._skip,delete e._skip),e._attachments&&(u.attachments=!0,u.binary=!0,delete e._attachments)),a&&(s=!0,a=0,Object.keys(e).length<=1&&e._key&&e._key.hasOwnProperty("_search"))?(u.include_docs=!1,u.limit=1e5,r.pouch_db.query(i,u).then(function(t){return t.rows.forEach(function(t){if(!e._key._search||-1!=t.key[t.key.length-1].toLowerCase().indexOf(e._key._search)){if(a++,p&&++d<p)return;if(o&&++c>o)return;l.push(t.id)}}),delete u.startkey,delete u.endkey,u.descending&&delete u.descending,u.keys=l,u.include_docs=!0,r.pouch_db.allDocs(u)}).then(function(e){return{rows:e.rows.map(function(e){var t=e.doc;return t.ref=t._id.split("|")[1],n||(delete t._id,delete t._rev),t}),_total_count:a}})):new Promise(function(f,m){function _(i,_){_?_.rows.length?(u.startkey=_.rows[_.rows.length-1].key,u.skip=1,_.rows.forEach(function(i){t=i.doc,key=t._id.split("|"),t.ref=key[1],n||(delete t._id,delete t._rev),$p._selection.call(r,t,e)&&(s&&a++,p&&++d<p||o&&++c>o||l.push(t))}),o&&c>o&&!s?f(n?l:r.load_array(l)):h()):f(s?{rows:n?l:r.load_array(l),_total_count:a}:n?l:r.load_array(l)):i&&m(i)}function h(){i?r.pouch_db.query(i,u,_):r.pouch_db.allDocs(u,_)}h()})}},pouch_selection:{value:function(e){var t,n,i,a=this,o=e.metadata||a.metadata(),s=["ref","_deleted"],r={_raw:!0,_total_count:!0,_top:e.count||30,_skip:e.start||0},l=[];if(o.form&&o.form.selection?o.form.selection.fields.forEach(function(e){s.push(e)}):a instanceof DocManager?(s.push("posted"),s.push("date"),s.push("number_doc")):a instanceof TaskManager?(s.push("name as presentation"),s.push("date"),s.push("number_doc"),s.push("completed")):a instanceof BusinessProcessManager?(s.push("date"),s.push("number_doc"),s.push("started"),s.push("finished")):(o.hierarchical&&o.group_hierarchy?s.push("is_folder"):s.push("0 as is_folder"),o.main_presentation_name?s.push("name as presentation"):o.code_length?s.push("id as presentation"):s.push("'...' as presentation"),o.has_owners&&s.push("owner"),o.code_length&&s.push("id")),_md.get(a.class_name,"date")&&(e.date_from||e.date_till)&&(e.date_from||(e.date_from=new Date("2015-01-01")),e.date_till||(e.date_till=$p.utils.date_add_day(new Date,1)),r.date={between:[e.date_from,e.date_till]}),o.hierarchical&&e.parent&&(r.parent=e.parent),e.selection)if(Array.isArray(e.selection))e.selection.forEach(function(e){for(i in e)"_"==i[0]&&"_view"!=i&&"_key"!=i||(r[i]=e[i])});else for(i in e.selection)"_"==i[0]&&"_view"!=i&&"_key"!=i||(r[i]=e.selection[i]);return r._key&&r._key._drop_date&&r.date&&delete r.date,!e.filter||r._key&&r._key._search||(1==o.input_by_string.length?r[o.input_by_string]={like:e.filter}:(r.or=[],o.input_by_string.forEach(function(t){var n={};n[t]={like:e.filter},r.or.push(n)}))),r._key&&r._key._order_by&&(r._key._order_by=e.direction),a.pouch_find_rows(r).then(function(o){return o.hasOwnProperty("_total_count")&&o.hasOwnProperty("rows")&&(e._total_count=o._total_count,o=o.rows),o.forEach(function(e){t={},s.forEach(function(o){if("ref"==o)return void(t[o]=e[o]);if(-1!=o.indexOf(" as ")?(i=o.split(" as ")[1],o=o.split(" as ")[0].split("."),o=o[o.length-1]):i=o,n=_md.get(a.class_name,o))if(n.type.date_part)t[i]=$p.moment(e[o]).format($p.moment._masks[n.type.date_part]);else if(n.type.is_ref)if(e[o]&&e[o]!=$p.utils.blank.guid){var s=_md.value_mgr(t,o,n.type,!1,e[o]);t[i]=s?s.get(e[o]).presentation:""}else t[i]="";else"number"==typeof e[o]&&n.type.fraction_figits?t[i]=e[o].toFixed(n.type.fraction_figits):t[i]=e[o]}),l.push(t)}),$p.iface.data_to_grid.call(a,l,e)}).catch($p.record_log)}},pouch_tree:{value:function(e){return this.pouch_find_rows({is_folder:!0,_raw:!0,_top:e.count||300,_skip:e.start||0}).then(function(e){return e.sort(function(e,t){return e.parent==$p.utils.blank.guid&&t.parent!=$p.utils.blank.guid?-1:t.parent==$p.utils.blank.guid&&e.parent!=$p.utils.blank.guid?1:e.name<t.name?-1:e.name>t.name?1:0}),e.map(function(e){return{ref:e.ref,parent:e.parent,presentation:e.name}})}).then($p.iface.data_to_tree)}},save_attachment:{value:function(e,t,n,i){i||(i={type:"text/plain"}),n instanceof Blob||-1!=i.indexOf("text")||(n=new Blob([n],{type:i}));var a,o=this.pouch_db;return e=this.class_name+"|"+$p.utils.fix_guid(e),o.get(e).then(function(e){e&&(a=e._rev)}).catch(function(e){if(404!=e.status)throw e}).then(function(){return o.putAttachment(e,t,a,n,i)})}},get_attachment:{value:function(e,t){return this.pouch_db.getAttachment(this.class_name+"|"+$p.utils.fix_guid(e),t)}},delete_attachment:{value:function(e,t){var n,i=this.pouch_db;return e=this.class_name+"|"+$p.utils.fix_guid(e),i.get(e).then(function(e){e&&(n=e._rev)}).catch(function(e){if(404!=e.status)throw e}).then(function(){return i.removeAttachment(e,t,n)})}}}),DataObj.prototype.__define({new_number_doc:{value:function(e){if(this._metadata.code_length){e||(e=($p.current_user&&$p.current_user.prefix||"")+(this.organization&&this.organization.prefix||""));var t=this,n="",i=this.date instanceof Date?this.date.getFullYear():0,a=this._metadata.code_length-e.length;return"ram"==this._manager.cachable?Promise.resolve(this.new_cat_id(e)):t._manager.pouch_db.query("doc/number_doc",{limit:1,include_docs:!1,startkey:[t.class_name,i,e+"￰"],endkey:[t.class_name,i,e],descending:!0}).then(function(i){if(i.rows.length){for(var o=i.rows[0].key[2],s=o.length-1;s>0&&!isNaN(parseInt(o[s]));s--)n=o[s]+n;n=(parseInt(n||0)+1).toFixed(0)}else n="1";for(;n.length<a;)n="0"+n;return t instanceof DocObj||t instanceof TaskObj||t instanceof BusinessProcessObj?t.number_doc=e+n:t.id=e+n,t})}}},new_cat_id:{value:function(e){e||(e=($p.current_user&&$p.current_user.prefix||"")+(this.organization&&this.organization.prefix?this.organization.prefix:$p.wsql.get_user_param("zone")+"-"));var t=this._metadata.code_length-e.length,n=this instanceof DocObj||this instanceof TaskObj||this instanceof BusinessProcessObj?"number_doc":"id",i="",a=$p.wsql.alasql("select top 1 "+n+" as id from ? where "+n+" like '"+e+"%' order by "+n+" desc",[this._manager.alatable]);if(a.length){for(var o=a[0].id||"",s=o.length-1;s>0&&!isNaN(parseInt(o[s]));s--)i=o[s]+i;i=(parseInt(i||0)+1).toFixed(0)}else i="1";for(;i.length<t;)i="0"+i;return this[n]=e+i,this}}}),$p.iface.OBtnAuthSync=function(){function e(){$p.wsql.pouch.authorized?dhtmlx.confirm({title:$p.msg.log_out_title,text:$p.msg.logged_in+$p.wsql.pouch.authorized+$p.msg.log_out_break,cancel:$p.msg.cancel,callback:function(e){e&&$p.wsql.pouch.log_out()}}):$p.iface.frm_auth({modal_dialog:!0})}function t(e){e&&i?clearTimeout(i):a.forEach(function(t){e?t.buttons.sync.innerHTML='<i class="fa fa-refresh fa-spin md-fa-lg"></i>':$p.wsql.pouch.authorized?t.buttons.sync.innerHTML='<i class="fa fa-refresh md-fa-lg"></i>':t.buttons.sync.innerHTML='<i class="fa fa-ban md-fa-lg"></i>'}),i=e?setTimeout(t,3e3):0}function n(){a.forEach(function(e){$p.wsql.pouch.authorized?(e.buttons.auth.title="Отключиться от сервера",e.buttons.auth.innerHTML='<span class="span_user">'+$p.wsql.pouch.authorized+"</span>",e.buttons.sync.title="Синхронизация выполняется...",e.buttons.sync.innerHTML='<i class="fa fa-refresh md-fa-lg"></i>'):(e.buttons.auth.title="Войти на сервер и включить синхронизацию данных",e.buttons.auth.innerHTML='&nbsp;<i class="fa fa-sign-in md-fa-lg"></i><span class="span_user">Вход...</span>',e.buttons.sync.title="Синхронизация не выполняется - пользователь не авторизован на сервере",e.buttons.sync.innerHTML='<i class="fa fa-ban md-fa-lg"></i>')})}var i,a=[];this.bind=function(t){return t.buttons.auth.onclick=e,t.buttons.sync.onclick=null,a.push(t),setTimeout(n),t},$p.on({pouch_load_data_start:function(e){$p.iface.sync||$p.iface.wnd_sync(),$p.iface.sync.create($p.eve.stepper),$p.eve.stepper.frm_sync.setItemValue("text_bottom","Читаем справочники"),e.hasOwnProperty("local_rows")&&e.local_rows<10?($p.eve.stepper.wnd_sync.setText("Первый запуск - подготовка данных"),$p.eve.stepper.frm_sync.setItemValue("text_processed","Загрузка начального образа")):($p.eve.stepper.wnd_sync.setText("Загрузка данных из IndexedDB"),$p.eve.stepper.frm_sync.setItemValue("text_processed","Извлечение начального образа")),t(!0)},pouch_load_data_page:function(e){t(!0);var n=$p.eve.stepper;if(n.wnd_sync){var i=n[e.id||"ram"];i.total_rows=e.total_rows,i.page=e.page,i.docs_written=e.docs_written||e.page*e.limit,i.docs_written>i.total_rows&&(i.total_rows=(1.05*i.docs_written).round(0));var a,o;if(n.doc.docs_written){var s=n.ram.docs_written+n.doc.docs_written,r=n.ram.total_rows+n.doc.total_rows;i=n.ram.page+n.doc.page,a="Обработано ram: "+n.ram.docs_written+" из "+n.ram.total_rows+"<br />Обработано doc: "+n.doc.docs_written+" из "+n.doc.total_rows,o="Текущий запрос: "+i+" ("+(100*s/r).toFixed(0)+"%)"}else a="Обработано элементов: "+i.docs_written+" из "+i.total_rows,o="Текущий запрос: "+i.page+" ("+(100*i.docs_written/i.total_rows).toFixed(0)+"%)";n.frm_sync.setItemValue("text_current",a),n.frm_sync.setItemValue("text_bottom",o)}},pouch_change:function(e,n){t(!0)},pouch_data_loaded:function(e){$p.eve.stepper.wnd_sync&&$p.iface.sync.close()},pouch_load_data_error:function(e){t(),$p.eve.stepper.wnd_sync&&$p.iface.sync.close()},user_log_in:function(e){n()},user_log_fault:function(){n()},user_log_out:function(){n()}})};var eXcell_proto=new eXcell;eXcell_proto.input_keydown=function(e,t){function n(e){t.source.on_select&&t.source.on_select.call(t.source,e)}if(8===e.keyCode||46===e.keyCode)t.setValue(""),t.grid.editStop(),t.source.on_select&&t.source.on_select.call(t.source,"");else if(9===e.keyCode||13===e.keyCode)t.grid.editStop();else if(115===e.keyCode)t.cell.firstChild.childNodes[1].onclick(e);else if(113===e.keyCode)if(t.source.tabular_section){if(t.mgr=_md.value_mgr(t.source.row,t.source.col,t.source.row._metadata.fields[t.source.col].type),t.mgr){var i=t.source.row[t.source.col];t.mgr.form_obj(t.source.wnd,{o:i,on_select:n})}}else if(1==t.fpath.length&&(t.mgr=_md.value_mgr(t.source.o._obj,t.fpath[0],t.source.o._metadata.fields[t.fpath[0]].type),t.mgr)){var i=t.source.o[t.fpath[0]];t.mgr.form_obj(t.source.wnd,{o:i,on_select:n})}return $p.iface.cancel_bubble(e)},eXcell_ocombo.prototype=eXcell_proto,window.eXcell_ocombo=eXcell_ocombo,window.eXcell_ref=eXcell_ocombo,window.eXcell_refc=eXcell_ocombo,eXcell_pwd.prototype=eXcell_proto,window.eXcell_pwd=eXcell_pwd,dhtmlXCalendarObject.prototype._dateToStr=function(e,t){return e instanceof Date&&e.getFullYear()<1e3?"":window.dhx4.date2str(e,t||this._dateFormat,this._dateStrings())},eXcell_dhxCalendar.prototype.edit=function(){var e=this.grid.getPosition(this.cell);this.grid._grid_calendarA._show(!1,!1),this.grid._grid_calendarA.setPosition(e[0],e[1]+this.cell.offsetHeight),this.grid._grid_calendarA._last_operation_calendar=!1,this.grid.callEvent("onCalendarShow",[this.grid._grid_calendarA,this.cell.parentNode.idd,this.cell._cellIndex]),this.cell._cediton=!0,this.val=this.cell.val,this.val instanceof Date&&this.val.getFullYear()<1e3&&(this.val=new Date),this._val=this.cell.innerHTML;var t=this.grid._grid_calendarA.draw;this.grid._grid_calendarA.draw=function(){},this.grid._grid_calendarA.setDateFormat(this.grid._dtmask||"%d.%m.%Y"),this.grid._grid_calendarA.setDate(this.val||new Date),this.grid._grid_calendarA.draw=t},eXcell_dhxCalendar.prototype.setCValue=function(e,t){this.cell.innerHTML=e instanceof Date?this.grid._grid_calendarA._dateToStr(e):e,this.grid._grid_calendarA.getFormatedDate(this.grid._dtmask||"%d/%m/%Y",e).toString(),this.grid.callEvent("onCellChanged",[this.cell.parentNode.idd,this.cell._cellIndex,arguments.length>1?t:e])},function(){function e(e,t,n,i){if(-1!=n.indexOf("odata/standard.odata")||-1!=n.indexOf("/hs/rest")){var a,o;$p.ajax.authorized?(a=$p.ajax.username,o=$p.aes.Ctr.decrypt($p.ajax.password)):$p.job_prm.guest_name?(a=$p.job_prm.guest_name,o=$p.aes.Ctr.decrypt($p.job_prm.guest_pwd)):(a=$p.wsql.get_user_param("user_name"),o=$p.aes.Ctr.decrypt($p.wsql.get_user_param("user_pwd"))),e.open(t,n,i,a,o),e.withCredentials=!0,e.setRequestHeader("Authorization","Basic "+btoa(unescape(encodeURIComponent(a+":"+o))))}else e.open(t,n,i)}dhx4.ajax._call=function(t,n,i,a,o,s,r){var l=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),c=null!=navigator.userAgent.match(/AppleWebKit/)&&null!=navigator.userAgent.match(/Qt/)&&null!=navigator.userAgent.match(/Safari/);if(1==a&&(l.onreadystatechange=function(){if(4==l.readyState||1==c&&3==l.readyState){if((200!=l.status||""==l.responseText)&&!dhx4.callEvent("onAjaxError",[{xmlDoc:l,filePath:n,async:a}]))return;window.setTimeout(function(){"function"==typeof o&&o.apply(window,[{xmlDoc:l,filePath:n,async:a}]),null!=s&&(void 0!==s.postData?dhx4.ajax.postLong(s.url,s.postData,o):dhx4.ajax.getLong(s.url,o)),o=null,l=null},1)}}),"GET"==t&&(n+=this._dhxr(n)),l.open(t,n,a),e(l,t,n,a),null!=r)for(var p in r)l.setRequestHeader(p,r[p]);else"POST"==t||"PUT"==t||"DELETE"==t?l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"):"GET"==t&&(i=null);return l.setRequestHeader("X-Requested-With","XMLHttpRequest"),l.send(i),1!=a&&(4==l.readyState||1==c&&3==l.readyState)&&(200==l.status&&""!=l.responseText||dhx4.callEvent("onAjaxError",[{xmlDoc:l,filePath:n,async:a}])),{xmlDoc:l,filePath:n,async:a}},dhtmlx.ajax.prototype.send=function(t,n,i){var a=this.getXHR();if("function"==typeof i&&(i=[i]),"object"==typeof n){var o=[];for(var s in n){var r=n[s];null!==r&&r!==dhtmlx.undefined||(r=""),o.push(s+"="+encodeURIComponent(r))}n=o.join("&")}n&&!this.post&&(t=t+(-1!=t.indexOf("?")?"&":"?")+n,n=null),e(a,this.post?"POST":"GET",t,!this._sync),this.post&&a.setRequestHeader("Content-type","application/x-www-form-urlencoded");var l=this;return a.onreadystatechange=function(){if(!a.readyState||4==a.readyState){if(i&&l)for(var e=0;e<i.length;e++)i[e]&&i[e].call(l.master||l,a.responseText,a.responseXML,a);l.master=null,i=l=null}},a.send(n||null),a}}(),dhtmlXCellObject.prototype.is_visible=function(){var e=this.cell.getBoundingClientRect();return e.right>0&&e.bottom>0},$p.iface.data_to_grid=function(e,t){function n(e){var t;return t=e.hasOwnProperty("posted")?e.posted?"cell_doc_posted":"cell_doc":e.is_folder?"cell_ref_folder":"cell_ref_elm",e._deleted&&(t+="_deleted"),t}function i(e){return e instanceof Date?e.getHours()||e.getMinutes()?$p.moment(e).format($p.moment._masks.date_time):$p.moment(e).format($p.moment._masks.date):"number"==typeof e?e:$p.iface.normalize_xml(e||"")}if(this.data_to_grid)return this.data_to_grid(e,t);var a="<?xml version='1.0' encoding='UTF-8'?><rows total_count='%1' pos='%2' set_parent='%3'>".replace("%1",t._total_count||e.length).replace("%2",t.start).replace("%3",t.set_parent||""),o=this.caption_flds(t);return a+=o.head,e.forEach(function(e){a+='<row id="'+e.ref+'"><cell class="'+n(e)+'">'+i(e[o.acols[0].id])+"</cell>";for(var t=1;t<o.acols.length;t++)a+="<cell>"+i(e[o.acols[t].id])+"</cell>";a+="</row>"}),a+"</rows>"},$p.iface.data_to_tree=function(e){function t(n,i){var a={id:i.ref,text:i.presentation,items:[]};n.push(a),$p._find_rows(e,{parent:i.ref},function(e){t(a.items,e)}),a.items.length||delete a.items}var n=[{id:$p.utils.blank.guid,text:"..."}];return $p._find_rows(e,{parent:$p.utils.blank.guid},function(e){t(n,e)}),n},$p.iface.ODropdownList=ODropdownList,dhtmlXCellObject.prototype.attachDynTree=function(e,t,n){this.setCollapsedText&&this.setCollapsedText("Дерево"),t||(t={is_folder:!0});var i=this.attachTreeView();return i.__define({filter:{get:function(){},set:function(e){t=e},enumerable:!1,configurable:!1}}),setTimeout(function(){e.sync_grid({action:"get_tree",filter:t},i).then(function(e){n&&n(e)})}),i},OCombo._extend(dhtmlXCombo),$p.iface.OCombo=OCombo,$p.iface.select_from_list=function(e,t){return new Promise(function(n,i){function a(e){"cancel"!=e&&(o=c.getSelectedRowId()),l.close()}Array.isArray(e)&&e.length?1==e.length&&n(e[0]):n(void 0);var o,s,r={name:"wnd_select_from_list",wnd:{id:"wnd_select_from_list",width:300,height:300,modal:!0,center:!0,caption:$p.msg.select_from_list,allow_close:!0,on_close:function(){return o&&n(e[parseInt(o)-1]),!0}}},l=$p.iface.dat_blank(null,r.wnd),c=l.attachGrid(),p=l.attachToolbar({items:[{id:"select",type:"button",text:$p.msg.select_from_list},{id:"cancel",type:"button",text:"Отмена"}],onClick:a});c.setIconsPath(dhtmlx.image_path),c.setImagePath(dhtmlx.image_path),c.setHeader($p.msg.value),c.setColTypes("ro"),c.enableAutoWidth(!0,1200,600),c.attachEvent("onRowDblClicked",a),c.enableMultiselect(!!t),c.setNoHeader(!0),c.init(),p.addSpacer("select"),l.hideHeader(),l.cell.offsetParent.querySelector(".dhxwin_brd").style.border="none",e.forEach(function(e,t){var n;n="object"==typeof e?e.presentation||e.text||e.toString():e.toString(),c.addRow(1+t,n),e.selected&&(s=1+t)}),s&&c.selectRowById(s)})},$p.iface.query_value=function(e,t){return new Promise(function(n,i){var a={name:"wnd_query_value",wnd:{width:300,height:160,modal:!0,center:!0,caption:t||"Введите значение",allow_close:!0,on_close:function(){return i(),!0}}},o=$p.iface.dat_blank(null,a.wnd);o.attachToolbar({items:[{id:"select",type:"button",text:"<b>Ok</b>"},{id:"sp",type:"spacer"},{id:"cancel",type:"button",text:"Отмена"}],onClick:function(e){"cancel"==e?o.close():(n(o.cell.querySelector("INPUT").value),o.close())}});o.attachHTMLString("<input type='text' style='width: 94%; padding: 4px;' value='"+e+"' />")})},$p.iface.ODateRangePicker=ODateRangePicker,dhtmlXCellObject.prototype.attachHeadFields=function(e){function t(e){if(i)u.entBox&&!u.entBox.parentElement?setTimeout(u.destructor):e.forEach(function(e){"unload"==e.type?d&&d.close?d.close():u.destructor():u.forEachRow(function(t){t==e.name&&u.cells(t,1).setValue(i[e.name])})});else{var a=[];e.forEach(function(e){-1==a.indexOf[e.object]&&(a.push(e.object),Object.unobserve(e.object,t),c&&c instanceof TabularSection&&Object.unobserve(e.object,n))}),a=null}}function n(t){var n;t.forEach(function(t){!n&&u.clearAll&&l==t.tabular&&(n=!0,u.clearAll(),u.parse(s.get_property_grid_xml(a,i,{title:e.ts_title,ts:l,selection:r,metadata:o}),function(){},"xml"))})}var i,a,o,s,r,l,c,p,d=this,u=d.attachGrid(),f=u.destructor;return new dhtmlXPropertyGrid(u),u.setInitWidthsP("40,60"),u.setDateFormat("%d.%m.%Y %H:%i"),u.init(),u.setSizes(),u.attachEvent("onPropertyChanged",function(e,t,n){if(e||u&&u.getSelectedRowId())return p.on_select(t)}),u.attachEvent("onCheckbox",function(e,t,n){return void 0!=i[e]?p.on_select(n,{obj:i,field:e}):e.split("|").length>1?p.on_select(n,u.get_cell_field(e)):void 0}),u.attachEvent("onKeyPress",function(e,t,n){switch(e){case 13:case 9:u.editStop&&u.editStop()}}),e.read_only&&u.setEditable(!1),u.__define({selection:{get:function(){return r},set:function(e){r=e,this.reload()}},reload:{value:function(){n([{tabular:l}])}},get_cell_field:{value:function(e){if(i){var t={row_id:e||u.getSelectedRowId()},n=t.row_id.split("|");if(n.length<2)return{obj:i,field:n[0]}._mixin(p);var a;return r?i[n[0]].find_rows(r,function(e){if(e.property==n[1]||e.param==n[1]||e.Свойство==n[1]||e.Параметр==n[1])return a=e,!1}):a=i[n[0]].find(n[1]),a?(t.obj=a,a["Значение"]?(t.field="Значение",t.property=a.Свойство||a.Параметр):(t.field="value",t.property=a.property||a.param),t._mixin(p)):void 0}},enumerable:!1},_obj:{get:function(){return i}},_owner_cell:{get:function(){return d}},destructor:{value:function(){i&&Object.unobserve(i,t),c&&c instanceof TabularSection&&Object.unobserve(c,n),i=null,c=null,o=null,s=null,p=null,f.call(u)}},attach:{value:function(e){i&&Object.unobserve(i,t),c&&c instanceof TabularSection&&Object.unobserve(i,n),e.oxml&&(a=e.oxml),e.selection&&(r=e.selection),i=e.obj,o=e.metadata||i._metadata.fields,s=i._manager,l=e.ts||"",c=l?i[l]:i.extra_fields||i["ДополнительныеРеквизиты"],c&&!l&&(l=i.extra_fields?"extra_fields":"ДополнительныеРеквизиты"),p={on_select:function(e,t){if(t||(t=u.get_cell_field()),t){var n=s.handle_event(i,"value_change",{field:t.field,value:e,tabular_section:t.row_id?l:"",grid:u,cell:u.cells(t.row_id||t.field,1),wnd:p.pwnd});return"boolean"!=typeof n&&(t.obj[t.field]=e,n=!0),n}},pwnd:e.pwnd||d},Object.observe(i,t,["update","unload"]),c&&c instanceof TabularSection&&Object.observe(i,n,["row","rows"]),l&&!e.ts_title&&(e.ts_title=i._metadata.tabular_sections[l].synonym),n([{tabular:l}])}}}),e&&u.attach(e),u},dhtmlXGridObject.prototype.get_cell_value=function(){var e=this.get_cell_field();if(e&&e.obj)return e.obj[e.field]},dhtmlXCellObject.prototype.attachTabular=function(e){function t(e){var t=v.getSelectedRowId();if(t&&!isNaN(Number(t)))return Number(t)-1;e||$p.msg.show_msg({type:"alert-warning",text:$p.msg.no_selected_row.replace("%1",p._metadata.tabular_sections[d].synonym||d),title:(p._metadata.obj_presentation||p._metadata.synonym)+": "+p.presentation})}
function n(e,t,n,i,a){if(2!=e||i==a)return!0;var o=v.get_cell_field();if(!o)return!0;var s=f.handle_event(p,"value_change",{field:o.field,value:i,tabular_section:d,grid:v,row:o.obj,cell:t&&n?v.cells(t,n):v.getSelectedCellIndex()>=0?v.cells():null,wnd:$.pwnd});return"boolean"!=typeof s&&(o.obj[o.field]=i,s=!0),s}function i(e){v.clearAll&&e.some(function(e){if("rows"==e.type&&e.tabular==d)return u.sync_grid(v,x),!0})}function a(e){if(e.length>20)try{u.sync_grid(v,x)}catch(e){}else e.forEach(function(e){d==e.tabular&&(e.row&&v.getSelectedRowId()==e.row.row?void 0!=v.getColIndexById(e.name)&&("boolean"==typeof e.oldValue&&"boolean"==typeof e.row[e.name]||v.cells(e.row.row,v.getColIndexById(e.name)).setCValue($p.utils.is_data_obj(e.row[e.name])?e.row[e.name].presentation:e.row[e.name])):u.sync_grid(v,x))})}function o(e){if(-1!=e.clipboardData.types.indexOf("text/plain"))try{$p.eve.callEvent("tabular_paste",[{obj:p,grid:v,tsname:d,e:e,data:e.clipboardData.getData("text/plain")}])}catch(e){return}}function s(e){if(!g)return!0;var t;return h.fields.some(function(n){var i=e._row[n];if($p.utils.is_data_obj(i)){if(!i.is_new()&&i.presentation.match(g))return t=!0}else{if("number"==typeof i)return t=i.toLocaleString().match(g);if(i instanceof Date)return t=$p.moment(i).format($p.moment._masks.date_time).match(g);if(i.match)return t=i.match(g)}}),t}function r(){b&&(clearTimeout(b),b=0),g!=_.input_filter.value&&(g=new RegExp(_.input_filter.value,"i"),i([{tabular:d,type:"rows"}]))}function l(){var e=_.input_filter.value;setTimeout(function(){e!=_.input_filter.value&&r()})}function c(){b&&clearTimeout(b),b=setTimeout(function(){b&&r()},500)}var p=e.obj,d=e.ts,u=p[d],f=p._manager,m=e.metadata||f.metadata().tabular_sections[d].fields,_=this,h=e.ts_captions||{},g="",b=0,x=e.selection||{};if(e.ts_captions||_md.ts_captions(f.class_name,d,h)){x.filter_selection=s;var v=this.attachGrid(),y=this.attachToolbar(),w=v.destructor,$={on_select:function(e){n(2,null,null,e)},pwnd:e.pwnd||_,is_tabular:!0};if(v.setDateFormat("%d.%m.%Y %H:%i"),v.enableAccessKeyMap(),v._add_row=function(){if(!e.read_only&&!e.disable_add_del){var t;if(x)for(var n in x)m[n]&&"function"!=typeof x[n]&&("object"!=typeof x[n]||$p.is_data_obj(x[n]))&&(t||(t={}),t[n]=x[n]);u._owner._silent(!1);var i=u.add(t);if(!1===f.handle_event(p,"add_row",{tabular_section:d,grid:v,row:i,wnd:$.pwnd}))return;setTimeout(function(){v.selectRowById(i.row)},100)}},v._move_row=function(n){if(!e.read_only){var i=t();void 0!=i&&(u._owner._silent(!1),"up"==n?0!=i&&(u.swap(i-1,i),setTimeout(function(){v.selectRow(i-1,!0)},100)):i<u.count()-1&&(u.swap(i,i+1),setTimeout(function(){v.selectRow(i+1,!0)},100)))}},v._del_row=function(n){if(!e.read_only&&!e.disable_add_del){var i=t();if(void 0!=i){if(u._owner._silent(!1),!1===f.handle_event(p,"del_row",{tabular_section:d,grid:v,row:i,wnd:$.pwnd}))return;u.del(i),setTimeout(function(){v.selectRowById(i<u.count()?i+1:i,!0)},100)}}},y.setIconsPath(dhtmlx.image_path+"dhxtoolbar"+dhtmlx.skin_suffix()),y.loadStruct(e.toolbar_struct||$p.injected_data["toolbar_add_del.xml"],function(){this.forEachItem(function(e){"input_filter"==e&&(_.input_filter=y.getInput(e),_.input_filter.onchange=r,_.input_filter.onclick=l,_.input_filter.onkeydown=c,_.input_filter.type="search",_.input_filter.setAttribute("placeholder","Фильтр"))}),this.attachEvent("onclick",function(e){switch(e){case"btn_add":v._add_row();break;case"btn_delete":v._del_row();break;case"btn_up":v._move_row("up");break;case"btn_down":v._move_row("down")}})}),v.setIconsPath(dhtmlx.image_path),v.setImagePath(dhtmlx.image_path),v.setHeader(h.headers),h.min_widths&&v.setInitWidths(h.widths),h.min_widths&&v.setColumnMinWidth(h.min_widths),h.aligns&&v.setColAlign(h.aligns),v.setColSorting(h.sortings),v.setColTypes(h.types),v.setColumnIds(h.fields.join(",")),v.enableAutoWidth(!0,1200,600),v.enableEditTabOnly(!0),v.init(),(e.read_only||e.disable_add_del)&&(e.read_only&&v.setEditable(!1),y.forEachItem(function(e){-1!=["btn_add","btn_delete"].indexOf(e)&&y.disableItem(e)})),e.reorder){var j=y.getPosition("btn_delete");j&&(y.addSeparator("sep_up",j+1),y.addButton("btn_up",j+2,'<i class="fa fa-arrow-up fa-fw"></i>'),y.addButton("btn_down",j+3,'<i class="fa fa-arrow-down fa-fw"></i>'),y.setItemToolTip("btn_up","Переместить строку вверх"),y.setItemToolTip("btn_down","Переместить строку вниз"))}return v.__define({_obj:{get:function(){return p}},selection:{get:function(){return x},set:function(e){x=e,i([{tabular:d,type:"rows"}])}},destructor:{value:function(){p&&(Object.unobserve(p,a),Object.unobserve(p,i)),p=null,u=null,m=null,f=null,$=null,_.detachToolbar(),v.entBox.removeEventListener("paste",o),w.call(v)}},get_cell_field:{value:function(){if(u){var e,n,i=t(!0),a=v.getSelectedCellIndex();if(void 0!=i?e=u.get(i):v._last&&(e=u.get(v._last.row)),a>=0?n=v.getColumnId(a):v._last&&(n=v.getColumnId(v._last.cindex)),e&&n)return{obj:e,field:n,metadata:m[n]}._mixin($)}}},refresh_row:{value:function(e){v.selectRowById(e.row),v.forEachCell(e.row,function(t,n){var i=e[v.getColumnId(n)];t.setCValue($p.utils.is_data_obj(i)?i.presentation:i)})}}}),v.attachEvent("onEditCell",n),v.attachEvent("onCheck",function(e,t,i){v.selectCell(e-1,t),n(2,e,t,i)}),v.attachEvent("onRowSelect",function(e,t){u&&(v._last={row:e-1,cindex:t})}),v.attachEvent("onHeaderClick",function(e,t){function n(){-1==a?(v.sort_fields.push(i),v.sort_directions.push("asc")):"asc"==v.sort_directions[a]?v.sort_directions[a]="desc":v.sort_directions[a]="asc"}var i=h.fields[e];if(!v.disable_sorting&&"row"!=i){v.sort_fields||(v.sort_fields=[],v.sort_directions=[]);var a=v.sort_fields.indexOf(i);window.event&&window.event.shiftKey?n():(-1==a&&(v.sort_fields.length=0,v.sort_directions.length=0),n()),u.sort(v.sort_fields.map(function(e,t){return e+" "+v.sort_directions[t]})),u.sync_grid(v);for(var o=0;o<h.fields.length;o++){var i=h.fields[o],a=v.sort_fields.indexOf(i);if(-1!=a){v.setSortImgState(!0,o,v.sort_directions[a]),setTimeout(function(){v&&v.sortImg&&(v.sortImg.style.display="inline")},200);break}v.setSortImgState(!1,o)}}}),i([{tabular:d,type:"rows"}]),Object.observe(p,a,["row"]),Object.observe(p,i,["rows"]),v.entBox.addEventListener("paste",o),v}},$p.iface.Toolbar_filter=function(e){function t(){a&&clearTimeout(a),a=setTimeout(function(){a&&i._prev_input_filter!=i.input_filter.value&&i.call_event()},500)}function n(e,t){"min"==t?i.сalendar.setSensitiveRange(e.value,null):i.сalendar.setSensitiveRange(null,e.value)}var i=this,a=0,o="desktop"==$p.job_prm.device_type?200:120,s={};e.pos||(e.pos=6),i.__define({custom_selection:{get:function(){return s}},toolbar:{get:function(){return e.toolbar}},call_event:{value:function(){a&&(clearTimeout(a),a=0),e.onchange.call(i,i.get_filter())}}}),i.toolbar.addText("div_filter",e.pos,""),i.div=i.toolbar.objPull[i.toolbar.idPrefix+"div_filter"],e.pos++,(e.manager instanceof DocManager||e.manager instanceof BusinessProcessManager||e.manager instanceof TaskManager||e.period)&&(o="desktop"==$p.job_prm.device_type?160:120,i.toolbar.addInput("input_date_from",e.pos,"","desktop"==$p.job_prm.device_type?78:72),e.pos++,i.toolbar.addText("lbl_date_till",e.pos,"-"),e.pos++,i.toolbar.addInput("input_date_till",e.pos,"","desktop"==$p.job_prm.device_type?78:72),e.pos++,i.input_date_from=i.toolbar.getInput("input_date_from"),i.input_date_from.onclick=function(){n(i.input_date_till,"max")},i.input_date_till=i.toolbar.getInput("input_date_till"),i.input_date_till.onclick=function(){n(i.input_date_from,"min")},i.сalendar=new dhtmlXCalendarObject([i.input_date_from,i.input_date_till]),i.сalendar.attachEvent("onclick",i.call_event),e.date_from||(e.date_from=new Date((new Date).getFullYear().toFixed()+"-01-01")),e.date_till||(e.date_till=$p.utils.date_add_day(new Date,1)),i.input_date_from.value=$p.moment(e.date_from).format("L"),i.input_date_till.value=$p.moment(e.date_till).format("L"),"doc"!=e.manager.cachable||e.custom_selection||(s._view={get value(){return"doc/by_date"}},s._key={get value(){var t=i.get_filter(!0);return{startkey:[e.manager.class_name,t.date_from.getFullYear(),t.date_from.getMonth()+1,t.date_from.getDate()],endkey:[e.manager.class_name,t.date_till.getFullYear(),t.date_till.getMonth()+1,t.date_till.getDate()],_drop_date:!0,_order_by:!0,_search:t.filter.toLowerCase()}}})),e.hide_filter?i.input_date_till?i.toolbar.addSpacer("input_date_till"):i.toolbar.addSpacer("div_filter"):(i.toolbar.addSeparator("filter_sep",e.pos),e.pos++,i.toolbar.addInput("input_filter",e.pos,"",o),i.input_filter=i.toolbar.getInput("input_filter"),i.input_filter.onchange=function(){i._prev_input_filter!=i.input_filter.value&&i.call_event()},i.input_filter.onclick=function(){var e=i.input_filter.value;setTimeout(function(){e!=i.input_filter.value&&i.call_event()})},i.input_filter.onkeydown=t,i.input_filter.type="search",i.input_filter.setAttribute("placeholder","Фильтр"),i.toolbar.addSpacer("input_filter"))},$p.iface.Toolbar_filter.prototype.__define({get_filter:{value:function(e){this.input_filter&&(this._prev_input_filter=this.input_filter.value);var t,n,i={date_from:this.input_date_from?$p.utils.date_add_day(dhx4.str2date(this.input_date_from.value),0,!0):"",date_till:this.input_date_till?$p.utils.date_add_day(dhx4.str2date(this.input_date_till.value),0,!0):"",filter:this.input_filter?this.input_filter.value:""};if(!e)for(t in this.custom_selection)i.selection||(i.selection=[]),n={},n[t]=this.custom_selection[t].value,i.selection.push(n);return i}},add_filter:{value:function(e){var t=this.toolbar.getPosition("input_filter")-2,n=dhx4.newId(),i=(this.toolbar.getWidth("input_filter")/2).round(0);this.toolbar.setWidth("input_filter",i),this.toolbar.addText("lbl_"+n,t,e.text||""),t++,this.toolbar.addInput("input_"+n,t,"",i),this.custom_selection[e.name]=this.toolbar.getInput("input_"+n)}}}),$p.iface.dat_blank=function(e,t){t||(t={});var n,i=(e||$p.iface.w).createWindow({id:dhx4.newId(),left:t.left||700,top:t.top||20,width:t.width||220,height:t.height||300,move:!0,park:!t.allow_close,center:!!t.center,resize:!0,caption:t.caption||"Tools"}),a={x:(e||$p.iface.w).vp.clientWidth,y:(e||$p.iface.w).vp.clientHeight};return i.getPosition()[0]+i.getDimension()[0]>a.x?(a.x=a.x-i.getDimension()[0],n=!0):a.x=i.getPosition()[0],i.getPosition()[1]+i.getDimension()[1]>a.y?(a.y=a.y-i.getDimension()[1],n=!0):a.y=i.getPosition()[1],n&&(a.x<0||a.y<0?i.maximize():i.setPosition(a.x,a.y)),e=null,t.hasOwnProperty("allow_minmax")&&!t.allow_minmax&&i.button("minmax").hide(),t.allow_close?i.button("park").hide():i.button("close").hide(),i.attachEvent("onClose",function(){var e="function"!=typeof t.on_close||t.on_close(i);if(e)return t.pwnd_modal&&t.pwnd&&t.pwnd.setModal&&t.pwnd.setModal(1),e}),i.setIconCss("without_icon"),i.cell.parentNode.children[1].classList.add("dat_gui"),$p.iface.bind_help(i,t.help_path),i.elmnts={grids:{}},i.wnd_options=function(e){var t=i.getPosition(),n=i.getDimension(),a=i.isParked();e.left=t[0],e.top=t[1],e.width=n[0],e.parked=a,a||(e.height=n[1])},i.bottom_toolbar=function(e){var t={wrapper:i.cell,width:"100%",height:"28px",bottom:"0px",left:"0px",name:"tb_bottom",buttons:[{name:"btn_cancel",text:"Отмена",title:"Закрыть без сохранения",width:"60px",float:"right"},{name:"btn_ok",b:"Ок",title:"Применить изменения",width:"30px",float:"right"}],onclick:function(e){return!1}}._mixin(e),n=new OTooolBar(t),a=i.attachStatusBar({height:12});return a.style.zIndex=-1e3,a.firstChild.style.backgroundColor="transparent",a.firstChild.style.border="none",n},t.modal&&(t.pwnd&&t.pwnd.setModal&&(t.pwnd_modal=t.pwnd.isModal(),t.pwnd.setModal(0)),i.setModal(1)),i},$p.iface.pgrid_on_select=function(e){if(void 0!==e){var t=this.grid instanceof dhtmlXGridObject?this.grid:this,n=t.getUserData("","source"),i=t.getSelectedRowId();if(void 0!=n.o[i])"number"==typeof n.o[i]?n.o[i]=$p.utils.fix_number(e,!0):n.o[i]=e;else if(i.indexOf("fprms")>-1){var a=$p._find(n.o.fprms,i.split("|")[1]);a.value=e}t.cells().setValue($p.utils.is_data_obj(e)?e.presentation:e||""),n.grid_on_change&&n.grid_on_change.call(t,i,e)}},$p.iface.pgrid_on_change=function(e,t,n){e&&$p.iface.pgrid_on_select.call(this,t)},$p.iface.pgrid_on_checkbox=function(e,t,n){var i=this.grid instanceof dhtmlXGridObject?this.grid:this,a=i.getUserData("","source");void 0!=a.o[e]&&(a.o[e]=n),a.grid_on_change&&a.grid_on_change(e,n)},$p.iface.frm_auth=function(e,t,n){function i(n,i){if($p.ajax.username=n,$p.ajax.password=$p.aes.Ctr.encrypt(i),n){$p.wsql.get_user_param("user_name")!=n&&$p.wsql.set_user_param("user_name",n);var a=$p.eve.attachEvent("user_log_in",function(){$p.eve.detachEvent(a),o&&o.close&&o.close()});$p.wsql.pouch.log_in(n,i).then(function(){$p.wsql.get_user_param("enable_save_pwd")?$p.aes.Ctr.decrypt($p.wsql.get_user_param("user_pwd"))!=i&&$p.wsql.set_user_param("user_pwd",$p.aes.Ctr.encrypt(i)):""!=$p.wsql.get_user_param("user_pwd")&&$p.wsql.set_user_param("user_pwd",""),$p.eve.logged_in=!0,e.modal_dialog?o&&o.close&&o.close():t&&t()}).catch(function(e){l=!0,s&&s.onerror&&s.onerror(e)}).then(function(){$p.iface.sync&&$p.iface.sync.close(),o&&o.progressOff&&(o.progressOff(),!l&&e.hide_header&&o.hideHeader()),$p.iface.cell_tree&&!l&&$p.iface.cell_tree.expand()})}else this.validate()}function a(e){if(l=!1,this.resetValidateCss(),"guest"==this.getCheckedValue("type")){var t=this.getItemValue("guest"),n="";$p.job_prm.guests&&$p.job_prm.guests.length&&$p.job_prm.guests.some(function(e){if(e.username==t)return n=$p.aes.Ctr.decrypt(e.password),!0}),i.call(this,t,n)}else"auth"==this.getCheckedValue("type")&&i.call(this,this.getItemValue("login"),this.getItemValue("password"))}e||(e={});var o,s,r,l;e.modal_dialog?(e.options||(e.options={name:"frm_auth",caption:"Вход на сервер",width:360,height:300,center:!0,allow_close:!0,allow_minmax:!0,modal:!0}),o=this.auth=this.dat_blank(e._dxw,e.options),o.attachEvent("onClose",function(e){return l?n&&n(err):t&&t(),!0}),s=o.attachForm()):(o=e.cell||this.docs,s=this.auth=o.attachForm(),$p.msg.show_msg($p.msg.init_login,o)),s.loadStruct($p.injected_data["form_auth.xml"],function(){var t;if($p.job_prm.guests&&$p.job_prm.guests.length){var n=$p.job_prm.guests.map(function(e){var n={text:e.username,value:e.username};return $p.wsql.get_user_param("user_name")==e.username&&(n.selected=!0,t=e.username),n});t||(n[0].selected=!0,t=n[0].value),s.reloadOptions("guest",n)}$p.wsql.get_user_param("user_name")&&$p.wsql.get_user_param("user_name")!=t&&(s.setItemValue("login",$p.wsql.get_user_param("user_name")),s.setItemValue("type","auth"),$p.wsql.get_user_param("enable_save_pwd")&&$p.wsql.get_user_param("user_pwd")&&s.setItemValue("password",$p.aes.Ctr.decrypt($p.wsql.get_user_param("user_pwd")))),e.modal_dialog||((r=((o.getWidth?o.getWidth():o.cell.offsetWidth)-500)/2)>=10?s.cont.style.paddingLeft=r.toFixed()+"px":s.cont.style.paddingLeft="20px"),setTimeout(function(){dhx4.callEvent("on_draw_auth",[s]),($p.wsql.get_user_param("autologin")||e.try_auto)&&(t||$p.wsql.get_user_param("user_name")&&$p.wsql.get_user_param("user_pwd"))&&a.call(s)})}),s.attachEvent("onButtonClick",a),s.attachEvent("onKeyDown",function(e,t,n,i){13==t.keyCode&&("password"!=n&&"guest"!=this.getCheckedValue("type")||a.call(this))}),s.onerror=function(e){$p.ajax.authorized=!1;var t=e.message.toLowerCase();-1!=t.indexOf("auth")?($p.msg.show_msg({title:$p.msg.main_title+$p.version,type:"alert-error",text:$p.msg.error_auth}),s.setItemValue("password",""),s.validate()):-1==t.indexOf("gateway")&&-1==t.indexOf("net")||$p.msg.show_msg({title:$p.msg.main_title+$p.version,type:"alert-error",text:$p.msg.error_network})}},$p.iface.open_settings=function(e){var t=e||("undefined"!=typeof event?event:void 0);t&&t.preventDefault();var n=$p.job_prm.parse_url();return $p.iface.set_hash(n.obj,n.ref,n.frm,"settings"),$p.iface.cancel_bubble(t)},$p.iface.swith_view=function(e){var t,n=$p.iface;if(0==e.indexOf(n.docs.getViewName()))return n.docs.getViewName();t=n.docs.showView(e),1==t&&("cal"!=e||window.dhtmlXScheduler||($p.load_script("dist/dhtmlxscheduler.min.js","script",function(){scheduler.config.first_hour=8,scheduler.config.last_hour=22,n.docs.scheduler=n.docs.attachScheduler(new Date("2015-11-20"),"week","scheduler_here"),n.docs.scheduler.attachEvent("onBeforeViewChange",function(e,t,n,i){return"timeline"!=n||($p.msg.show_not_implemented(),!1)})}),$p.load_script("dist/dhtmlxscheduler.css","link"))),function(e){function t(e,t){return e.text>t.text?1:e.text<t.text?-1:void 0}if(n.tree){if(n.tree._view!=e&&-1==["rep","cal"].indexOf(e)){if(n.tree.deleteChildItems(0),"oper"==e){var i,a,o={id:0,item:[{id:"oper_cat",text:$p.msg.meta_cat,open:!0,item:[]},{id:"oper_doc",text:$p.msg.meta_doc,item:[]},{id:"oper_cch",text:$p.msg.meta_cch,item:[]},{id:"oper_cacc",text:$p.msg.meta_cacc,item:[]},{id:"oper_tsk",text:$p.msg.meta_tsk,item:[]}]},s=o.item[0].item;for(i in $p.cat)"function"!=typeof $p.cat[i]&&(a=$p.cat[i].metadata(),a.hide||s.push({id:"oper.cat."+i,text:a.synonym||a.name,tooltip:a.illustration||a.list_presentation}));s.sort(t),s=o.item[1].item;for(i in $p.doc)"function"!=typeof $p.doc[i]&&(a=$p.doc[i].metadata(),a.hide||s.push({id:"oper.doc."+i,text:a.synonym||a.name,tooltip:a.illustration||a.list_presentation}));s.sort(t),s=o.item[2].item;for(i in $p.cch)"function"!=typeof $p.cch[i]&&(a=$p.cch[i].metadata(),a.hide||s.push({id:"oper.cch."+i,text:a.synonym||a.name,tooltip:a.illustration||a.list_presentation}));s.sort(t),s=o.item[3].item;for(i in $p.cacc)"function"!=typeof $p.cacc[i]&&(a=$p.cacc[i].metadata(),a.hide||s.push({id:"oper.cacc."+i,text:a.synonym||a.name,tooltip:a.illustration||a.list_presentation}));s.sort(t),s=o.item[4].item;for(i in $p.tsk)"function"!=typeof $p.tsk[i]&&(a=$p.tsk[i].metadata(),a.hide||s.push({id:"oper.tsk."+i,text:a.synonym||a.name,tooltip:a.illustration||a.list_presentation}));s.sort(t),n.tree.parse(o,function(){var e=$p.job_prm.parse_url();e.obj&&n.tree.selectItem(e.view+"."+e.obj,!0)},"json")}else n.tree.loadXML(n.tree.tree_filteres,function(){});n.tree._view=e}}else{var r=$p.job_prm.parse_url();if(r.obj){if(r.obj.split(".").length>1){var l=$p.md.mgr_by_class_name(r.obj);"function"==typeof n.docs.close&&n.docs.close(),l&&l.form_list(n.docs,{})}}}}(e),"def"==e?n.main.showStatusBar():n.main.hideStatusBar()},$p.iface.OTooolBar=OTooolBar,$p.iface.add_button=function(e,t,n){var i=document.createElement("div"),a="";return i.name=(t?t.name+"_":"")+n.name,e.appendChild(i),i.className=0==n.name.indexOf("sep_")?"md_otooolbar_sep":"md_otooolbar_button",n.hasOwnProperty("class_name")&&i.classList.add(n.class_name),n.img&&(a='<img src="'+(t?t.image_path:"")+n.img+'">'),n.b?a+='<b style="vertical-align: super;"> '+n.b+"</b>":n.text?a+='<span style="vertical-align: super;"> '+n.text+"</span>":n.css&&i.classList.add(n.css),i.innerHTML=a,n.float&&(i.style.float=n.float),n.clear&&(i.style.clear=n.clear),n.width&&(i.style.width=n.width),n.paddingRight&&(i.style.paddingRight=n.paddingRight),n.paddingLeft&&(i.style.paddingLeft=n.paddingLeft),n.tooltip&&(i.title=n.tooltip),i},DataManager.prototype.form_obj=function(e,t){function n(){_||((e instanceof dhtmlXLayoutCell||e instanceof dhtmlXSideBarCell||e instanceof dhtmlXCarouselCell)&&(t.bind_pwnd||t.Приклеить)?("function"==typeof e.close&&e.close(!0),f=e,f.close=function(t){var n=f||e;(t||d())&&(n&&(n.elmnts&&["vault","vault_pop"].forEach(function(e){n.elmnts[e]&&n.elmnts[e].unload&&n.elmnts[e].unload()}),x&&x.class_name&&$p.eve.callEvent("frm_close",[x.class_name,y&&y._obj?y.ref:""]),n.conf&&(n.detachToolbar(),n.detachStatusBar(),n.conf.unloading=!0,n.detachObject(!0))),p(t))},f.elmnts={grids:{}}):(m={name:"wnd_obj_"+x.class_name,wnd:{top:80+40*Math.random(),left:120+80*Math.random(),width:700,height:400,modal:!0,center:!1,pwnd:e,allow_close:!0,allow_minmax:!0,on_close:u,caption:v.obj_presentation||v.synonym}},f=$p.iface.dat_blank(null,m.wnd)),f.ref||f.__define({ref:{get:function(){return y?y.ref:$p.utils.blank.guid},enumerable:!1,configurable:!0},set_text:{value:function(e){if(t&&t.set_text||f&&f.setText){var n=y.presentation;if(!n)return;y instanceof CatObj?n=(v.obj_presentation||v.synonym)+": "+n:y instanceof DocObj&&(n+=y.posted?" (проведен)":" (не проведен)"),y._modified&&n.lastIndexOf("*")!=n.length-1?n+=" *":y._modified||n.lastIndexOf("*")!=n.length-1||(n=n.replace(" *","")),(e||g!==n)&&(g=n,t.set_text?t.set_text(n):f.setText(n))}},enumerable:!1,configurable:!0}}),f.elmnts.frm_tabs=f.attachTabbar({arrows_mode:"auto",offsets:{top:0,right:0,bottom:0,left:0}}),f.elmnts.frm_tabs.addTab("tab_header","&nbsp;Реквизиты&nbsp;",null,null,!0),f.elmnts.tabs={tab_header:f.elmnts.frm_tabs.cells("tab_header")},f.elmnts.frm_toolbar=f.attachToolbar(),f.elmnts.frm_toolbar.setIconsPath(dhtmlx.image_path+"dhxtoolbar"+dhtmlx.skin_suffix()),f.elmnts.frm_toolbar.loadStruct(t.toolbar_struct||$p.injected_data["toolbar_obj.xml"],function(){f===e&&(this.cont.style.top="4px"),this.addSpacer("btn_unpost"),this.attachEvent("onclick",t.toolbar_click||o);var n=$p.current_user.get_acl(x.class_name);x instanceof DocManager&&-1!=n.indexOf("p")?(this.enableItem("btn_post"),t.toolbar_struct||this.setItemText("btn_save_close","<b>Провести и закрыть</b>")):this.hideItem("btn_post"),x instanceof DocManager&&-1!=n.indexOf("o")?this.enableItem("btn_unpost"):this.hideItem("btn_unpost"),-1==n.indexOf("e")&&(this.hideItem("btn_save_close"),this.disableItem("btn_save")),t.on_select&&this.setItemText("btn_save_close","Записать и выбрать"),x instanceof CatManager||x instanceof DocManager?(x.printing_plates().then(function(e){for(var t in e)f.elmnts.frm_toolbar.addListOption("bs_print",t,"~","button",e[t].toString())}),f.elmnts.vault_pop=new dhtmlXPopup({toolbar:this,id:"btn_files"}),f.elmnts.vault_pop.attachEvent("onShow",r)):this.disableItem("bs_print"),f!=e&&this.hideItem("btn_close")}),_=!0)}function i(e){y&&f&&f.set_text&&f.set_text()}function a(){if(_||(clearTimeout(h),n()),f.set_text(),!t.hide_header&&f.showHeader&&f.showHeader(),t.draw_tabular_sections)t.draw_tabular_sections(y,f,l);else if(!y.is_folder)if(v.form&&v.form.obj&&v.form.obj.tabular_sections_order)v.form.obj.tabular_sections_order.forEach(function(e){l(e)});else for(var e in v.tabular_sections)"extra_fields"!==e&&y[e]instanceof TabularSection&&l(e);if(t.draw_pg_header)t.draw_pg_header(y,f);else{var a=$p.current_user.get_acl(x.class_name);f.elmnts.pg_header=f.elmnts.tabs.tab_header.attachHeadFields({obj:y,pwnd:f,read_only:-1==a.indexOf("e")}),f.attachEvent("onResizeFinish",function(e){f.elmnts.pg_header.enableAutoHeight(!1,f.elmnts.tabs.tab_header._getHeight()-20,!0)})}return Object.observe(y,i,["update","row"]),{wnd:f,o:y}}function o(e){"btn_save_close"==e?c("close"):"btn_save"==e?c("save"):"btn_post"==e?c("post"):"btn_unpost"==e?c("unpost"):"btn_close"==e?f.close():"btn_go_connection"==e?s():"prn_"==e.substr(0,4)?x.print(y,e,f):"btn_import"==e?x.import(null,y):"btn_export"==e&&x.export({items:[y],pwnd:f,obj:!0})}function s(){$p.msg.show_not_implemented()}function r(){f.elmnts.vault||(f.elmnts.vault=f.elmnts.vault_pop.attachVault(400,250,{_obj:y,buttonClear:!1,autoStart:!0,filesLimit:10,mode:"pouch"}),f.elmnts.vault.conf.wnd=f)}function l(e,t){if(_md.ts_captions(x.class_name,e)){f.elmnts.frm_tabs.addTab("tab_"+e,"&nbsp;"+v.tabular_sections[e].synonym+"&nbsp;"),f.elmnts.tabs["tab_"+e]=f.elmnts.frm_tabs.cells("tab_"+e);var n=$p.current_user.get_acl(x.class_name);if(f.elmnts.grids[e]=f.elmnts.tabs["tab_"+e].attachTabular({obj:y,ts:e,pwnd:f,read_only:-1==n.indexOf("e"),toolbar_struct:t}),-1==n.indexOf("e")){var i=f.elmnts.tabs["tab_"+e].getAttachedToolbar();i.disableItem("btn_add"),i.disableItem("btn_delete")}}}function c(e){f.progressOn();var n;y instanceof DocObj&&("post"==e?n=!0:"unpost"==e?n=!1:"close"==e&&-1!=$p.current_user.get_acl(x.class_name).indexOf("p")&&(n=!0)),y.save(n).then(function(){f.progressOff(),"close"==e?(t.on_select&&t.on_select(y),f.close()):f.set_text()}).catch(function(e){f.progressOff(),e instanceof Error&&$p.record_log(e)})}function p(n){t&&t.on_close&&!n&&t.on_close(),n||(delete f.ref,delete f.set_text,Object.unobserve(y,i),x=f=y=v=m=e=t=null)}function d(){return!(y._modified&&!b)||(dhtmlx.confirm({title:y.presentation,text:$p.msg.modified_close,cancel:$p.msg.cancel,callback:function(e){e&&(b=!0,"ram"==y._manager.cachable?this.close():y.is_new()?(y.unload(),this.close()):(setTimeout(y.load.bind(y),100),this.close()))}.bind(f)}),!1)}function u(e){if(d())return setTimeout(p),e&&e.elmnts&&["vault","vault_pop"].forEach(function(t){e.elmnts[t]&&e.elmnts[t].unload&&e.elmnts[t].unload()}),x&&x.class_name&&$p.eve.callEvent("frm_close",[x.class_name,y&&y._obj?y.ref:""]),!0}var f,m,_,h,g,b,x=this,v=x.metadata(),y=t.o;return h=setTimeout(n),$p.utils.is_data_obj(y)?y.is_new()&&t.on_select?x.create({},!0).then(function(e){return y=e,e=null,a()}):y.is_new()&&!y.empty()?y.load().then(a):Promise.resolve(a()):(e&&e.progressOn&&e.progressOn(),x.get(t.hasOwnProperty("ref")?t.ref:t,!0,!0).then(function(t){return y=t,t=null,e&&e.progressOff&&e.progressOff(),a()}).catch(function(t){e&&e.progressOff&&e.progressOff(),f.close(),$p.record_log(t)}))},DataObj.prototype.form_obj=function(e,t){return t||(t={}),t.o=this,this._manager.form_obj(e,t)},DataProcessorsManager.prototype.form_rep=function(e,t){function n(e){"btn_close"==e?o.close():"btn_run"==e&&o.report.build().then(i).catch(i)}function i(e){o.elmnts.table.requery(e)}function a(n){t&&t.on_close&&!n&&t.on_close(),n||(delete o.set_text,o.elmnts.table&&o.elmnts.table.hot.destroy(),o.report.daterange&&o.report.daterange.remove(),o.report=null,l=o=c=s=e=t=null)}var o,s,r,l=this,c=l.metadata();return t||(t={}),t.date_from||(t.date_from=new Date((new Date).getFullYear().toFixed()+"-01-01")),t.date_till||(t.date_till=new Date((new Date).getFullYear().toFixed()+"-12-31")),function(){if((e instanceof dhtmlXLayoutCell||e instanceof dhtmlXSideBarCell||e instanceof dhtmlXCarouselCell)&&(t.bind_pwnd||t.Приклеить)){if(o==e&&o._mgr==l)return;"function"==typeof e.close&&e.close(!0),o=e,o.close=function(t){var n=o||e;(t||check_modified())&&(n&&n.conf&&(n.detachToolbar(),n.detachStatusBar(),n.conf.unloading=!0,n.detachObject(!0)),a(t))},o.elmnts={grids:{}}}else s={name:"wnd_rep_"+l.class_name,wnd:{top:80+40*Math.random(),left:120+80*Math.random(),width:700,height:400,modal:!0,center:!1,pwnd:e,allow_close:!0,allow_minmax:!0,on_close:frm_close,caption:c.obj_presentation||c.synonym}},o=$p.iface.dat_blank(null,s.wnd);o._mgr=l,o.report=l.create(),o.set_text||o.__define({set_text:{value:function(e){if(t&&t.set_text||o&&o.setText){var n=c.obj_presentation||c.synonym;(e||r!==n)&&(r=n,t.set_text?t.set_text(n):o.setText(n))}},configurable:!0}}),o.elmnts.layout=o.attachLayout({pattern:"2U",cells:[{id:"a",text:"Отчет",header:!1},{id:"b",text:"Параметры",collapsed_text:"Параметры",width:220}],offsets:{top:0,right:0,bottom:0,left:0}}),o.elmnts.frm_toolbar=o.attachToolbar(),o.elmnts.frm_toolbar.setIconsPath(dhtmlx.image_path+"dhxtoolbar"+dhtmlx.skin_suffix()),o.elmnts.frm_toolbar.loadStruct(t.toolbar_struct||$p.injected_data["toolbar_rep.xml"],function(){o===e&&(this.cont.style.top="4px"),this.addSpacer("btn_run"),this.attachEvent("onclick",t.toolbar_click||n)}),o.set_text(),!t.hide_header&&o.showHeader&&o.showHeader(),o.elmnts.table=new $p.HandsontableDocument(o.elmnts.layout.cells("a"),{allow_offline:o.report.allow_offline,autorun:!1}).then(function(e){if(!e._online)return o.elmnts.table=null}),o.elmnts.frm_prm=document.createElement("DIV"),o.elmnts.frm_prm.style="height: 100%; min-height: 300px; width: 100%",o.elmnts.layout.cells("b").attachObject(o.elmnts.frm_prm),o.report.daterange=new $p.iface.ODateRangePicker(o.elmnts.frm_prm,t)}(),o},DataManager.prototype.form_selection=function(e,t){function n(){return e instanceof dhtmlXCellObject?(e instanceof dhtmlXTabBarCell||"function"!=typeof e.close||e.close(!0),m=e,m.close=function(t){(m||e)&&((m||e).detachToolbar(),(m||e).detachStatusBar(),(m||e).conf&&((m||e).conf.unloading=!0),(m||e).detachObject(!0)),p(t)},t.hide_header||setTimeout(function(){m.showHeader()})):(m=$p.iface.w.createWindow(null,0,0,700,500),m.centerOnScreen(),m.setModal(1),m.button("park").hide(),m.button("minmax").show(),m.button("minmax").enable(),m.attachEvent("onClose",d)),$p.iface.bind_help(m),m.setText&&!t.hide_text&&m.setText("Список "+(-1==_.class_name.indexOf("doc.")?'справочника "':'документов "')+(h.list_presentation||h.synonym)+'"'),document.body.addEventListener("keydown",i,!1),m.elmnts={},!t.status_bar&&t.smart_rendering||(m.elmnts.status_bar=m.attachStatusBar()),t.smart_rendering||m.elmnts.status_bar.setText("<div id='"+_.class_name.replace(".","_")+"_select_recinfoArea'></div>"),m.elmnts.toolbar=m.attachToolbar(),m.elmnts.toolbar.setIconsPath(dhtmlx.image_path+"dhxtoolbar"+dhtmlx.skin_suffix()),m.elmnts.toolbar.loadStruct(t.toolbar_struct||$p.injected_data["toolbar_selection.xml"],function(){this.attachEvent("onclick",s),m===e&&(this.cont.parentElement.classList.add("dhx_cell_toolbar_no_borders"),this.cont.parentElement.classList.remove("dhx_cell_toolbar_def"),this.cont.style.top="4px");var n={manager:_,toolbar:this,onchange:a,hide_filter:t.hide_filter,custom_selection:t.custom_selection};t.date_from&&(n.date_from=t.date_from),t.date_till&&(n.date_till=t.date_till),t.period&&(n.period=t.period),m.elmnts.filter=new $p.iface.Toolbar_filter(n);var i=$p.current_user.get_acl(_.class_name);-1==i.indexOf("i")&&this.hideItem("btn_new"),-1==i.indexOf("v")&&this.hideItem("btn_edit"),-1==i.indexOf("d")&&this.hideItem("btn_delete"),y||(this.hideItem("btn_select"),this.hideItem("sep1"),$p.iface.docs&&$p.iface.docs.getViewName&&"oper"==$p.iface.docs.getViewName()&&this.addListOption("bs_more","btn_order_list","~","button","<i class='fa fa-briefcase fa-lg fa-fw'></i> Список заказов")),this.addListOption("bs_more","btn_import","~","button","<i class='fa fa-upload fa-lg fa-fw'></i> Загрузить из файла"),this.addListOption("bs_more","btn_export","~","button","<i class='fa fa-download fa-lg fa-fw'></i> Выгрузить в файл"),_.printing_plates?_.printing_plates().then(function(e){var t;for(var n in e)m.elmnts.toolbar.addListOption("bs_print",n,"~","button",e[n].toString()),t=!0;t||m.elmnts.toolbar.hideItem("bs_print")}):m.elmnts.toolbar.hideItem("bs_print"),o()}),m._mgr=_,m}function i(e){if(m&&m.is_visible&&m.is_visible())if(e.ctrlKey&&70==e.keyCode){if(!$p.iface.check_exit(m))return setTimeout(function(){m.elmnts.filter.input_filter&&"desktop"==$p.job_prm.device_type&&m.elmnts.filter.input_filter.focus()}),$p.iface.cancel_bubble(e)}else if(e.shiftKey&&116==e.keyCode){if(!$p.iface.check_exit(m))return setTimeout(function(){m.elmnts.grid.reload()}),e.preventDefault&&e.preventDefault(),$p.iface.cancel_bubble(e)}else 27==e.keyCode&&m instanceof dhtmlXWindowsCell&&!$p.iface.check_exit(m)&&setTimeout(function(){m.close()})}function a(e){m&&m.elmnts&&(g&&(e.filter||e.hide_tree?m.elmnts.cell_tree.collapse():m.elmnts.cell_tree.expand()),m.elmnts.grid.reload())}function o(){var e,n,i,a,o,s;g?(e=m.attachLayout("2U"),i=e.cells("b"),i.hideHeader(),n=m.elmnts.cell_tree=e.cells("a"),n.setWidth("220"),n.hideHeader(),a=m.elmnts.tree=n.attachDynTree(_,null,function(){setTimeout(function(){o&&o.reload&&o.reload()},20)}),a.attachEvent("onSelect",function(e,t){t&&(this.do_not_reload?delete this.do_not_reload:setTimeout(function(){o&&o.reload&&o.reload()},20))}),a.attachEvent("onDblClick",function(e){r(e)})):(i=m,setTimeout(function(){o&&o.reload&&o.reload()},20)),o=m.elmnts.grid=i.attachGrid(),o.setIconsPath(dhtmlx.image_path),o.setImagePath(dhtmlx.image_path),o.attachEvent("onBeforeSorting",f),o.attachEvent("onBeforePageChanged",function(){return!!this.getRowsNum()}),o.attachEvent("onXLE",function(){i.progressOff()}),o.attachEvent("onXLS",function(){i.progressOn()}),o.attachEvent("onDynXLS",function(e,t){var n=u(e,t);if(n)return _.sync_grid(n,o),!1}),o.attachEvent("onRowDblClicked",function(e,t){if(a&&a.items[e]){a.selectItem(e);var n=a.getParentId(e);n&&n!=$p.utils.blank.guid&&a.openItem(n)}else r(e)}),
t.smart_rendering?o.enableSmartRendering(!0,50):(o.setPagingWTMode(!0,!0,!0,[20,30,60]),o.enablePaging(!0,30,8,_.class_name.replace(".","_")+"_select_recinfoArea"),o.setPagingSkin("toolbar",dhtmlx.skin)),$p.iface.docs&&$p.iface.docs.getViewName&&"oper"==$p.iface.docs.getViewName()&&o.enableMultiselect(!0),o.reload=function(){var e=u();return e?(i.progressOn(),o.clearAll(),_.sync_grid(e,o).then(function(n){if("object"==typeof n)$p.msg.check_soap_result(n);else if(!s){if(e.initial_value){var r=n.indexOf("set_parent"),l=n.indexOf("'>",r),c=n.substr(r+12,l-r-12);$p.utils.is_guid(c)&&g&&(a.do_not_reload=!0,a.selectItem(c,!1)),o.selectRowById(e.initial_value)}else e.parent&&$p.utils.is_guid(e.parent)&&g&&(a.do_not_reload=!0,a.selectItem(e.parent,!1));o.setColumnMinWidth(200,o.getColIndexById("presentation")),o.enableAutoWidth(!0,1200,600),o.setSizes(),s=!0,m.elmnts.filter.input_filter&&"desktop"==$p.job_prm.device_type&&m.elmnts.filter.input_filter.focus(),t.on_grid_inited&&t.on_grid_inited()}x&&s&&o.setSortImgState(!0,b,x),i.progressOff()})):Promise.resolve()}}function s(e){if(!t.toolbar_click||!1!==t.toolbar_click(e,m,_))if("btn_select"==e)r();else if("btn_new"==e)_.create({},!0).then(function(e){t.on_new?t.on_new(e,m):$p.job_prm.keep_hash?e.form_obj(m):(e._set_loaded(e.ref),$p.iface.set_hash(_.class_name,e.ref))});else if("btn_edit"==e){var n=m.elmnts.grid.getSelectedRowId();n?t.on_edit?t.on_edit(_,n,m):$p.job_prm.keep_hash?_.form_obj(m,{ref:n}):$p.iface.set_hash(_.class_name,n):$p.msg.show_msg({type:"alert-warning",text:$p.msg.no_selected_row.replace("%1",""),title:$p.msg.main_title})}else"prn_"==e.substr(0,4)?l(e):"btn_order_list"==e?$p.iface.set_hash("","","","def"):"btn_delete"==e?c():"btn_import"==e?_.import():"btn_export"==e?_.export(m.elmnts.grid.getSelectedRowId()):"btn_requery"==e&&(v={},m.elmnts.grid.reload())}function r(n){n||(n=m.elmnts.grid.getSelectedRowId());var i;if(t.selection&&t.selection.forEach(function(e){for(var t in e)"is_folder"==t&&(i=e[t])}),m.elmnts.tree&&m.elmnts.tree.items[n]&&m.elmnts.tree.getSelectedId()!=n)return void m.elmnts.tree.selectItem(n,!0);if(n&&!0===i&&m.elmnts.grid.cells(n,0).cell.classList.contains("cell_ref_elm"))return void $p.msg.show_msg($p.msg.select_grp);if(!n&&m.elmnts.tree||m.elmnts.tree&&m.elmnts.tree.getSelectedId()==n){if(!1===i)return void $p.msg.show_msg($p.msg.select_elm);n=m.elmnts.tree.getSelectedId()}n&&(t.on_edit?t.on_edit(_,n,m):y?_.get(n,!0).then(function(t){m.close(),y.call(e.grid||e,t)}):$p.job_prm.keep_hash?_.form_obj(m,{ref:n}):$p.iface.set_hash(_.class_name,n))}function l(e){var t=m.elmnts.grid.getSelectedRowId();t?_.print(t,e,m):$p.msg.show_msg({type:"alert-warning",text:$p.msg.no_selected_row.replace("%1",""),title:$p.msg.main_title})}function c(){var e=m.elmnts.grid.getSelectedRowId();e?_.get(e,!0,!0).then(function(e){dhtmlx.confirm({title:$p.msg.main_title,text:e._deleted?$p.msg.mark_undelete_confirm.replace("%1",e.presentation):$p.msg.mark_delete_confirm.replace("%1",e.presentation),cancel:"Отмена",callback:function(t){t&&e.mark_deleted(!e._deleted)}})}):$p.msg.show_msg({type:"alert-warning",text:$p.msg.no_selected_row.replace("%1",""),title:$p.msg.main_title})}function p(n){document.body.removeEventListener("keydown",i),t&&t.on_close&&!n&&t.on_close(),n||(_=m=h=v=y=e=t=null)}function d(){return setTimeout(p,10),e.on_unload&&e.on_unload.call(e.grid||e),w&&($p.eve.detachEvent(w),w=null),!0}function u(e,n){var i=m.elmnts.filter.get_filter()._mixin({action:"get_selection",metadata:h,class_name:_.class_name,order_by:m.elmnts.grid.columnIds[b]||b,direction:x,start:e||((m.elmnts.grid.currentPage||1)-1)*m.elmnts.grid.rowsBufferOutSize,count:n||m.elmnts.grid.rowsBufferOutSize,get_header:void 0==v.get_header}),a=g?m.elmnts.tree.getSelectedId():null;if(t.smart_rendering&&(i.smart_rendering=!0),t.date_from&&!i.date_from&&(i.date_from=t.date_from),t.date_till&&!i.date_till&&(i.date_till=t.date_till),t.initial_value&&(i.initial_value=t.initial_value),t.custom_selection&&(i.custom_selection=t.custom_selection),t.selection)if(i.selection)if(Array.isArray(t.selection))t.selection.forEach(function(e){i.selection.push(e)});else for(var o in t.selection){res.selection||(res.selection=[]);var s={};s[o]=t.selection[o],i.selection.push(s)}else i.selection=t.selection;t.owner&&!i.owner&&(i.owner=t.owner),i.parent=!a&&!t.parent||i.filter?null:a||t.parent,g&&!i.parent&&(i.parent=$p.utils.blank.guid);for(var r in i)if(v[r]!=i[r])return v=i,i}function f(e){var t=m.elmnts.grid.getSortingState();return b=e,x="des"==t[1]?"asc":"des",m.elmnts.grid.reload(),!0}e||(e=t&&t.pwnd?t.pwnd:{}),t||e instanceof dhtmlXCellObject||(t=e,e={}),t||(t={});var m,_=this,h=t.metadata||_.metadata(),g=h.hierarchical&&!(_ instanceof ChartOfAccountManager),b=0,x="asc",v={},y=e.on_select||t.on_select,w=$p.eve.attachEvent("frm_close",function(e,t){_&&_.class_name==e&&m&&m.elmnts&&m.elmnts.grid.reload().then(function(){$p.utils.is_empty_guid(t)||m.elmnts.grid.selectRowById(t,!1,!0,!0)})});return g&&t.initial_value&&t.initial_value!=$p.utils.blank.guid&&!t.parent?_.get(t.initial_value,!0).then(function(e){return t.parent=e.parent.ref,t.set_parent=t.parent,n()}):n()},DataManager.prototype.form_list=function(e,t){return this.form_selection(e,t)},$p.iface.wnd_sync=function(){function e(){var e={name:"wnd_sync",wnd:{id:"wnd_sync",top:130,left:200,width:496,height:290,modal:!0,center:!0,caption:"Подготовка данных"}};t.wnd_sync=$p.iface.dat_blank(null,e.wnd);var n=[{type:"block",name:"form_block_1",list:[{type:"label",name:"form_label_1",label:$p.msg.sync_data},{type:"block",name:"form_block_2",list:[{type:"template",name:"img_long",className:"img_long"},{type:"newcolumn"},{type:"template",name:"text_processed"},{type:"template",name:"text_current"},{type:"template",name:"text_bottom"}]}]},{type:"button",name:"form_button_1",value:$p.msg.sync_break}];t.frm_sync=t.wnd_sync.attachForm(n),t.frm_sync.attachEvent("onButtonClick",function(e){t&&(t.do_break=!0)}),t.frm_sync.setItemValue("text_processed","Инициализация"),t.frm_sync.setItemValue("text_bottom","Загружается структура таблиц...")}var t,n=$p.iface.sync={};n.create=function(n){t=n,e()},n.update=function(e){t.frm_sync.setItemValue("text_processed","Обработано элементов: "+t.step*t.step_size+" из "+t.count_all);var n,i="",a=0;for(var o in e){if(++a>4)break;i&&(i+="<br />"),n=$p.cat[o].metadata(),i+=(n.list_presentation||n.synonym)+" ("+e[o].length+")"}t.frm_sync.setItemValue("text_current","Текущий запрос: "+t.step+" ("+Math.round(t.step*t.step_size*100/t.count_all)+"%)"),t.frm_sync.setItemValue("text_bottom",i)},n.close=function(){t&&t.wnd_sync&&(t.wnd_sync.close(),delete t.wnd_sync,delete t.frm_sync)}},DataManager.prototype.export=function(e){function t(){o.elmnts.frm.setItemValue("relation",!1),o.elmnts.frm.disableItem("relation"),"all"==o.elmnts.frm.getItemValue("range")?(o.elmnts.frm.disableItem("format","atom"),"atom"==o.elmnts.frm.getItemValue("format")&&o.elmnts.frm.setItemValue("format","json")):o.elmnts.frm.enableItem("format","atom"),"json"==o.elmnts.frm.getItemValue("format")?o.elmnts.frm.enableItem("meta"):(o.elmnts.frm.getItemValue("format"),o.elmnts.frm.setItemValue("meta",!1),o.elmnts.frm.disableItem("meta"))}function n(){return r.format=o.elmnts.frm.getItemValue("format"),r.range=o.elmnts.frm.getItemValue("range"),r.meta=o.elmnts.frm.getItemValue("meta"),r.relation=o.elmnts.frm.getItemValue("relation"),r}function i(){function t(){e.obj?$p.wsql.alasql("SELECT * INTO XLSX('"+s.table_name+".xlsx',{headers:true}) FROM ?",[e.items[0]._obj]):$p.wsql.alasql("SELECT * INTO XLSX('"+s.table_name+".xlsx',{headers:true}) FROM "+s.table_name)}n();var i={meta:{},items:{}},a=i.items[s.class_name]=[];if(r.meta&&(i.meta[s.class_name]=s.metadata()),"json"==r.format)e.obj?a.push(e.items[0]._obj):s.each(function(t){"all"!=r.range&&-1==e.items.indexOf(t.ref)||a.push(t._obj)}),e.items.length&&!a.length?s.get(e.items[0],!0).then(function(e){a.push(e._obj),alasql.utils.saveFile(s.table_name+".json",JSON.stringify(i,null,4))}):alasql.utils.saveFile(s.table_name+".json",JSON.stringify(i,null,4));else if("xlsx"==r.format)window.xlsx?t():$p.load_script("//cdn.jsdelivr.net/js-xlsx/latest/xlsx.core.min.js","script",t);else if("atom"==r.format&&e.items.length){var o=e.obj?Promise.resolve(e.items[0]):s.get(e.items[0],!0);o.then(function(e){alasql.utils.saveFile(s.table_name+".xml",e.to_atom())})}else $p.msg.show_not_implemented()}function a(t){return $p.iface.popup.hide(),o.wnd_options(r.wnd),$p.wsql.save_options("data_manager",n()),o.setModal(!1),e.set_pwnd_modal&&e.pwnd.setModal&&e.pwnd.setModal(!0),!0}e&&"string"==typeof e?e={items:e.split(",")}:e||(e={items:[]});var o,s=this,r={name:"export",wnd:{top:130,left:200,width:480,height:350}};!function(){$p.wsql.restore_options("data_manager",r),r.wnd.caption="Экспорт "+s.family_name+" '"+(s.metadata().synonym||s.metadata().name)+"'",o=$p.iface.dat_blank(null,r.wnd),o.bottom_toolbar({buttons:[{name:"btn_cancel",text:'<i class="fa fa-times fa-lg"></i> Отмена',title:"Отмена",width:"80px",float:"right"},{name:"btn_ok",b:'<i class="fa fa-floppy-o"></i> Ок',title:"Выполнить экспорт",width:"50px",float:"right"}],onclick:function(e){return"btn_ok"==e?i():o.close(),!1}}),o.button("close").show(),o.button("park").hide(),o.attachEvent("onClose",a);var n=[{type:"fieldset",name:"form_range",label:"Выгрузить",list:[{type:"settings",labelWidth:320,labelAlign:"left",position:"label-right"},{type:"radio",name:"range",label:"Выделенные строки",value:"selected"},{type:"radio",name:"range",label:"Весь справочник",value:"all"}]},{type:"fieldset",name:"form_fieldset_2",label:"Дополнительно выгрузить",list:[{type:"settings",labelWidth:160,position:"label-right"},{type:"checkbox",name:"meta",label:"Описание метаданных",labelAlign:"left",position:"label-right",checked:r.meta},{type:"newcolumn"},{type:"checkbox",name:"relation",label:"Связанные объекты",position:"label-right",checked:r.relation,tooltip:"Связанные объекты по ссылкам (пока не реализовано)"}]},{type:"fieldset",name:"fieldset_format",label:"Формат файла",list:[{type:"settings",labelWidth:60,labelAlign:"left",position:"label-right"},{type:"radio",name:"format",label:"json",value:"json",tooltip:"Выгрузить в формате JSON"},{type:"newcolumn"},{type:"radio",name:"format",label:"xlsx",value:"xlsx",tooltip:"Выгрузить в офисном формате XLSX"},{type:"newcolumn"},{type:"radio",name:"format",label:"atom",value:"atom",tooltip:"Выгрузить в формате XML Atom"}]}];o.elmnts.frm=o.attachForm(n),o.elmnts.frm.setItemValue("range",r.range||"all"),e.items&&1==e.items.length?(e.obj?o.elmnts.frm.setItemLabel("range","selected","Тек. объект: "+e.items[0].presentation):s.get(e.items[0],!0).then(function(e){o.elmnts.frm.setItemLabel("range","selected","Тек. объект: "+e.presentation)}),o.elmnts.frm.setItemValue("range","selected")):e.items&&e.items.length&&o.elmnts.frm.setItemLabel("range","selected","Выделенные строки ("+e.items.length+" элем.)"),s instanceof DocManager&&o.elmnts.frm.setItemLabel("range","all","Все документы из кеша (0 элем.)"),o.elmnts.frm.setItemValue("format",r.format||"json"),o.elmnts.frm.attachEvent("onChange",t),t(),e.pwnd&&e.pwnd.isModal&&e.pwnd.isModal()&&(e.set_pwnd_modal=!0,e.pwnd.setModal(!1)),o.setModal(!0)}()},DataManager.prototype.import=function(e,t){function n(e){function n(e,n){var i=_md.mgr_by_class_name(e);if(n.length)if(t){if(t._manager==i)for(var o in n)$p.utils.fix_guid(n[o])==t.ref&&(a=!0,i.load_array([n[o]],!0))}else a=!0,i.load_array(n,!0)}if(s.close(),i.files.length){var o=new FileReader;o.onload=function(e){try{var t=JSON.parse(o.result);if(t.items)for(var i in t.items)n(i,t.items[i]);else["cat","doc","ireg","areg","cch","cacc"].forEach(function(e){if(t[e])for(var i in t[e])n(e+"."+i,t.cat[i])});a||$p.msg.show_msg($p.msg.sync_no_data)}catch(e){$p.msg.show_msg(e.message)}},o.readAsText(i.files[0])}}var i,a;if(!e&&void 0!=typeof window){var o={name:"import",wnd:{width:300,height:100,caption:$p.msg.select_file_import}},s=$p.iface.dat_blank(null,o.wnd);i=document.createElement("input"),i.setAttribute("id","json_file"),i.setAttribute("type","file"),i.setAttribute("accept",".json"),i.setAttribute("value","*.json"),i.onchange=n,s.button("close").show(),s.button("park").hide(),s.attachObject(i),s.centerOnScreen(),s.setModal(!0),setTimeout(function(){i.click()},100)}},JobPrm.prototype.__define({base_url:{value:function(){return $p.wsql.get_user_param("rest_path")||$p.job_prm.rest_path||"/a/zd/%1/odata/standard.odata/"}},parse_url_str:{value:function(e){var t,n={},i=[];if("#"!==e[0]&&"?"!==e[0]||(e=e.substr(1)),e.length>2){t=decodeURI(e).split("&");for(var a in t)if(i=t[a].split("="),"m"==i[0])try{n[i[0]]=JSON.parse(i[1])}catch(e){n[i[0]]={}}else n[i[0]]=i[1]||""}return n}},parse_url:{value:function(){return this.parse_url_str(location.search)._mixin(this.parse_url_str(location.hash))}},rest_url:{value:function(){var e=this.base_url(),t=$p.wsql.get_user_param("zone",$p.job_prm.zone_is_string?"string":"number");return t?e.replace("%1",t):e.replace("%1/","")}},irest_url:{value:function(){var e=this.base_url().replace("odata/standard.odata","hs/rest"),t=$p.wsql.get_user_param("zone",$p.job_prm.zone_is_string?"string":"number");return t?e.replace("%1",t):e.replace("%1/","")}}}),$p.eve.__define({set_offline:{value:function(e){var t=$p.job_prm.offline;$p.job_prm.offline=!(!e&&!$p.wsql.get_user_param("offline","boolean")),t!=$p.job_prm.offline&&(t=$p.job_prm.offline)}},on_rotate:{value:function(e){$p.job_prm.device_orient=0==window.orientation||180==window.orientation?"portrait":"landscape",void 0!==e&&$p.eve.callEvent("onOrientationChange",[$p.job_prm.device_orient])}},steps:{value:{load_meta:0,authorization:1,create_managers:2,process_access:3,load_data_files:4,load_data_db:5,load_data_wsql:6,save_data_wsql:7}},log_in:{value:function(e){var t,n={};return e($p.eve.steps.load_meta),$p.ajax.default_attr(n,$p.job_prm.irest_url()),($p.job_prm.offline?Promise.resolve({responseURL:"",response:""}):$p.ajax.get_ex(n.url,n)).then(function(e){if($p.job_prm.offline||($p.job_prm.irest_enabled=!0),"{"==e.response[0])return JSON.parse(e.response)}).catch(function(){}).then(function(n){return e($p.eve.steps.authorization),t=n,t.root=!0,$p.job_prm.offline||$p.job_prm.irest_enabled?t:$p.ajax.get_ex($p.job_prm.rest_url()+"?$format=json",!0).then(function(){return t})}).catch(function(e){throw $p.iface.auth.onerror&&$p.iface.auth.onerror(e),e}).then(function(t){if(e($p.eve.steps.load_data_files),$p.job_prm.offline)return t;$p.eve.callEvent("user_log_in",[$p.ajax.authorized=!0]),"string"==typeof t&&(t=JSON.parse(t)),$p.msg.check_soap_result(t)||($p.wsql.get_user_param("enable_save_pwd")?$p.wsql.set_user_param("user_pwd",$p.ajax.password):$p.wsql.get_user_param("user_pwd")&&$p.wsql.set_user_param("user_pwd",""),t.now_1c&&t.now_js&&$p.wsql.set_user_param("time_diff",t.now_1c-t.now_js))}).then(function(){_md.printing_plates(t.printing_plates)})}}}),function(w,eve,msg){var timer_setted=!1,cache;w.addEventListener("online",eve.set_offline),w.addEventListener("offline",function(){eve.set_offline(!0)}),w.addEventListener("load",function(){setTimeout(function(){function navigate(e){e&&-1==(location.origin+location.pathname).indexOf(e)&&location.replace(e)}function init_params(){function e(){$p.wsql.pouch.load_data().catch($p.record_log),document.querySelector("#splash")&&document.querySelector("#splash").parentNode.removeChild(splash),eve.callEvent("iface_init",[$p])}if($p.wsql.init_params(),"dhtmlx"in w&&function(){var e=dhtmlx.codebase,t=!0,n=!0;-1!=e.indexOf("cdn.jsdelivr.net")&&(e="//cdn.jsdelivr.net/metadata/latest/");for(var i=0;i<document.styleSheets.length;i++)document.styleSheets[i].href&&(-1==document.styleSheets[i].href.indexOf("dhx_web")&&-1==document.styleSheets[i].href.indexOf("dhx_terrace")||(t=!1),-1!=document.styleSheets[i].href.indexOf("metadata.css")&&(n=!1));dhtmlx.skin=$p.wsql.get_user_param("skin")||$p.job_prm.skin||"dhx_web",t&&$p.load_script(e+("dhx_web"==dhtmlx.skin?"dhx_web.css":"dhx_terrace.css"),"link"),n&&$p.load_script(e+"metadata.css","link"),$p.job_prm.additional_css&&$p.job_prm.additional_css.forEach(function(e){(dhx4.isIE||-1==e.indexOf("ie_only"))&&$p.load_script(e,"link")}),dhtmlx.image_path="//oknosoft.github.io/metadata.js/lib/imgs/",dhtmlx.skin_suffix=function(){return dhtmlx.skin.replace("dhx","")+"/"},dhx4.ajax.cache=!0,$p.iface.__define("w",{value:new dhtmlXWindows,enumerable:!1}),$p.iface.w.setSkin(dhtmlx.skin),$p.iface.__define("popup",{value:new dhtmlXPopup,enumerable:!1})}(),void 0===w.orientation?$p.job_prm.device_orient=w.innerWidth>w.innerHeight?"landscape":"portrait":eve.on_rotate(),w.addEventListener("orientationchange",eve.on_rotate,!1),eve.stepper={step:0,count_all:0,step_size:57,files:0,ram:{},doc:{}},eve.set_offline(!navigator.onLine),$p.wsql.get_user_param("couch_direct")){var t=eve.attachEvent("user_log_in",function(){eve.detachEvent(t),e()});$p.wsql.get_user_param("zone")==$p.job_prm.zone_demo&&!$p.wsql.get_user_param("user_name")&&$p.job_prm.guests.length&&($p.wsql.set_user_param("enable_save_pwd",!0),$p.wsql.set_user_param("user_name",$p.job_prm.guests[0].username),$p.wsql.set_user_param("user_pwd",$p.job_prm.guests[0].password)),setTimeout(function(){$p.iface.frm_auth({modal_dialog:!0,try_auto:!1})},100)}else setTimeout(e,20);(cache=w.applicationCache)&&(cache.addEventListener("noupdate",function(e){},!1),cache.addEventListener("cached",function(e){timer_setted=!0,$p.iface.appcache&&$p.iface.appcache.close()},!1),cache.addEventListener("updateready",function(e){try{cache.swapCache()}catch(e){}$p.iface.do_reload()},!1),cache.addEventListener("error",$p.record_log,!1))}if(!w.JSON||!w.indexedDB)throw eve.redirect=!0,msg.show_msg({type:"alert-error",text:msg.unsupported_browser,title:msg.unsupported_browser_title}),msg.unsupported_browser;$p.__define("job_prm",{value:new JobPrm,writable:!1}),($p.job_prm.use_ip_geo||$p.job_prm.use_google_geo)&&($p.ipinfo=new IPInfo),$p.job_prm.use_google_geo&&(window.google&&window.google.maps?$p.ipinfo.location_callback():$p.on("iface_init",function(){setTimeout(function(){$p.load_script("https://maps.google.com/maps/api/js?key="+$p.job_prm.use_google_geo+"&callback=$p.ipinfo.location_callback","script",function(){})},100)})),$p.job_prm.allow_post_message&&w.addEventListener("message",function(event){if(("*"==$p.job_prm.allow_post_message||$p.job_prm.allow_post_message==event.origin)&&"string"==typeof event.data)try{var res=eval(event.data);if(res&&event.source){if("object"==typeof res)res=JSON.stringify(res);else if("function"==typeof res)return;event.source.postMessage(res,"*")}}catch(e){$p.record_log(e)}}),$p.job_prm.__define("device_type",{get:function(){var e=$p.wsql.get_user_param("device_type");return e||(e=function(e){return e<800?"phone":e<1024?"tablet":"desktop"}(Math.max(screen.width,screen.height)),$p.wsql.set_user_param("device_type",e)),e},set:function(e){$p.wsql.set_user_param("device_type",e)}}),document.body.addEventListener("keydown",function(e){eve.callEvent("keydown",[e])},!1),setTimeout(init_params,10)},10)},!1),w.onbeforeunload=function(){if(!eve.redirect)return msg.onbeforeunload},w.addEventListener("popstat",$p.iface.hash_route),w.addEventListener("hashchange",$p.iface.hash_route)}(window,$p.eve,$p.msg),SpreadsheetDocument.prototype.__define({clear:{value:function(){for(;this._attr.content.firstChild;)this._attr.content.removeChild(this._attr.content.firstChild)}},put:{value:function(e,t){var n;e instanceof HTMLElement?(n=document.createElement(e.tagName),n.innerHTML=e.innerHTML,t||(t=e.attributes)):(n=document.createElement("DIV"),n.innerHTML=e),t&&Object.keys(t).forEach(function(e){"id"!=e&&"id"!=t[e].name&&n.setAttribute(t[e].name||e,t[e].value||t[e])}),this._attr.content.appendChild(n)}},append:{value:function(e,t){switch(this._events.fill_template&&(t=this._events.fill_template(e,t)),e.attributes.kind&&e.attributes.kind.value){case"row":this.draw_rows(e,t);break;case"table":this.draw_table(e,t);break;default:this.put(dhx4.template(e.innerHTML,t),e.attributes)}}},draw_table:{value:function(e,t){function n(e){e.forEach(function(e){var t=document.createElement("TR");t.innerHTML=dhx4.template(r.innerHTML,e),s.appendChild(t)})}var i=e.attributes.tabular&&e.attributes.tabular.value;if(!i)return void console.error("Не указана табличная часть в шаблоне "+e.id);var a=t[i];if(!Array.isArray(a))return void console.error("В данных отсутствует массив "+i);var o=document.createElement("div");o.innerHTML=e.innerHTML;var s=o.querySelector("table"),r=s.querySelector("[name=row]");if(!r)return void console.error('Отсутствует <TR name="row"> в шаблоне таблицы');r.parentElement.removeChild(r);var l=s.querySelector("tbody").querySelectorAll("tr");l.forEach(function(e){e.parentElement.removeChild(e)});var c=s.querySelector("tfoot");c&&(c.parentElement.removeChild(c),c.innerHTML=dhx4.template(c.innerHTML,t),s.appendChild(c));var p=t._grouping&&t._grouping.find_rows({use:!0,parent:i});if(p&&1==p.length&&l.length){var d=p[0].field;$p.wsql.alasql("select distinct `"+d+"` from ? order by `"+d+"`",[a]).forEach(function(e){var t=document.createElement("TR");t.innerHTML=dhx4.template(l[0].innerHTML,e),s.appendChild(t),n(a.filter(function(t){return t[d]==e[d]}))})}else n(a);this.put(o.innerHTML,o.attributes)}},draw_rows:{value:function(e,t){var n=e.attributes.tabular&&e.attributes.tabular.value;if(!n)return void console.error("Не указана табличная часть в шаблоне "+e.id);var i=t[n];if(!Array.isArray(i))return void console.error("В данных отсутствует массив "+n);for(var a=0;a<i.length;a++)this.put(dhx4.template(e.innerHTML.replace(/<!---/g,"").replace(/--->/g,""),i[a]),e.attributes)}},print:{value:function(){try{$p.injected_data["view_blank.html"]instanceof Blob||($p.injected_data["view_blank.html"]=new Blob([$p.injected_data["view_blank.html"]],{type:"text/html"}));var e=this,t=window.URL.createObjectURL($p.injected_data["view_blank.html"]),n=window.open(t,"wnd_print","fullscreen,menubar=no,toolbar=no,location=no,status=no,directories=no,resizable=yes,scrollbars=yes");return(n.outerWidth<screen.availWidth||n.outerHeight<screen.availHeight)&&(n.moveTo(0,0),n.resizeTo(screen.availWidth,screen.availHeight)),n.onload=function(i){window.URL.revokeObjectURL(t),n.document.body.appendChild(e.content),e.title&&(n.document.title=e.title),n.print(),e=null},n}catch(e){window.URL.revokeObjectURL&&window.URL.revokeObjectURL(t),$p.msg.show_msg({title:$p.msg.bld_title,type:"alert-error",text:e.message.match("outerWidth")?"Ошибка открытия окна печати<br />Вероятно, в браузере заблокированы всплывающие окна":e.message})}}},content:{get:function(){return this._attr.content},set:function(e){this.clear(),"string"==typeof e?this._attr.content.innerHTML=e:e instanceof HTMLElement&&(this._attr.content.innerHTML=e.innerHTML)}},title:{get:function(){return this._attr.title},set:function(e){this._attr.title=e}}}),$p.SpreadsheetDocument=SpreadsheetDocument,$p.HandsontableDocument=HandsontableDocument,$p.injected_data._mixin({"form_auth.xml":'<?xml version="1.0" encoding="UTF-8"?>\n<items>\n\t<item type="settings" position="label-left" labelWidth="80" inputWidth="180" noteWidth="180"/>\n\t<item type="fieldset" name="data" inputWidth="auto" label="Авторизация">\n\n        <item type="radio" name="type" labelWidth="auto" position="label-right" checked="true" value="guest" label="Гостевой (демо) режим">\n            <item type="select" name="guest" label="Роль">\n                <option value="Дилер" label="Дилер"/>\n            </item>\n        </item>\n\n\t\t<item type="radio" name="type" labelWidth="auto" position="label-right" value="auth" label="Есть учетная запись">\n\t\t\t<item type="input" value="" name="login" label="Логин" validate="NotEmpty" />\n\t\t\t<item type="password" value="" name="password" label="Пароль" validate="NotEmpty" />\n\t\t</item>\n\n\t\t<item type="button" value="Войти" name="submit"/>\n\n        <item type="template" name="text_options" className="order_dealer_options" inputWidth="170"\n              value="&lt;a href=\'#\' onclick=\'$p.iface.open_settings();\' title=\'Страница настроек программы\' &gt; &lt;i class=\'fa fa-cog fa-lg\'&gt;&lt;/i&gt; Настройки &lt;/a&gt; &lt;a href=\'//www.oknosoft.ru/feedback\' target=\'_blank\' style=\'margin-left: 9px;\' title=\'Задать вопрос через форму обратной связи\' &gt; &lt;i class=\'fa fa-question-circle fa-lg\'&gt;&lt;/i&gt; Вопрос &lt;/a&gt;"  />\n\n\t</item>\n</items>',"toolbar_add_del.xml":'<?xml version="1.0" encoding=\'utf-8\'?>\n<toolbar>\n    <item id="sep0" type="separator"/>\n    <item id="btn_add" type="button"  text="&lt;i class=\'fa fa-plus-circle fa-fw\'&gt;&lt;/i&gt; Добавить" title="Добавить строку"  />\n    <item id="btn_delete" type="button" text="&lt;i class=\'fa fa-times fa-fw\'&gt;&lt;/i&gt; Удалить"  title="Удалить строку" />\n    <item id="sep1" type="separator"/>\n\n    <item id="sp" type="spacer"/>\n    <item id="input_filter" type="buttonInput" width="200" title="Поиск по подстроке" />\n</toolbar>',"toolbar_add_del_compact.xml":'<?xml version="1.0" encoding=\'utf-8\'?>\n<toolbar>\n    <item id="btn_add" type="button"  text="&lt;i class=\'fa fa-plus-circle fa-fw\'&gt;&lt;/i&gt;" title="Добавить строку"  />\n    <item id="btn_delete" type="button" text="&lt;i class=\'fa fa-times fa-fw\'&gt;&lt;/i&gt;"  title="Удалить строку" />\n    <item id="sep1" type="separator"/>\n\n</toolbar>',"toolbar_obj.xml":'<?xml version="1.0" encoding=\'utf-8\'?>\r\n<toolbar>\r\n    <item id="sep0" type="separator"/>\r\n    <item type="button" id="btn_save_close" text="&lt;b&gt;Записать и закрыть&lt;/b&gt;" title="Рассчитать, записать и закрыть" />\r\n    <item type="button" id="btn_save" text="&lt;i class=\'fa fa-floppy-o fa-fw\'&gt;&lt;/i&gt;" title="Рассчитать и записать данные"/>\r\n    <item type="button" id="btn_post" enabled="false" text="&lt;i class=\'fa fa-check-square-o fa-fw\'&gt;&lt;/i&gt;" title="Провести документ" />\r\n    <item type="button" id="btn_unpost" enabled="false" text="&lt;i class=\'fa fa-square-o fa-fw\'&gt;&lt;/i&gt;" title="Отмена проведения" />\r\n\r\n    <item type="button" id="btn_files" text="&lt;i class=\'fa fa-paperclip fa-fw\'&gt;&lt;/i&gt;" title="Присоединенные файлы"/>\r\n\r\n    <item type="buttonSelect" id="bs_print" text="&lt;i class=\'fa fa-print fa-fw\'&gt;&lt;/i&gt;" title="Печать" openAll="true">\r\n    </item>\r\n\r\n    <item type="buttonSelect" id="bs_create_by_virtue" text="&lt;i class=\'fa fa-bolt fa-fw\'&gt;&lt;/i&gt;" title="Создать на основании" openAll="true" >\r\n        <item type="button" id="btn_message" enabled="false" text="Сообщение" />\r\n    </item>\r\n\r\n    <item type="buttonSelect" id="bs_go_to" text="&lt;i class=\'fa fa-external-link fa-fw\'&gt;&lt;/i&gt;" title="Перейти" openAll="true" >\r\n        <item type="button" id="btn_go_connection" enabled="false" text="Связи" />\r\n    </item>\r\n\r\n    <item type="buttonSelect"   id="bs_more"  text="&lt;i class=\'fa fa-th-large fa-fw\'&gt;&lt;/i&gt;"  title="Дополнительно" openAll="true">\r\n\r\n        <item type="button" id="btn_import" text="&lt;i class=\'fa fa-upload fa-fw\'&gt;&lt;/i&gt; Загрузить из файла" />\r\n        <item type="button" id="btn_export" text="&lt;i class=\'fa fa-download fa-fw\'&gt;&lt;/i&gt; Выгрузить в файл" />\r\n    </item>\r\n\r\n    <item id="sep1" type="separator"/>\r\n    <item type="button" id="btn_close" text="&lt;i class=\'fa fa-times fa-fw\'&gt;&lt;/i&gt;" title="Закрыть форму"/>\r\n    <item id="sep2" type="separator"/>\r\n\r\n</toolbar>\r\n',"toolbar_ok_cancel.xml":'<?xml version="1.0" encoding=\'utf-8\'?>\r\n<toolbar>\r\n    <item id="btn_ok"       type="button"   img=""  imgdis=""   text="&lt;b&gt;Ок&lt;/b&gt;"  />\r\n    <item id="btn_cancel"   type="button"\timg=""  imgdis=""   text="Отмена" />\r\n</toolbar>',"toolbar_rep.xml":'<?xml version="1.0" encoding=\'utf-8\'?>\r\n<toolbar>\r\n    <item id="sep0" type="separator"/>\r\n    <item type="button" id="btn_run" text="&lt;i class=\'fa fa-play fa-fw\'&gt;&lt;/i&gt; Сформировать" title="Сформировать отчет"/>\r\n\r\n    <item type="buttonSelect"   id="bs_more"  text="&lt;i class=\'fa fa-th-large fa-fw\'&gt;&lt;/i&gt;"  title="Дополнительно" openAll="true">\r\n\r\n        <item type="button" id="btn_print" text="&lt;i class=\'fa fa-print fa-fw\'&gt;&lt;/i&gt; Печать" />\r\n\r\n        <item id="sep3" type="separator"/>\r\n\r\n        <item type="button" id="btn_export" text="&lt;i class=\'fa fa-file-excel-o fa-fw\'&gt;&lt;/i&gt; Выгрузить в файл" />\r\n\r\n        <item id="sep4" type="separator"/>\r\n\r\n        <item type="button" id="btn_save" text="&lt;i class=\'fa fa-folder-open-o fa-fw\'&gt;&lt;/i&gt; Выбрать вариант" />\r\n        <item type="button" id="btn_load" text="&lt;i class=\'fa fa-floppy-o fa-fw\'&gt;&lt;/i&gt; Сохранить вариант" />\r\n\r\n    </item>\r\n\r\n    <item id="sep1" type="separator"/>\r\n\r\n</toolbar>\r\n',"toolbar_selection.xml":'<?xml version="1.0" encoding=\'utf-8\'?>\r\n<toolbar>\r\n\r\n    <item id="sep0" type="separator"/>\r\n\r\n    <item id="btn_select"   type="button"   title="Выбрать элемент списка" text="&lt;b&gt;Выбрать&lt;/b&gt;"  />\r\n\r\n    <item id="sep1" type="separator"/>\r\n    <item id="btn_new"      type="button"\ttext="&lt;i class=\'fa fa-plus-circle fa-fw\'&gt;&lt;/i&gt;"\ttitle="Создать" />\r\n    <item id="btn_edit"     type="button"\ttext="&lt;i class=\'fa fa-pencil fa-fw\'&gt;&lt;/i&gt;"\ttitle="Изменить" />\r\n    <item id="btn_delete"   type="button"\ttext="&lt;i class=\'fa fa-times fa-fw\'&gt;&lt;/i&gt;"\ttitle="Удалить" />\r\n    <item id="sep2" type="separator"/>\r\n\r\n    <item type="buttonSelect" id="bs_print" text="&lt;i class=\'fa fa-print fa-fw\'&gt;&lt;/i&gt; Печать" openAll="true" >\r\n    </item>\r\n\r\n    <item type="buttonSelect"   id="bs_more"    text="&lt;i class=\'fa fa-th-large fa-fw\'&gt;&lt;/i&gt;" title="Дополнительно" openAll="true">\r\n        <item id="btn_requery"  type="button"\ttext="&lt;i class=\'fa fa-refresh fa-fw\'&gt;&lt;/i&gt; Обновить список" />\r\n    </item>\r\n\r\n    <item id="sep3" type="separator"/>\r\n\r\n</toolbar>'});var xmlToJSON=function(){this.version="1.3";var e={mergeCDATA:!0,grokAttr:!0,grokText:!0,normalize:!0,xmlns:!0,namespaceKey:"_ns",textKey:"_text",valueKey:"_value",attrKey:"_attr",cdataKey:"_cdata",attrsAsObject:!0,stripAttrPrefix:!0,stripElemPrefix:!0,childrenAsArray:!0},t=new RegExp(/(?!xmlns)^.*:/),n=new RegExp(/^\s+|\s+$/g);return this.grokType=function(e){return/^\s*$/.test(e)?null:/^(?:true|false)$/i.test(e)?"true"===e.toLowerCase():isFinite(e)?parseFloat(e):e},this.parseString=function(e,t){return this.parseXML(this.stringToXML(e),t)},this.parseXML=function(i,a){for(var o in a)e[o]=a[o];var s={},r=0,l="";if(e.xmlns&&i.namespaceURI&&(s[e.namespaceKey]=i.namespaceURI),i.attributes&&i.attributes.length>0){var c={};for(r;r<i.attributes.length;r++){var p=i.attributes.item(r);m={};var d="";d=e.stripAttrPrefix?p.name.replace(t,""):p.name,e.grokAttr?m[e.valueKey]=this.grokType(p.value.replace(n,"")):m[e.valueKey]=p.value.replace(n,""),e.xmlns&&p.namespaceURI&&(m[e.namespaceKey]=p.namespaceURI),e.attrsAsObject?c[d]=m:s[e.attrKey+d]=m}e.attrsAsObject&&(s[e.attrKey]=c)}if(i.hasChildNodes())for(var u,f,m,_=0;_<i.childNodes.length;_++)u=i.childNodes.item(_),4===u.nodeType?e.mergeCDATA?l+=u.nodeValue:s.hasOwnProperty(e.cdataKey)?(s[e.cdataKey].constructor!==Array&&(s[e.cdataKey]=[s[e.cdataKey]]),s[e.cdataKey].push(u.nodeValue)):e.childrenAsArray?(s[e.cdataKey]=[],s[e.cdataKey].push(u.nodeValue)):s[e.cdataKey]=u.nodeValue:3===u.nodeType?l+=u.nodeValue:1===u.nodeType&&(0===r&&(s={}),f=e.stripElemPrefix?u.nodeName.replace(t,""):u.nodeName,m=xmlToJSON.parseXML(u),s.hasOwnProperty(f)?(s[f].constructor!==Array&&(s[f]=[s[f]]),s[f].push(m)):(e.childrenAsArray?(s[f]=[],s[f].push(m)):s[f]=m,r++));else l||(e.childrenAsArray?(s[e.textKey]=[],s[e.textKey].push(null)):s[e.textKey]=null);if(l)if(e.grokText){var h=this.grokType(l.replace(n,""))
;null!==h&&void 0!==h&&(s[e.textKey]=h)}else e.normalize?s[e.textKey]=l.replace(n,"").replace(/\s+/g," "):s[e.textKey]=l.replace(n,"");return s},this.xmlToString=function(e){try{return e.xml?e.xml:(new XMLSerializer).serializeToString(e)}catch(e){return null}},this.stringToXML=function(e){try{var t=null;if(window.DOMParser){return t=(new DOMParser).parseFromString(e,"text/xml")}return t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(e),t}catch(e){return null}},this}();"undefined"!=typeof module&&null!==module&&module.exports?module.exports=xmlToJSON:"function"==typeof define&&define.amd&&define(function(){return xmlToJSON});/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */
var saveAs=saveAs||function(e){"use strict";if(!(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=e.document,n=function(){return e.URL||e.webkitURL||e},i=t.createElementNS("http://www.w3.org/1999/xhtml","a"),a="download"in i,o=function(e){var t=new MouseEvent("click");e.dispatchEvent(t)},s=/constructor/i.test(e.HTMLElement),r=/CriOS\/[\d]+/.test(navigator.userAgent),l=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},c=function(e){var t=function(){"string"==typeof e?n().revokeObjectURL(e):e.remove()};setTimeout(t,4e4)},p=function(e,t,n){t=[].concat(t);for(var i=t.length;i--;){var a=e["on"+t[i]];if("function"==typeof a)try{a.call(e,n||e)}catch(e){l(e)}}},d=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},u=function(t,l,u){u||(t=d(t));var f,m=this,_=t.type,h="application/octet-stream"===_,g=function(){p(m,"writestart progress write writeend".split(" "))};if(m.readyState=m.INIT,a)return f=n().createObjectURL(t),void setTimeout(function(){i.href=f,i.download=l,o(i),g(),c(f),m.readyState=m.DONE});!function(){if((r||h&&s)&&e.FileReader){var i=new FileReader;return i.onloadend=function(){var t=r?i.result:i.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(t,"_blank")||(e.location.href=t),t=void 0,m.readyState=m.DONE,g()},i.readAsDataURL(t),void(m.readyState=m.INIT)}if(f||(f=n().createObjectURL(t)),h)e.location.href=f;else{e.open(f,"_blank")||(e.location.href=f)}m.readyState=m.DONE,g(),c(f)}()},f=u.prototype,m=function(e,t,n){return new u(e,t||e.name||"download",n)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return t=t||e.name||"download",n||(e=d(e)),navigator.msSaveOrOpenBlob(e,t)}:(f.abort=function(){},f.readyState=f.INIT=0,f.WRITING=1,f.DONE=2,f.error=f.onwritestart=f.onprogress=f.onwrite=f.onabort=f.onerror=f.onwriteend=null,m)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);/*!
 * mime-db
 * Copyright(c) 2014 Jonathan Ong
 * MIT Licensed
 */
return"undefined"!=typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define([],function(){return saveAs}),"undefined"!=typeof module&&module.exports&&(module.exports=Aes),function(){"use strict";var e=[["","один","два","три","четыре","пять","шесть","семь","восемь","девять","десять","одиннадцать","двенадцать","тринадцать","четырнадцать","пятнадцать","шестнадцать","семнадцать","восемнадцать","девятнадцать"],["","","двадцать","тридцать","сорок","пятьдесят","шестьдесят","семьдесят","восемьдесят","девяносто"],["","сто","двести","триста","четыреста","пятьсот","шестьсот","семьсот","восемьсот","девятьсот"]],t=function(e){return parseFloat(e)},n=function(e,t){if(3!==t.length)return!1;e=Math.abs(e)%100;var n=e%10;return e>10&&e<20?t[2]:n>1&&n<5?t[1]:1===n?t[0]:t[2]},i=function(i,a){var o,s,r="";return 3===i.length&&(o=i.substr(0,1),i=i.substr(1,3),r=e[2][o]+" "),i<20?r=r+e[0][t(i)]+" ":(o=i.substr(0,1),s=i.substr(1,2),r=r+e[1][o]+" "+e[0][s]+" "),0===a?r+=n(i,["рубль","рубля","рублей"]):1===a?"  "!==r&&(r+=n(i,["тысяча ","тысячи ","тысяч "]),r=r.replace("один ","одна ").replace("два ","две ")):2===a?"  "!==r&&(r+=n(i,["миллион ","миллиона ","миллионов "])):3===a&&(r+=n(i,["миллиард ","миллиарда ","миллиардов "])),r},a=function(e){var t=n(e,["копейка","копейки","копеек"]);return 0===e?e="00":e<10&&(e="0"+e)," "+e+" "+t},o=function(e){if(!e)return!1;var n=typeof e;if("number"!==n&&"string"!==n)return!1;if("string"===n&&(e=t(e.replace(",",".")),isNaN(e)))return!1;if(e<=0)return!1;var o,s;e=e.toFixed(2),-1!==e.indexOf(".")&&(o=e.split("."),e=o[0],s=o[1]);for(var r,l="",c=e.length-1,p="",d=0;c>=0;)r=e.substr(c,1),p=r+p,3!==p.length&&0!==c||isNaN(t(p))||(l=i(p,d)+l,p="",d++),c--;return l=l.replace(/\s+/g," "),s&&(l+=a(t(s))),l};Number.prototype.in_words||(Number.prototype.in_words=function(){return o(this)})}(),$p.utils.__define({mime_db:{value:{"application/andrew-inset":{extensions:["ez"]},"application/applixware":{extensions:["aw"]},"application/atom+xml":{compressible:!0,extensions:["atom"]},"application/atomcat+xml":{extensions:["atomcat"]},"application/atomsvc+xml":{extensions:["atomsvc"]},"application/bdoc":{compressible:!1,extensions:["bdoc"]},"application/ccxml+xml":{extensions:["ccxml"]},"application/cdmi-capability":{extensions:["cdmia"]},"application/cdmi-container":{extensions:["cdmic"]},"application/cdmi-domain":{extensions:["cdmid"]},"application/cdmi-object":{extensions:["cdmio"]},"application/cdmi-queue":{extensions:["cdmiq"]},"application/cu-seeme":{extensions:["cu"]},"application/dash+xml":{extensions:["mpd"]},"application/davmount+xml":{extensions:["davmount"]},"application/docbook+xml":{extensions:["dbk"]},"application/dssc+der":{extensions:["dssc"]},"application/dssc+xml":{extensions:["xdssc"]},"application/ecmascript":{compressible:!0,extensions:["ecma"]},"application/emma+xml":{extensions:["emma"]},"application/epub+zip":{extensions:["epub"]},"application/exi":{extensions:["exi"]},"application/font-tdpfr":{extensions:["pfr"]},"application/font-woff":{compressible:!1,extensions:["woff"]},"application/font-woff2":{compressible:!1,extensions:["woff2"]},"application/gml+xml":{extensions:["gml"]},"application/gpx+xml":{extensions:["gpx"]},"application/gxf":{extensions:["gxf"]},"application/hyperstudio":{extensions:["stk"]},"application/inkml+xml":{extensions:["ink","inkml"]},"application/ipfix":{extensions:["ipfix"]},"application/java-archive":{compressible:!1,extensions:["jar","war","ear"]},"application/java-serialized-object":{compressible:!1,extensions:["ser"]},"application/java-vm":{compressible:!1,extensions:["class"]},"application/javascript":{charset:"UTF-8",compressible:!0,extensions:["js"]},"application/json":{charset:"UTF-8",compressible:!0,extensions:["json","map"]},"application/json-patch+json":{compressible:!0},"application/json5":{extensions:["json5"]},"application/jsonml+json":{compressible:!0,extensions:["jsonml"]},"application/ld+json":{compressible:!0,extensions:["jsonld"]},"application/lost+xml":{extensions:["lostxml"]},"application/mac-binhex40":{extensions:["hqx"]},"application/mac-compactpro":{extensions:["cpt"]},"application/mads+xml":{extensions:["mads"]},"application/manifest+json":{charset:"UTF-8",compressible:!0,extensions:["webmanifest"]},"application/marc":{extensions:["mrc"]},"application/marcxml+xml":{extensions:["mrcx"]},"application/mathematica":{extensions:["ma","nb","mb"]},"application/mathml+xml":{extensions:["mathml"]},"application/mbox":{extensions:["mbox"]},"application/mediaservercontrol+xml":{extensions:["mscml"]},"application/metalink+xml":{extensions:["metalink"]},"application/metalink4+xml":{extensions:["meta4"]},"application/mets+xml":{extensions:["mets"]},"application/mods+xml":{extensions:["mods"]},"application/mp21":{extensions:["m21","mp21"]},"application/mp4":{extensions:["mp4s","m4p"]},"application/msword":{compressible:!1,extensions:["doc","dot"]},"application/mxf":{extensions:["mxf"]},"application/octet-stream":{compressible:!1,extensions:["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"]},"application/oda":{extensions:["oda"]},"application/oebps-package+xml":{extensions:["opf"]},"application/ogg":{compressible:!1,extensions:["ogx"]},"application/omdoc+xml":{extensions:["omdoc"]},"application/onenote":{extensions:["onetoc","onetoc2","onetmp","onepkg"]},"application/oxps":{extensions:["oxps"]},"application/patch-ops-error+xml":{extensions:["xer"]},"application/pdf":{compressible:!1,extensions:["pdf"]},"application/pgp-encrypted":{compressible:!1,extensions:["pgp"]},"application/pgp-signature":{extensions:["asc","sig"]},"application/pics-rules":{extensions:["prf"]},"application/pkcs10":{extensions:["p10"]},"application/pkcs7-mime":{extensions:["p7m","p7c"]},"application/pkcs7-signature":{extensions:["p7s"]},"application/pkcs8":{extensions:["p8"]},"application/pkix-attr-cert":{extensions:["ac"]},"application/pkix-cert":{extensions:["cer"]},"application/pkix-crl":{extensions:["crl"]},"application/pkix-pkipath":{extensions:["pkipath"]},"application/pkixcmp":{extensions:["pki"]},"application/pls+xml":{extensions:["pls"]},"application/postscript":{compressible:!0,extensions:["ai","eps","ps"]},"application/prs.cww":{extensions:["cww"]},"application/pskc+xml":{extensions:["pskcxml"]},"application/rdf+xml":{compressible:!0,extensions:["rdf"]},"application/reginfo+xml":{extensions:["rif"]},"application/relax-ng-compact-syntax":{extensions:["rnc"]},"application/resource-lists+xml":{extensions:["rl"]},"application/resource-lists-diff+xml":{extensions:["rld"]},"application/rls-services+xml":{extensions:["rs"]},"application/rpki-ghostbusters":{extensions:["gbr"]},"application/rpki-manifest":{extensions:["mft"]},"application/rpki-roa":{extensions:["roa"]},"application/rsd+xml":{extensions:["rsd"]},"application/rss+xml":{compressible:!0,extensions:["rss"]},"application/rtf":{compressible:!0,extensions:["rtf"]},"application/sbml+xml":{extensions:["sbml"]},"application/scvp-cv-request":{extensions:["scq"]},"application/scvp-cv-response":{extensions:["scs"]},"application/scvp-vp-request":{extensions:["spq"]},"application/scvp-vp-response":{extensions:["spp"]},"application/sdp":{extensions:["sdp"]},"application/set-payment-initiation":{extensions:["setpay"]},"application/set-registration-initiation":{extensions:["setreg"]},"application/shf+xml":{extensions:["shf"]},"application/smil+xml":{extensions:["smi","smil"]},"application/sparql-query":{extensions:["rq"]},"application/sparql-results+xml":{extensions:["srx"]},"application/srgs":{extensions:["gram"]},"application/srgs+xml":{extensions:["grxml"]},"application/sru+xml":{extensions:["sru"]},"application/ssdl+xml":{extensions:["ssdl"]},"application/ssml+xml":{extensions:["ssml"]},"application/tei+xml":{extensions:["tei","teicorpus"]},"application/thraud+xml":{extensions:["tfi"]},"application/timestamped-data":{extensions:["tsd"]},"application/vnd.3gpp.pic-bw-large":{extensions:["plb"]},"application/vnd.3gpp.pic-bw-small":{extensions:["psb"]},"application/vnd.3gpp.pic-bw-var":{extensions:["pvb"]},"application/vnd.3gpp2.tcap":{extensions:["tcap"]},"application/vnd.3m.post-it-notes":{extensions:["pwn"]},"application/vnd.accpac.simply.aso":{extensions:["aso"]},"application/vnd.accpac.simply.imp":{extensions:["imp"]},"application/vnd.acucobol":{extensions:["acu"]},"application/vnd.acucorp":{extensions:["atc","acutc"]},"application/vnd.adobe.air-application-installer-package+zip":{extensions:["air"]},"application/vnd.adobe.formscentral.fcdt":{extensions:["fcdt"]},"application/vnd.adobe.fxp":{extensions:["fxp","fxpl"]},"application/vnd.adobe.xdp+xml":{extensions:["xdp"]},"application/vnd.adobe.xfdf":{extensions:["xfdf"]},"application/vnd.ahead.space":{extensions:["ahead"]},"application/vnd.airzip.filesecure.azf":{extensions:["azf"]},"application/vnd.airzip.filesecure.azs":{extensions:["azs"]},"application/vnd.amazon.ebook":{extensions:["azw"]},"application/vnd.americandynamics.acc":{extensions:["acc"]},"application/vnd.amiga.ami":{extensions:["ami"]},"application/vnd.android.package-archive":{compressible:!1,extensions:["apk"]},"application/vnd.anser-web-certificate-issue-initiation":{extensions:["cii"]},"application/vnd.anser-web-funds-transfer-initiation":{extensions:["fti"]},"application/vnd.antix.game-component":{extensions:["atx"]},"application/vnd.apple.installer+xml":{extensions:["mpkg"]},"application/vnd.apple.mpegurl":{extensions:["m3u8"]},"application/vnd.apple.pkpass":{compressible:!1,extensions:["pkpass"]},"application/vnd.aristanetworks.swi":{extensions:["swi"]},"application/vnd.astraea-software.iota":{extensions:["iota"]},"application/vnd.audiograph":{extensions:["aep"]},"application/vnd.blueice.multipass":{extensions:["mpm"]},"application/vnd.bmi":{extensions:["bmi"]},"application/vnd.businessobjects":{extensions:["rep"]},"application/vnd.chemdraw+xml":{extensions:["cdxml"]},"application/vnd.chipnuts.karaoke-mmd":{extensions:["mmd"]},"application/vnd.cinderella":{extensions:["cdy"]},"application/vnd.claymore":{extensions:["cla"]},"application/vnd.cloanto.rp9":{extensions:["rp9"]},"application/vnd.clonk.c4group":{extensions:["c4g","c4d","c4f","c4p","c4u"]},"application/vnd.cluetrust.cartomobile-config":{extensions:["c11amc"]},"application/vnd.cluetrust.cartomobile-config-pkg":{extensions:["c11amz"]},"application/vnd.commonspace":{extensions:["csp"]},"application/vnd.contact.cmsg":{extensions:["cdbcmsg"]},"application/vnd.cosmocaller":{extensions:["cmc"]},"application/vnd.crick.clicker":{extensions:["clkx"]},"application/vnd.crick.clicker.keyboard":{extensions:["clkk"]},"application/vnd.crick.clicker.palette":{extensions:["clkp"]},"application/vnd.crick.clicker.template":{extensions:["clkt"]},"application/vnd.crick.clicker.wordbank":{extensions:["clkw"]},"application/vnd.criticaltools.wbs+xml":{extensions:["wbs"]},"application/vnd.ctc-posml":{extensions:["pml"]},"application/vnd.cups-ppd":{extensions:["ppd"]},"application/vnd.curl.car":{extensions:["car"]},"application/vnd.curl.pcurl":{extensions:["pcurl"]},"application/vnd.dart":{compressible:!0,extensions:["dart"]},"application/vnd.data-vision.rdz":{extensions:["rdz"]},"application/vnd.dece.data":{extensions:["uvf","uvvf","uvd","uvvd"]},"application/vnd.dece.ttml+xml":{extensions:["uvt","uvvt"]},"application/vnd.dece.unspecified":{extensions:["uvx","uvvx"]},"application/vnd.dece.zip":{extensions:["uvz","uvvz"]},"application/vnd.denovo.fcselayout-link":{extensions:["fe_launch"]},"application/vnd.dna":{extensions:["dna"]},"application/vnd.dolby.mlp":{extensions:["mlp"]},"application/vnd.dpgraph":{extensions:["dpg"]},"application/vnd.dreamfactory":{extensions:["dfac"]},"application/vnd.ds-keypoint":{extensions:["kpxx"]},"application/vnd.dvb.ait":{extensions:["ait"]},"application/vnd.dvb.service":{extensions:["svc"]},"application/vnd.dynageo":{extensions:["geo"]},"application/vnd.ecowin.chart":{extensions:["mag"]},"application/vnd.enliven":{extensions:["nml"]},"application/vnd.epson.esf":{extensions:["esf"]},"application/vnd.epson.msf":{extensions:["msf"]},"application/vnd.epson.quickanime":{extensions:["qam"]},"application/vnd.epson.salt":{extensions:["slt"]},"application/vnd.epson.ssf":{extensions:["ssf"]},"application/vnd.eszigno3+xml":{extensions:["es3","et3"]},"application/vnd.ezpix-album":{extensions:["ez2"]},"application/vnd.ezpix-package":{extensions:["ez3"]},"application/vnd.fdf":{extensions:["fdf"]},"application/vnd.fdsn.mseed":{extensions:["mseed"]},"application/vnd.fdsn.seed":{extensions:["seed","dataless"]},"application/vnd.flographit":{extensions:["gph"]},"application/vnd.fluxtime.clip":{extensions:["ftc"]},"application/vnd.framemaker":{extensions:["fm","frame","maker","book"]},"application/vnd.frogans.fnc":{extensions:["fnc"]},"application/vnd.frogans.ltf":{extensions:["ltf"]},"application/vnd.fsc.weblaunch":{extensions:["fsc"]},"application/vnd.fujitsu.oasys":{extensions:["oas"]},"application/vnd.fujitsu.oasys2":{extensions:["oa2"]},"application/vnd.fujitsu.oasys3":{extensions:["oa3"]},"application/vnd.fujitsu.oasysgp":{extensions:["fg5"]},"application/vnd.fujitsu.oasysprs":{extensions:["bh2"]},"application/vnd.fujixerox.ddd":{extensions:["ddd"]},"application/vnd.fujixerox.docuworks":{extensions:["xdw"]},"application/vnd.fujixerox.docuworks.binder":{extensions:["xbd"]},"application/vnd.fuzzysheet":{extensions:["fzs"]},"application/vnd.genomatix.tuxedo":{extensions:["txd"]},"application/vnd.geogebra.file":{extensions:["ggb"]},"application/vnd.geogebra.tool":{extensions:["ggt"]},"application/vnd.geometry-explorer":{extensions:["gex","gre"]},"application/vnd.geonext":{extensions:["gxt"]},"application/vnd.geoplan":{extensions:["g2w"]},"application/vnd.geospace":{extensions:["g3w"]},"application/vnd.gmx":{extensions:["gmx"]},"application/vnd.google-apps.document":{compressible:!1,extensions:["gdoc"]},"application/vnd.google-apps.presentation":{compressible:!1,extensions:["gslides"]},"application/vnd.google-apps.spreadsheet":{compressible:!1,extensions:["gsheet"]},"application/vnd.google-earth.kml+xml":{compressible:!0,extensions:["kml"]},"application/vnd.google-earth.kmz":{compressible:!1,extensions:["kmz"]},"application/vnd.grafeq":{extensions:["gqf","gqs"]},"application/vnd.groove-account":{extensions:["gac"]},"application/vnd.groove-help":{extensions:["ghf"]},"application/vnd.groove-identity-message":{extensions:["gim"]},"application/vnd.groove-injector":{extensions:["grv"]},"application/vnd.groove-tool-message":{extensions:["gtm"]},"application/vnd.groove-tool-template":{extensions:["tpl"]},"application/vnd.groove-vcard":{extensions:["vcg"]},"application/vnd.hal+xml":{extensions:["hal"]},"application/vnd.handheld-entertainment+xml":{extensions:["zmm"]},"application/vnd.hbci":{extensions:["hbci"]},"application/vnd.hhe.lesson-player":{extensions:["les"]},"application/vnd.hp-hpgl":{extensions:["hpgl"]},"application/vnd.hp-hpid":{extensions:["hpid"]},"application/vnd.hp-hps":{extensions:["hps"]},"application/vnd.hp-jlyt":{extensions:["jlt"]},"application/vnd.hp-pcl":{extensions:["pcl"]},"application/vnd.hp-pclxl":{extensions:["pclxl"]},"application/vnd.hydrostatix.sof-data":{extensions:["sfd-hdstx"]},"application/vnd.ibm.minipay":{extensions:["mpy"]},"application/vnd.ibm.modcap":{extensions:["afp","listafp","list3820"]},"application/vnd.ibm.rights-management":{extensions:["irm"]},"application/vnd.ibm.secure-container":{extensions:["sc"]},"application/vnd.iccprofile":{extensions:["icc","icm"]},"application/vnd.igloader":{extensions:["igl"]},"application/vnd.immervision-ivp":{extensions:["ivp"]},"application/vnd.immervision-ivu":{extensions:["ivu"]},"application/vnd.insors.igm":{extensions:["igm"]},"application/vnd.intercon.formnet":{extensions:["xpw","xpx"]},"application/vnd.intergeo":{extensions:["i2g"]},"application/vnd.intu.qbo":{extensions:["qbo"]},"application/vnd.intu.qfx":{extensions:["qfx"]},"application/vnd.ipunplugged.rcprofile":{extensions:["rcprofile"]},"application/vnd.irepository.package+xml":{extensions:["irp"]},"application/vnd.is-xpr":{extensions:["xpr"]},"application/vnd.isac.fcs":{extensions:["fcs"]},"application/vnd.jam":{extensions:["jam"]},"application/vnd.jcp.javame.midlet-rms":{extensions:["rms"]},"application/vnd.jisp":{extensions:["jisp"]},"application/vnd.joost.joda-archive":{extensions:["joda"]},"application/vnd.kahootz":{extensions:["ktz","ktr"]},"application/vnd.kde.karbon":{extensions:["karbon"]},"application/vnd.kde.kchart":{extensions:["chrt"]},"application/vnd.kde.kformula":{extensions:["kfo"]},"application/vnd.kde.kivio":{extensions:["flw"]},"application/vnd.kde.kontour":{extensions:["kon"]},"application/vnd.kde.kpresenter":{extensions:["kpr","kpt"]},"application/vnd.kde.kspread":{extensions:["ksp"]},"application/vnd.kde.kword":{extensions:["kwd","kwt"]},"application/vnd.kenameaapp":{extensions:["htke"]},"application/vnd.kidspiration":{extensions:["kia"]},"application/vnd.kinar":{extensions:["kne","knp"]},"application/vnd.koan":{extensions:["skp","skd","skt","skm"]},"application/vnd.kodak-descriptor":{extensions:["sse"]},"application/vnd.las.las+xml":{extensions:["lasxml"]},"application/vnd.llamagraphics.life-balance.desktop":{extensions:["lbd"]},"application/vnd.llamagraphics.life-balance.exchange+xml":{extensions:["lbe"]},"application/vnd.lotus-1-2-3":{extensions:["123"]},"application/vnd.lotus-approach":{extensions:["apr"]},"application/vnd.lotus-freelance":{extensions:["pre"]},"application/vnd.lotus-notes":{extensions:["nsf"]},"application/vnd.lotus-organizer":{extensions:["org"]},"application/vnd.lotus-screencam":{extensions:["scm"]},"application/vnd.lotus-wordpro":{extensions:["lwp"]},"application/vnd.macports.portpkg":{extensions:["portpkg"]},"application/vnd.mcd":{extensions:["mcd"]},"application/vnd.medcalcdata":{extensions:["mc1"]},"application/vnd.mediastation.cdkey":{extensions:["cdkey"]},"application/vnd.mfer":{extensions:["mwf"]},"application/vnd.mfmp":{extensions:["mfm"]},"application/vnd.micrografx.flo":{extensions:["flo"]},"application/vnd.micrografx.igx":{extensions:["igx"]},"application/vnd.mif":{extensions:["mif"]},"application/vnd.mobius.daf":{extensions:["daf"]},"application/vnd.mobius.dis":{extensions:["dis"]},"application/vnd.mobius.mbk":{extensions:["mbk"]},"application/vnd.mobius.mqy":{extensions:["mqy"]},"application/vnd.mobius.msl":{extensions:["msl"]},"application/vnd.mobius.plc":{extensions:["plc"]},"application/vnd.mobius.txf":{extensions:["txf"]},"application/vnd.mophun.application":{extensions:["mpn"]},"application/vnd.mophun.certificate":{extensions:["mpc"]},"application/vnd.mozilla.xul+xml":{compressible:!0,extensions:["xul"]},"application/vnd.ms-cab-compressed":{extensions:["cab"]},"application/vnd.ms-excel":{compressible:!1,extensions:["xls","xlm","xla","xlc","xlt","xlw"]},"application/vnd.ms-excel.addin.macroenabled.12":{extensions:["xlam"]},"application/vnd.ms-excel.sheet.binary.macroenabled.12":{extensions:["xlsb"]},"application/vnd.ms-excel.sheet.macroenabled.12":{extensions:["xlsm"]},"application/vnd.ms-excel.template.macroenabled.12":{extensions:["xltm"]},"application/vnd.ms-fontobject":{compressible:!0,extensions:["eot"]},"application/vnd.ms-htmlhelp":{extensions:["chm"]},"application/vnd.ms-ims":{extensions:["ims"]},"application/vnd.ms-lrm":{extensions:["lrm"]},"application/vnd.ms-officetheme":{extensions:["thmx"]},"application/vnd.ms-opentype":{compressible:!0},"application/vnd.ms-pki.seccat":{extensions:["cat"]},"application/vnd.ms-pki.stl":{extensions:["stl"]},"application/vnd.ms-powerpoint":{compressible:!1,extensions:["ppt","pps","pot"]},"application/vnd.ms-powerpoint.addin.macroenabled.12":{extensions:["ppam"]},"application/vnd.ms-powerpoint.presentation.macroenabled.12":{extensions:["pptm"]},"application/vnd.ms-powerpoint.slide.macroenabled.12":{extensions:["sldm"]},"application/vnd.ms-powerpoint.slideshow.macroenabled.12":{extensions:["ppsm"]},"application/vnd.ms-powerpoint.template.macroenabled.12":{extensions:["potm"]},"application/vnd.ms-project":{extensions:["mpp","mpt"]},"application/vnd.ms-word.document.macroenabled.12":{extensions:["docm"]},"application/vnd.ms-word.template.macroenabled.12":{extensions:["dotm"]},"application/vnd.ms-works":{extensions:["wps","wks","wcm","wdb"]},"application/vnd.ms-wpl":{extensions:["wpl"]},"application/vnd.ms-xpsdocument":{compressible:!1,extensions:["xps"]},"application/vnd.mseq":{extensions:["mseq"]},"application/vnd.musician":{extensions:["mus"]},"application/vnd.muvee.style":{extensions:["msty"]},"application/vnd.mynfc":{extensions:["taglet"]},"application/vnd.neurolanguage.nlu":{extensions:["nlu"]},"application/vnd.nitf":{extensions:["ntf","nitf"]},"application/vnd.noblenet-directory":{extensions:["nnd"]},"application/vnd.noblenet-sealer":{extensions:["nns"]},"application/vnd.noblenet-web":{extensions:["nnw"]},"application/vnd.nokia.n-gage.data":{extensions:["ngdat"]},"application/vnd.nokia.n-gage.symbian.install":{extensions:["n-gage"]},"application/vnd.nokia.radio-preset":{extensions:["rpst"]},"application/vnd.nokia.radio-presets":{extensions:["rpss"]},"application/vnd.novadigm.edm":{extensions:["edm"]},"application/vnd.novadigm.edx":{extensions:["edx"]},"application/vnd.novadigm.ext":{extensions:["ext"]},"application/vnd.oasis.opendocument.chart":{extensions:["odc"]},"application/vnd.oasis.opendocument.chart-template":{extensions:["otc"]},"application/vnd.oasis.opendocument.database":{extensions:["odb"]},"application/vnd.oasis.opendocument.formula":{extensions:["odf"]},"application/vnd.oasis.opendocument.formula-template":{extensions:["odft"]},"application/vnd.oasis.opendocument.graphics":{compressible:!1,extensions:["odg"]},"application/vnd.oasis.opendocument.graphics-template":{extensions:["otg"]},"application/vnd.oasis.opendocument.image":{extensions:["odi"]},"application/vnd.oasis.opendocument.image-template":{extensions:["oti"]},"application/vnd.oasis.opendocument.presentation":{compressible:!1,extensions:["odp"]},"application/vnd.oasis.opendocument.presentation-template":{extensions:["otp"]},"application/vnd.oasis.opendocument.spreadsheet":{compressible:!1,extensions:["ods"]},"application/vnd.oasis.opendocument.spreadsheet-template":{extensions:["ots"]},"application/vnd.oasis.opendocument.text":{compressible:!1,extensions:["odt"]},"application/vnd.oasis.opendocument.text-master":{extensions:["odm"]},"application/vnd.oasis.opendocument.text-template":{extensions:["ott"]},"application/vnd.oasis.opendocument.text-web":{extensions:["oth"]},"application/vnd.olpc-sugar":{extensions:["xo"]},"application/vnd.oma.dd2+xml":{extensions:["dd2"]},"application/vnd.openofficeorg.extension":{extensions:["oxt"]},"application/vnd.openxmlformats-officedocument.presentationml.presentation":{compressible:!1,extensions:["pptx"]},"application/vnd.openxmlformats-officedocument.presentationml.slide":{extensions:["sldx"]},"application/vnd.openxmlformats-officedocument.presentationml.slideshow":{extensions:["ppsx"]},"application/vnd.openxmlformats-officedocument.presentationml.template":{extensions:["potx"]},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":{compressible:!1,extensions:["xlsx"]},"application/vnd.openxmlformats-officedocument.spreadsheetml.template":{extensions:["xltx"]},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{compressible:!1,extensions:["docx"]},"application/vnd.openxmlformats-officedocument.wordprocessingml.template":{extensions:["dotx"]},"application/vnd.osgeo.mapguide.package":{extensions:["mgp"]},"application/vnd.osgi.dp":{extensions:["dp"]},"application/vnd.osgi.subsystem":{extensions:["esa"]},"application/vnd.palm":{extensions:["pdb","pqa","oprc"]},"application/vnd.pawaafile":{extensions:["paw"]},"application/vnd.pg.format":{extensions:["str"]},"application/vnd.pg.osasli":{extensions:["ei6"]},"application/vnd.picsel":{extensions:["efif"]},"application/vnd.pmi.widget":{extensions:["wg"]},"application/vnd.pocketlearn":{extensions:["plf"]},"application/vnd.powerbuilder6":{extensions:["pbd"]},"application/vnd.previewsystems.box":{extensions:["box"]},"application/vnd.proteus.magazine":{extensions:["mgz"]},"application/vnd.publishare-delta-tree":{extensions:["qps"]},"application/vnd.pvi.ptid1":{extensions:["ptid"]},"application/vnd.quark.quarkxpress":{extensions:["qxd","qxt","qwd","qwt","qxl","qxb"]},"application/vnd.realvnc.bed":{extensions:["bed"]},"application/vnd.recordare.musicxml":{extensions:["mxl"]},"application/vnd.recordare.musicxml+xml":{extensions:["musicxml"]},"application/vnd.rig.cryptonote":{extensions:["cryptonote"]},"application/vnd.rim.cod":{extensions:["cod"]},"application/vnd.rn-realmedia":{extensions:["rm"]},"application/vnd.rn-realmedia-vbr":{extensions:["rmvb"]},"application/vnd.route66.link66+xml":{extensions:["link66"]},"application/vnd.sailingtracker.track":{extensions:["st"]},"application/vnd.seemail":{extensions:["see"]},"application/vnd.sema":{extensions:["sema"]},"application/vnd.semd":{extensions:["semd"]},"application/vnd.semf":{extensions:["semf"]},"application/vnd.shana.informed.formdata":{extensions:["ifm"]},"application/vnd.shana.informed.formtemplate":{extensions:["itp"]},"application/vnd.shana.informed.interchange":{extensions:["iif"]},"application/vnd.shana.informed.package":{extensions:["ipk"]},"application/vnd.simtech-mindmapper":{extensions:["twd","twds"]},"application/vnd.smaf":{extensions:["mmf"]},"application/vnd.smart.teacher":{extensions:["teacher"]},"application/vnd.solent.sdkm+xml":{extensions:["sdkm","sdkd"]},"application/vnd.spotfire.dxp":{extensions:["dxp"]},"application/vnd.spotfire.sfs":{extensions:["sfs"]},"application/vnd.stardivision.calc":{extensions:["sdc"]},"application/vnd.stardivision.draw":{extensions:["sda"]},"application/vnd.stardivision.impress":{extensions:["sdd"]},"application/vnd.stardivision.math":{extensions:["smf"]},"application/vnd.stardivision.writer":{extensions:["sdw","vor"]},"application/vnd.stardivision.writer-global":{extensions:["sgl"]},"application/vnd.stepmania.package":{extensions:["smzip"]},"application/vnd.stepmania.stepchart":{extensions:["sm"]},"application/vnd.sun.xml.calc":{extensions:["sxc"]},"application/vnd.sun.xml.calc.template":{extensions:["stc"]},"application/vnd.sun.xml.draw":{extensions:["sxd"]},"application/vnd.sun.xml.draw.template":{extensions:["std"]},"application/vnd.sun.xml.impress":{extensions:["sxi"]},"application/vnd.sun.xml.impress.template":{extensions:["sti"]},"application/vnd.sun.xml.math":{extensions:["sxm"]},"application/vnd.sun.xml.writer":{extensions:["sxw"]},"application/vnd.sun.xml.writer.global":{extensions:["sxg"]},"application/vnd.sun.xml.writer.template":{extensions:["stw"]},"application/vnd.sus-calendar":{extensions:["sus","susp"]},"application/vnd.svd":{extensions:["svd"]},"application/vnd.symbian.install":{extensions:["sis","sisx"]},"application/vnd.syncml+xml":{extensions:["xsm"]},"application/vnd.syncml.dm+wbxml":{extensions:["bdm"]},"application/vnd.syncml.dm+xml":{extensions:["xdm"]},"application/vnd.tao.intent-module-archive":{extensions:["tao"]},"application/vnd.tcpdump.pcap":{extensions:["pcap","cap","dmp"]},"application/vnd.tmobile-livetv":{extensions:["tmo"]},"application/vnd.trid.tpt":{extensions:["tpt"]},"application/vnd.triscape.mxs":{extensions:["mxs"]},"application/vnd.trueapp":{extensions:["tra"]},"application/vnd.ufdl":{extensions:["ufd","ufdl"]},"application/vnd.uiq.theme":{extensions:["utz"]},"application/vnd.umajin":{extensions:["umj"]},"application/vnd.unity":{extensions:["unityweb"]},"application/vnd.uoml+xml":{extensions:["uoml"]},"application/vnd.vcx":{extensions:["vcx"]},"application/vnd.visio":{extensions:["vsd","vst","vss","vsw"]},"application/vnd.visionary":{extensions:["vis"]},"application/vnd.vsf":{extensions:["vsf"]},"application/vnd.wap.wbxml":{extensions:["wbxml"]},"application/vnd.wap.wmlc":{extensions:["wmlc"]},"application/vnd.wap.wmlscriptc":{extensions:["wmlsc"]},"application/vnd.webturbo":{extensions:["wtb"]},"application/vnd.wolfram.player":{extensions:["nbp"]},"application/vnd.wordperfect":{extensions:["wpd"]},"application/vnd.wqd":{extensions:["wqd"]},"application/vnd.wt.stf":{extensions:["stf"]},"application/vnd.xara":{extensions:["xar"]},"application/vnd.xfdl":{extensions:["xfdl"]},"application/vnd.yamaha.hv-dic":{extensions:["hvd"]},"application/vnd.yamaha.hv-script":{extensions:["hvs"]},"application/vnd.yamaha.hv-voice":{extensions:["hvp"]},"application/vnd.yamaha.openscoreformat":{extensions:["osf"]},"application/vnd.yamaha.openscoreformat.osfpvg+xml":{extensions:["osfpvg"]},"application/vnd.yamaha.smaf-audio":{extensions:["saf"]},"application/vnd.yamaha.smaf-phrase":{extensions:["spf"]},"application/vnd.yellowriver-custom-menu":{extensions:["cmp"]},"application/vnd.zul":{extensions:["zir","zirz"]},"application/vnd.zzazz.deck+xml":{extensions:["zaz"]},"application/voicexml+xml":{extensions:["vxml"]},"application/widget":{extensions:["wgt"]},"application/winhlp":{extensions:["hlp"]},"application/wsdl+xml":{extensions:["wsdl"]},"application/wspolicy+xml":{extensions:["wspolicy"]},"application/x-7z-compressed":{compressible:!1,extensions:["7z"]},"application/x-abiword":{extensions:["abw"]},"application/x-ace-compressed":{extensions:["ace"]},"application/x-apple-diskimage":{extensions:["dmg"]},"application/x-authorware-bin":{extensions:["aab","x32","u32","vox"]},"application/x-authorware-map":{extensions:["aam"]},"application/x-authorware-seg":{extensions:["aas"]},"application/x-bcpio":{extensions:["bcpio"]},"application/x-bdoc":{compressible:!1,extensions:["bdoc"]},"application/x-bittorrent":{extensions:["torrent"]},"application/x-blorb":{extensions:["blb","blorb"]},"application/x-bzip":{compressible:!1,extensions:["bz"]},"application/x-bzip2":{compressible:!1,extensions:["bz2","boz"]},"application/x-cbr":{extensions:["cbr","cba","cbt","cbz","cb7"]},"application/x-cdlink":{extensions:["vcd"]},"application/x-cfs-compressed":{extensions:["cfs"]},"application/x-chat":{extensions:["chat"]},"application/x-chess-pgn":{extensions:["pgn"]},"application/x-chrome-extension":{extensions:["crx"]},"application/x-cocoa":{source:"nginx",extensions:["cco"]},"application/x-conference":{extensions:["nsc"]},"application/x-cpio":{extensions:["cpio"]},"application/x-csh":{extensions:["csh"]},"application/x-debian-package":{extensions:["deb","udeb"]},"application/x-dgc-compressed":{extensions:["dgc"]},"application/x-director":{extensions:["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"]},"application/x-doom":{extensions:["wad"]},"application/x-dtbncx+xml":{extensions:["ncx"]},"application/x-dtbook+xml":{extensions:["dtb"]},"application/x-dtbresource+xml":{extensions:["res"]},"application/x-dvi":{compressible:!1,extensions:["dvi"]},"application/x-envoy":{extensions:["evy"]},"application/x-eva":{extensions:["eva"]},"application/x-font-bdf":{extensions:["bdf"]},"application/x-font-ghostscript":{extensions:["gsf"]},"application/x-font-linux-psf":{extensions:["psf"]},"application/x-font-otf":{compressible:!0,extensions:["otf"]},"application/x-font-pcf":{extensions:["pcf"]},"application/x-font-snf":{extensions:["snf"]},"application/x-font-ttf":{compressible:!0,extensions:["ttf","ttc"]},"application/x-font-type1":{extensions:["pfa","pfb","pfm","afm"]},"application/x-freearc":{extensions:["arc"]},"application/x-futuresplash":{extensions:["spl"]},"application/x-gca-compressed":{extensions:["gca"]},"application/x-glulx":{extensions:["ulx"]},"application/x-gnumeric":{extensions:["gnumeric"]},"application/x-gramps-xml":{extensions:["gramps"]},"application/x-gtar":{extensions:["gtar"]},"application/x-hdf":{extensions:["hdf"]},"application/x-httpd-php":{compressible:!0,extensions:["php"]},"application/x-install-instructions":{extensions:["install"]},"application/x-iso9660-image":{extensions:["iso"]},"application/x-java-archive-diff":{source:"nginx",
extensions:["jardiff"]},"application/x-java-jnlp-file":{compressible:!1,extensions:["jnlp"]},"application/x-latex":{compressible:!1,extensions:["latex"]},"application/x-lua-bytecode":{extensions:["luac"]},"application/x-lzh-compressed":{extensions:["lzh","lha"]},"application/x-makeself":{source:"nginx",extensions:["run"]},"application/x-mie":{extensions:["mie"]},"application/x-mobipocket-ebook":{extensions:["prc","mobi"]},"application/x-ms-application":{extensions:["application"]},"application/x-ms-shortcut":{extensions:["lnk"]},"application/x-ms-wmd":{extensions:["wmd"]},"application/x-ms-wmz":{extensions:["wmz"]},"application/x-ms-xbap":{extensions:["xbap"]},"application/x-msaccess":{extensions:["mdb"]},"application/x-msbinder":{extensions:["obd"]},"application/x-mscardfile":{extensions:["crd"]},"application/x-msclip":{extensions:["clp"]},"application/x-msdos-program":{extensions:["exe"]},"application/x-msdownload":{extensions:["exe","dll","com","bat","msi"]},"application/x-msmediaview":{extensions:["mvb","m13","m14"]},"application/x-msmetafile":{extensions:["wmf","wmz","emf","emz"]},"application/x-msmoney":{extensions:["mny"]},"application/x-mspublisher":{extensions:["pub"]},"application/x-msschedule":{extensions:["scd"]},"application/x-msterminal":{extensions:["trm"]},"application/x-mswrite":{extensions:["wri"]},"application/x-netcdf":{extensions:["nc","cdf"]},"application/x-ns-proxy-autoconfig":{compressible:!0,extensions:["pac"]},"application/x-nzb":{extensions:["nzb"]},"application/x-perl":{source:"nginx",extensions:["pl","pm"]},"application/x-pilot":{source:"nginx",extensions:["prc","pdb"]},"application/x-pkcs12":{compressible:!1,extensions:["p12","pfx"]},"application/x-pkcs7-certificates":{extensions:["p7b","spc"]},"application/x-pkcs7-certreqresp":{extensions:["p7r"]},"application/x-rar-compressed":{compressible:!1,extensions:["rar"]},"application/x-redhat-package-manager":{source:"nginx",extensions:["rpm"]},"application/x-research-info-systems":{extensions:["ris"]},"application/x-sea":{source:"nginx",extensions:["sea"]},"application/x-sh":{compressible:!0,extensions:["sh"]},"application/x-shar":{extensions:["shar"]},"application/x-shockwave-flash":{compressible:!1,extensions:["swf"]},"application/x-silverlight-app":{extensions:["xap"]},"application/x-sql":{extensions:["sql"]},"application/x-stuffit":{compressible:!1,extensions:["sit"]},"application/x-stuffitx":{extensions:["sitx"]},"application/x-subrip":{extensions:["srt"]},"application/x-sv4cpio":{extensions:["sv4cpio"]},"application/x-sv4crc":{extensions:["sv4crc"]},"application/x-t3vm-image":{extensions:["t3"]},"application/x-tads":{extensions:["gam"]},"application/x-tar":{compressible:!0,extensions:["tar"]},"application/x-tcl":{extensions:["tcl","tk"]},"application/x-tex":{extensions:["tex"]},"application/x-tex-tfm":{extensions:["tfm"]},"application/x-texinfo":{extensions:["texinfo","texi"]},"application/x-tgif":{extensions:["obj"]},"application/x-ustar":{extensions:["ustar"]},"application/x-wais-source":{extensions:["src"]},"application/x-web-app-manifest+json":{compressible:!0,extensions:["webapp"]},"application/x-x509-ca-cert":{extensions:["der","crt","pem"]},"application/x-xfig":{extensions:["fig"]},"application/x-xliff+xml":{extensions:["xlf"]},"application/x-xpinstall":{compressible:!1,extensions:["xpi"]},"application/x-xz":{extensions:["xz"]},"application/x-zmachine":{extensions:["z1","z2","z3","z4","z5","z6","z7","z8"]},"application/xaml+xml":{extensions:["xaml"]},"application/xcap-diff+xml":{extensions:["xdf"]},"application/xenc+xml":{extensions:["xenc"]},"application/xhtml+xml":{compressible:!0,extensions:["xhtml","xht"]},"application/xml":{compressible:!0,extensions:["xml","xsl","xsd","rng"]},"application/xml-dtd":{compressible:!0,extensions:["dtd"]},"application/xop+xml":{compressible:!0,extensions:["xop"]},"application/xproc+xml":{extensions:["xpl"]},"application/xslt+xml":{extensions:["xslt"]},"application/xspf+xml":{extensions:["xspf"]},"application/xv+xml":{extensions:["mxml","xhvml","xvml","xvm"]},"application/yang":{extensions:["yang"]},"application/yin+xml":{extensions:["yin"]},"application/zip":{compressible:!1,extensions:["zip"]},"audio/3gpp":{compressible:!1,extensions:["3gpp"]},"audio/adpcm":{extensions:["adp"]},"audio/basic":{compressible:!1,extensions:["au","snd"]},"audio/midi":{extensions:["mid","midi","kar","rmi"]},"audio/mp4":{compressible:!1,extensions:["m4a","mp4a"]},"audio/mpeg":{compressible:!1,extensions:["mpga","mp2","mp2a","mp3","m2a","m3a"]},"audio/ogg":{compressible:!1,extensions:["oga","ogg","spx"]},"audio/s3m":{extensions:["s3m"]},"audio/silk":{extensions:["sil"]},"audio/vnd.dece.audio":{extensions:["uva","uvva"]},"audio/vnd.digital-winds":{extensions:["eol"]},"audio/vnd.dra":{extensions:["dra"]},"audio/vnd.dts":{extensions:["dts"]},"audio/vnd.dts.hd":{extensions:["dtshd"]},"audio/vnd.lucent.voice":{extensions:["lvp"]},"audio/vnd.ms-playready.media.pya":{extensions:["pya"]},"audio/vnd.nuera.ecelp4800":{extensions:["ecelp4800"]},"audio/vnd.nuera.ecelp7470":{extensions:["ecelp7470"]},"audio/vnd.nuera.ecelp9600":{extensions:["ecelp9600"]},"audio/vnd.rip":{extensions:["rip"]},"audio/wav":{compressible:!1,extensions:["wav"]},"audio/wave":{compressible:!1,extensions:["wav"]},"audio/webm":{compressible:!1,extensions:["weba"]},"audio/x-aac":{compressible:!1,extensions:["aac"]},"audio/x-aiff":{extensions:["aif","aiff","aifc"]},"audio/x-caf":{compressible:!1,extensions:["caf"]},"audio/x-flac":{extensions:["flac"]},"audio/x-m4a":{source:"nginx",extensions:["m4a"]},"audio/x-matroska":{extensions:["mka"]},"audio/x-mpegurl":{extensions:["m3u"]},"audio/x-ms-wax":{extensions:["wax"]},"audio/x-ms-wma":{extensions:["wma"]},"audio/x-pn-realaudio":{extensions:["ram","ra"]},"audio/x-pn-realaudio-plugin":{extensions:["rmp"]},"audio/x-realaudio":{source:"nginx",extensions:["ra"]},"audio/x-wav":{extensions:["wav"]},"audio/xm":{extensions:["xm"]},"chemical/x-cdx":{extensions:["cdx"]},"chemical/x-cif":{extensions:["cif"]},"chemical/x-cmdf":{extensions:["cmdf"]},"chemical/x-cml":{extensions:["cml"]},"chemical/x-csml":{extensions:["csml"]},"chemical/x-xyz":{extensions:["xyz"]},"font/opentype":{compressible:!0,extensions:["otf"]},"image/bmp":{compressible:!0,extensions:["bmp"]},"image/cgm":{extensions:["cgm"]},"image/g3fax":{extensions:["g3"]},"image/gif":{compressible:!1,extensions:["gif"]},"image/ief":{extensions:["ief"]},"image/jpeg":{compressible:!1,extensions:["jpeg","jpg","jpe"]},"image/ktx":{extensions:["ktx"]},"image/png":{compressible:!1,extensions:["png"]},"image/prs.btif":{extensions:["btif"]},"image/sgi":{extensions:["sgi"]},"image/svg+xml":{compressible:!0,extensions:["svg","svgz"]},"image/tiff":{compressible:!1,extensions:["tiff","tif"]},"image/vnd.adobe.photoshop":{compressible:!0,extensions:["psd"]},"image/vnd.dece.graphic":{extensions:["uvi","uvvi","uvg","uvvg"]},"image/vnd.djvu":{extensions:["djvu","djv"]},"image/vnd.dvb.subtitle":{extensions:["sub"]},"image/vnd.dwg":{extensions:["dwg"]},"image/vnd.dxf":{extensions:["dxf"]},"image/vnd.fastbidsheet":{extensions:["fbs"]},"image/vnd.fpx":{extensions:["fpx"]},"image/vnd.fst":{extensions:["fst"]},"image/vnd.fujixerox.edmics-mmr":{extensions:["mmr"]},"image/vnd.fujixerox.edmics-rlc":{extensions:["rlc"]},"image/vnd.ms-modi":{extensions:["mdi"]},"image/vnd.ms-photo":{extensions:["wdp"]},"image/vnd.net-fpx":{extensions:["npx"]},"image/vnd.wap.wbmp":{extensions:["wbmp"]},"image/vnd.xiff":{extensions:["xif"]},"image/webp":{extensions:["webp"]},"image/x-3ds":{extensions:["3ds"]},"image/x-cmu-raster":{extensions:["ras"]},"image/x-cmx":{extensions:["cmx"]},"image/x-freehand":{extensions:["fh","fhc","fh4","fh5","fh7"]},"image/x-icon":{compressible:!0,extensions:["ico"]},"image/x-jng":{source:"nginx",extensions:["jng"]},"image/x-mrsid-image":{extensions:["sid"]},"image/x-ms-bmp":{source:"nginx",compressible:!0,extensions:["bmp"]},"image/x-pcx":{extensions:["pcx"]},"image/x-pict":{extensions:["pic","pct"]},"image/x-portable-anymap":{extensions:["pnm"]},"image/x-portable-bitmap":{extensions:["pbm"]},"image/x-portable-graymap":{extensions:["pgm"]},"image/x-portable-pixmap":{extensions:["ppm"]},"image/x-rgb":{extensions:["rgb"]},"image/x-tga":{extensions:["tga"]},"image/x-xbitmap":{extensions:["xbm"]},"image/x-xpixmap":{extensions:["xpm"]},"image/x-xwindowdump":{extensions:["xwd"]},"message/rfc822":{compressible:!0,extensions:["eml","mime"]},"model/iges":{compressible:!1,extensions:["igs","iges"]},"model/mesh":{compressible:!1,extensions:["msh","mesh","silo"]},"model/vnd.collada+xml":{extensions:["dae"]},"model/vnd.dwf":{extensions:["dwf"]},"model/vnd.gdl":{extensions:["gdl"]},"model/vnd.gtw":{extensions:["gtw"]},"model/vnd.mts":{extensions:["mts"]},"model/vnd.vtu":{extensions:["vtu"]},"model/vrml":{compressible:!1,extensions:["wrl","vrml"]},"model/x3d+binary":{compressible:!1,extensions:["x3db","x3dbz"]},"model/x3d+vrml":{compressible:!1,extensions:["x3dv","x3dvz"]},"model/x3d+xml":{compressible:!0,extensions:["x3d","x3dz"]},"text/cache-manifest":{compressible:!0,extensions:["appcache","manifest"]},"text/calendar":{extensions:["ics","ifb"]},"text/coffeescript":{extensions:["coffee","litcoffee"]},"text/css":{compressible:!0,extensions:["css"]},"text/csv":{compressible:!0,extensions:["csv"]},"text/hjson":{extensions:["hjson"]},"text/html":{compressible:!0,extensions:["html","htm","shtml"]},"text/jade":{extensions:["jade"]},"text/jsx":{compressible:!0,extensions:["jsx"]},"text/less":{extensions:["less"]},"text/mathml":{source:"nginx",extensions:["mml"]},"text/n3":{compressible:!0,extensions:["n3"]},"text/plain":{compressible:!0,extensions:["txt","text","conf","def","list","log","in","ini"]},"text/prs.lines.tag":{extensions:["dsc"]},"text/richtext":{compressible:!0,extensions:["rtx"]},"text/rtf":{compressible:!0,extensions:["rtf"]},"text/sgml":{extensions:["sgml","sgm"]},"text/slim":{extensions:["slim","slm"]},"text/stylus":{extensions:["stylus","styl"]},"text/tab-separated-values":{compressible:!0,extensions:["tsv"]},"text/troff":{extensions:["t","tr","roff","man","me","ms"]},"text/turtle":{extensions:["ttl"]},"text/uri-list":{compressible:!0,extensions:["uri","uris","urls"]},"text/vcard":{compressible:!0,extensions:["vcard"]},"text/vnd.curl":{extensions:["curl"]},"text/vnd.curl.dcurl":{extensions:["dcurl"]},"text/vnd.curl.mcurl":{extensions:["mcurl"]},"text/vnd.curl.scurl":{extensions:["scurl"]},"text/vnd.dvb.subtitle":{extensions:["sub"]},"text/vnd.fly":{extensions:["fly"]},"text/vnd.fmi.flexstor":{extensions:["flx"]},"text/vnd.graphviz":{extensions:["gv"]},"text/vnd.in3d.3dml":{extensions:["3dml"]},"text/vnd.in3d.spot":{extensions:["spot"]},"text/vnd.sun.j2me.app-descriptor":{extensions:["jad"]},"text/vnd.wap.wml":{extensions:["wml"]},"text/vnd.wap.wmlscript":{extensions:["wmls"]},"text/vtt":{charset:"UTF-8",compressible:!0,extensions:["vtt"]},"text/x-asm":{extensions:["s","asm"]},"text/x-c":{extensions:["c","cc","cxx","cpp","h","hh","dic"]},"text/x-component":{source:"nginx",extensions:["htc"]},"text/x-fortran":{extensions:["f","for","f77","f90"]},"text/x-handlebars-template":{extensions:["hbs"]},"text/x-java-source":{extensions:["java"]},"text/x-lua":{extensions:["lua"]},"text/x-markdown":{compressible:!0,extensions:["markdown","md","mkd"]},"text/x-nfo":{extensions:["nfo"]},"text/x-opml":{extensions:["opml"]},"text/x-pascal":{extensions:["p","pas"]},"text/x-processing":{compressible:!0,extensions:["pde"]},"text/x-sass":{extensions:["sass"]},"text/x-scss":{extensions:["scss"]},"text/x-setext":{extensions:["etx"]},"text/x-sfv":{extensions:["sfv"]},"text/x-suse-ymp":{compressible:!0,extensions:["ymp"]},"text/x-uuencode":{extensions:["uu"]},"text/x-vcalendar":{extensions:["vcs"]},"text/x-vcard":{extensions:["vcf"]},"text/xml":{source:"iana",compressible:!0,extensions:["xml"]},"text/yaml":{extensions:["yaml","yml"]},"video/3gpp":{extensions:["3gp","3gpp"]},"video/3gpp2":{extensions:["3g2"]},"video/h261":{extensions:["h261"]},"video/h263":{extensions:["h263"]},"video/h264":{extensions:["h264"]},"video/jpeg":{extensions:["jpgv"]},"video/jpm":{extensions:["jpm","jpgm"]},"video/mj2":{extensions:["mj2","mjp2"]},"video/mp2t":{extensions:["ts"]},"video/mp4":{compressible:!1,extensions:["mp4","mp4v","mpg4"]},"video/mpeg":{compressible:!1,extensions:["mpeg","mpg","mpe","m1v","m2v"]},"video/ogg":{compressible:!1,extensions:["ogv"]},"video/quicktime":{compressible:!1,extensions:["qt","mov"]},"video/vnd.dece.hd":{extensions:["uvh","uvvh"]},"video/vnd.dece.mobile":{extensions:["uvm","uvvm"]},"video/vnd.dece.pd":{extensions:["uvp","uvvp"]},"video/vnd.dece.sd":{extensions:["uvs","uvvs"]},"video/vnd.dece.video":{extensions:["uvv","uvvv"]},"video/vnd.dvb.file":{extensions:["dvb"]},"video/vnd.fvt":{extensions:["fvt"]},"video/vnd.mpegurl":{extensions:["mxu","m4u"]},"video/vnd.ms-playready.media.pyv":{extensions:["pyv"]},"video/vnd.uvvu.mp4":{extensions:["uvu","uvvu"]},"video/vnd.vivo":{extensions:["viv"]},"video/webm":{compressible:!1,extensions:["webm"]},"video/x-f4v":{extensions:["f4v"]},"video/x-fli":{extensions:["fli"]},"video/x-flv":{compressible:!1,extensions:["flv"]},"video/x-m4v":{extensions:["m4v"]},"video/x-matroska":{compressible:!1,extensions:["mkv","mk3d","mks"]},"video/x-mng":{extensions:["mng"]},"video/x-ms-asf":{extensions:["asf","asx"]},"video/x-ms-vob":{extensions:["vob"]},"video/x-ms-wm":{extensions:["wm"]},"video/x-ms-wmv":{compressible:!1,extensions:["wmv"]},"video/x-ms-wmx":{extensions:["wmx"]},"video/x-ms-wvx":{extensions:["wvx"]},"video/x-msvideo":{extensions:["avi"]},"video/x-sgi-movie":{extensions:["movie"]},"video/x-smv":{extensions:["smv"]},"x-conference/x-cooltalk":{extensions:["ice"]}}},mime_lookup:{value:function(e){if(!e)return"application/octet-stream";e=e.toLowerCase();for(var t in this.mime_db)if(this.mime_db[t].extensions&&-1!=this.mime_db[t].extensions.indexOf(e))return t;return"application/octet-stream"}}}),$p});